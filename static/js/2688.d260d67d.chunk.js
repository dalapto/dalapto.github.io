"use strict";(self.webpackChunkreact_arcgis=self.webpackChunkreact_arcgis||[]).push([[2688],{84683:function(e,t,r){r.d(t,{bU:function(){return d},fC:function(){return h},tp:function(){return y},v7:function(){return c}});var n=new Float64Array(2),a=new Float64Array(2),i="0123456789bcdefghjkmnpqrstuvwxyz";function o(e){return i[e]}function s(e){return(e[0]+e[1])/2}function u(e,t,r){return e[0]=t,e[1]=r,e}function l(e,t){var r=s(e),n=t,a=!t;e[0]=a*e[0]+n*r,e[1]=a*r+n*e[1]}function p(e,t){var r=t>s(e);return l(e,r),r}function d(e,t){for(var r=-90,n=90,a=-180,i=180,o=0;o<t;o++){for(var s=Math.ceil((o+1)/2),u=Math.floor((o+1)/2),l=1-o%2,p=30-(3*s+2*u),d=30-(2*s+3*u),c=3*l+2*(1-l),y=2*l+3*(1-l),h=3*l+7*(1-l)<<d,f=(7*l+3*(1-l)<<p&e.geohashX)>>p,v=(h&e.geohashY)>>d,m=c-1;m>=0;m--){var g=(a+i)/2,b=f&1<<m?1:0;a=(1-b)*a+b*g,i=(1-b)*g+b*i}for(var w=y-1;w>=0;w--){var _=(r+n)/2,k=v&1<<w?1:0;r=(1-k)*r+k*_,n=(1-k)*_+k*n}}return[a,r,i,n]}function c(e,t,r,n){n%2&&(n+=1);for(var a=0,i=0,o=-90,s=90,u=-180,l=180,p=0;p<n/2;p++){for(var d=0;d<5;d++){var c=(u+l)/2,y=r>c?1:0;a|=y<<29-(d+5*p),u=(1-y)*u+y*c,l=(1-y)*c+y*l}for(var h=0;h<5;h++){var f=(o+s)/2,v=t>f?1:0;i|=v<<29-(h+5*p),o=(1-v)*o+v*f,s=(1-v)*f+v*s}}e.geohashX=a,e.geohashY=i}function y(e,t,r,n,a){a%2&&(a+=1);for(var i=0,o=0,s=-90,u=90,l=-180,p=180,d=0;d<a/2;d++){for(var c=0;c<5;c++){var y=(l+p)/2,h=n>y?1:0;i|=h<<29-(c+5*d),l=(1-h)*l+h*y,p=(1-h)*y+h*p}for(var f=0;f<5;f++){var v=(s+u)/2,m=r>v?1:0;o|=m<<29-(f+5*d),s=(1-m)*s+m*v,u=(1-m)*v+m*u}}e[2*t]=i,e[2*t+1]=o}function h(e,t,r){for(var i="",s=u(n,-90,90),l=u(a,-180,180),d=0;d<r;d++){var c=0;d%2?(c|=p(s,e)<<4,c|=p(l,t)<<3,c|=p(s,e)<<2,c|=p(l,t)<<1,c|=p(s,e)<<0):(c|=p(l,t)<<4,c|=p(s,e)<<3,c|=p(l,t)<<2,c|=p(s,e)<<1,c|=p(l,t)<<0),i+=o(c)}return i}},22688:function(e,t,r){r.r(t),r.d(t,{default:function(){return Fr}});var n=r(37762),a=r(74165),i=r(15861),o=r(15671),s=r(43144),u=r(82963),l=r(60136),p=r(29388),d=r(27366),c=(r(59486),r(40281)),y=r(10064),h=r(32718),f=r(66978),v=r(49861),m=(r(25243),r(63780),r(93169)),g=r(69912),b=r(84683),w=r(30651),_=r(83406),k=r(80457),C=r(29439),x=r(7138),Z=r(76672),T=r(80885),E=r(52587),M=r(92975),I=r(3182),L=function(){function e(){(0,o.Z)(this,e),this._featureLookup=new Map}return(0,s.Z)(e,[{key:"deleteFromStore",value:function(e){var t=this;e.forEach((function(e){t._featureLookup.delete(e)}))}},{key:"readFromStoreByList",value:function(e){var t=this,r=[];return e.forEach((function(e){var n=t.readFromStoreById(e);n&&r.push(n)})),r}},{key:"readFromStoreById",value:function(e){var t;return null!==(t=this._featureLookup.get(e))&&void 0!==t?t:null}},{key:"writeToStore",value:function(e,t,r){var n=this,a=[];return e.forEach((function(e){if(e&&e.id){e.properties||(e.properties=[]);var i,o=null;if(r&&(o=e.properties[r]?(0,_.GH)(e.properties[r]):null),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&n._featureLookup.has(e.id)&&n._featureLookup.get(e.id).attributes){var s=n._featureLookup.get(e.id);i=new I.u_(o?JSON.parse(JSON.stringify(o)):null!==s&&void 0!==s&&s.geometry?JSON.parse(JSON.stringify(s.geometry)):null,JSON.parse(JSON.stringify(Object.assign(s.attributes,e.properties))),null,e.properties[t])}else i=new I.u_(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);n._featureLookup.set(e.id,i),a.push(i)}})),a}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"resetInstance",value:function(){e.instance&&(e.instance=null)}}]),e}(),D=r(1413),G=r(19545),R=r(76200),S=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).resultRows=[],n}return(0,s.Z)(r)}(x.Z);(0,d._)([(0,v.Cb)()],S.prototype,"resultRows",void 0);var N=S=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQueryResult")],S),j=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).resultRowsStream=new ReadableStream,n}return(0,s.Z)(r)}(x.Z);(0,d._)([(0,v.Cb)()],j.prototype,"resultRowsStream",void 0);var F=j=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQueryResult")],j),P=r(46784),O=r(78952),A=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).name=null,n.unique=null,n.ascending=null,n.description=null,n.fieldNames=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],A.prototype,"name",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],A.prototype,"unique",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],A.prototype,"ascending",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],A.prototype,"description",void 0),(0,d._)([(0,v.Cb)({type:[String],json:{write:!0}})],A.prototype,"fieldNames",void 0);var z=A=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.FieldIndex")],A),Q=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).name=null,n.alias=null,n.fieldType=null,n.geometryType=null,n.hasM=null,n.hasZ=null,n.nullable=null,n.editable=null,n.required=null,n.defaultVisibility=null,n.systemMaintained=null,n.role=null,n.defaultValue=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],Q.prototype,"name",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],Q.prototype,"alias",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],Q.prototype,"fieldType",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],Q.prototype,"geometryType",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"hasM",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"hasZ",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"nullable",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"editable",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"required",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"defaultVisibility",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"systemMaintained",void 0),(0,d._)([(0,v.Cb)()],Q.prototype,"role",void 0),(0,d._)([(0,v.Cb)({type:Object,json:{type:String,write:{writer:function(e,t){t.defaultValue=null!=e?e.toString():null}}}})],Q.prototype,"defaultValue",void 0);var U=Q=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphProperty")],Q),q=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).name=null,n.alias=null,n.role=null,n.strict=null,n.properties=null,n.fieldIndexes=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],q.prototype,"name",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],q.prototype,"alias",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],q.prototype,"role",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"strict",void 0),(0,d._)([(0,v.Cb)({type:[U],json:{write:!0}})],q.prototype,"properties",void 0),(0,d._)([(0,v.Cb)({type:[z],json:{write:!0}})],q.prototype,"fieldIndexes",void 0);var Y=q=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphObjectType")],q),H=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){return(0,o.Z)(this,r),t.call(this,e)}return(0,s.Z)(r)}(Y),B=H=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.EntityType")],H),J=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).endPoints=[],n}return(0,s.Z)(r)}(Y);(0,d._)([(0,v.Cb)()],J.prototype,"endPoints",void 0);var V=J=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.RelationshipType")],J),W=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).timestamp=null,n.spatialReference=null,n.strict=null,n.objectIdField=null,n.globalIdField=null,n.arcgisManaged=null,n.identifierInfo=null,n.searchIndexes=null,n.entityTypes=null,n.relationshipTypes=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:Date,json:{type:Number,write:{writer:function(e,t){t.timestamp=null===e||void 0===e?void 0:e.getTime()}}}})],W.prototype,"timestamp",void 0),(0,d._)([(0,v.Cb)({type:O.Z,json:{write:!0}})],W.prototype,"spatialReference",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],W.prototype,"strict",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],W.prototype,"objectIdField",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],W.prototype,"globalIdField",void 0),(0,d._)([(0,v.Cb)()],W.prototype,"arcgisManaged",void 0),(0,d._)([(0,v.Cb)()],W.prototype,"identifierInfo",void 0),(0,d._)([(0,v.Cb)()],W.prototype,"searchIndexes",void 0),(0,d._)([(0,v.Cb)({type:[B],json:{write:!0}})],W.prototype,"entityTypes",void 0),(0,d._)([(0,v.Cb)({type:[V],json:{write:!0}})],W.prototype,"relationshipTypes",void 0);var K=W=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.DataModel")],W),$=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).capabilities=[],n.supportsSearch=!1,n.supportedQueryFormats=[],n.allowGeometryUpdates=!1,n.searchMaxRecordCount=null,n.serviceCapabilities=null,n.maxRecordCount=null,n.description="",n.copyrightText="",n.units="",n.spatialReference=null,n.currentVersion=null,n.dateFieldsTimeReference=null,n.serviceItemId="",n.supportsDocuments=!1,n.dataEditingNotSupported=!1,n.schemaEditingNotSupported=!1,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:[String],json:{write:!0}})],$.prototype,"capabilities",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"supportsSearch",void 0),(0,d._)([(0,v.Cb)({type:[String],json:{write:!0}})],$.prototype,"supportedQueryFormats",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"allowGeometryUpdates",void 0),(0,d._)([(0,v.Cb)({type:Number,json:{write:!0}})],$.prototype,"searchMaxRecordCount",void 0),(0,d._)([(0,v.Cb)({type:Object,json:{write:!0}})],$.prototype,"serviceCapabilities",void 0),(0,d._)([(0,v.Cb)({type:Number,json:{write:!0}})],$.prototype,"maxRecordCount",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],$.prototype,"description",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],$.prototype,"copyrightText",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],$.prototype,"units",void 0),(0,d._)([(0,v.Cb)({type:Object,json:{write:!0}})],$.prototype,"spatialReference",void 0),(0,d._)([(0,v.Cb)({type:Number,json:{write:!0}})],$.prototype,"currentVersion",void 0),(0,d._)([(0,v.Cb)({type:Object,json:{write:!0}})],$.prototype,"dateFieldsTimeReference",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],$.prototype,"serviceItemId",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"supportsDocuments",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"dataEditingNotSupported",void 0),(0,d._)([(0,v.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"schemaEditingNotSupported",void 0);var X=$=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.ServiceDefinition")],$),ee=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).dataModel=null,n.serviceDefinition=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],ee.prototype,"url",void 0),(0,d._)([(0,v.Cb)({type:K,json:{write:!0}})],ee.prototype,"dataModel",void 0),(0,d._)([(0,v.Cb)({type:X,json:{write:!0}})],ee.prototype,"serviceDefinition",void 0);var te,re=ee=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],ee),ne=r(65905),ae="esri/rest/knowledgeGraph/wasmInterface/",ie=null;function oe(){return se.apply(this,arguments)}function se(){return se=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null!==(t=ie)&&void 0!==t?t:te)){e.next=3;break}return e.abrupt("return",r);case 3:return n=(0,m.Z)("wasm-simd"),e.abrupt("return",te=ue(n));case 5:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}function ue(e){return le.apply(this,arguments)}function le(){return le=(0,i.Z)((0,a.Z)().mark((function e(t){var n,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,r.e(2717).then(r.bind(r,2717)).then((function(e){return e.a}));case 3:return n=e.sent,i=n.default,e.abrupt("return",i({locateFile:function(e){return(0,ne.V)(ae+e)}}));case 6:return e.next=8,r.e(3415).then(r.bind(r,43415)).then((function(e){return e.a}));case 8:return o=e.sent,s=o.default,e.abrupt("return",s({locateFile:function(e){return(0,ne.V)(ae+e)}}));case 11:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}var pe=r(77577),de=r(585),ce=r(29909),ye=r(32238);function he(e,t){var r=new t.ArrayValue;return r.deleteLater(),e.forEach((function(e){r.add_value(be(e,t))})),r}function fe(e,t){var r=new t.ObjectValue;r.deleteLater();for(var n=0,a=Object.entries(e);n<a.length;n++){var i=(0,C.Z)(a[n],2),o=i[0],s=i[1];r.set_key_value(o,be(s,t))}return r}function ve(e,t){if(e instanceof pe.Z)return function(e,t){var r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;var n=[],a=[];a[0]=e.points.length;var i=0;return e.points.forEach((function(e){e.forEach((function(e){n[i]=e,i++}))})),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}(e,t);if(e instanceof de.Z)return function(e,t){var r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;var n=[],a=[];a[0]=1,n[0]=e.x,n[1]=e.y;var i=2;return e.hasZ&&(n[i]=e.z,i++),e.hasM&&(n[i]=e.m,i++),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}(e,t);if(e instanceof ce.Z||e instanceof T.Z)return function(e,t){var r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;var n=[],a=[],i=[];e instanceof ce.Z?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,i=e.paths):e instanceof T.Z&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,i=e.rings);var o=0,s=0;return i.forEach((function(e){var t=0;e.forEach((function(e){t++,e.forEach((function(e){n[s]=e,s++}))})),a[o]=t,o++})),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}(e,t);throw new y.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function me(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function ge(e,t,r){if(!e.extent)throw new y.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new y.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new y.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function be(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof ye.Z)return ve(e,t);if(Array.isArray(e)){var r=new t.ArrayValue;return r.deleteLater(),e.forEach((function(e){r.add_value(be(e,t))})),r}return fe(e,t)}var we=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).properties=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({json:{write:!0}})],we.prototype,"properties",void 0);var _e=we=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphObject")],we),ke=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).typeName=null,n.id=null,n}return(0,s.Z)(r)}(_e);(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],ke.prototype,"typeName",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],ke.prototype,"id",void 0);var Ce=ke=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphNamedObject")],ke),xe=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).layoutGeometry=null,n}return(0,s.Z)(r)}(Ce);(0,d._)([(0,v.Cb)({type:de.Z,json:{write:!0}})],xe.prototype,"layoutGeometry",void 0);var Ze=xe=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.Entity")],xe),Te=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).originId=null,n.destinationId=null,n.layoutGeometry=null,n}return(0,s.Z)(r)}(Ce);(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],Te.prototype,"originId",void 0),(0,d._)([(0,v.Cb)({type:String,json:{write:!0}})],Te.prototype,"destinationId",void 0),(0,d._)([(0,v.Cb)({type:ce.Z,json:{write:!0}})],Te.prototype,"layoutGeometry",void 0);var Ee=Te=(0,d._)([(0,g.j)("esri.rest.Relationship.Relationship")],Te);function Me(e,t){if(!e.typeName)throw new y.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof Ze){var r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(var n=0,a=Object.entries(e.properties);n<a.length;n++){var i=(0,C.Z)(a[n],2),o=i[0],s=i[1];r.set_key_value(o,Le(s,t))}return e.id&&r.set_id(e.id),r}if(e instanceof Ee){var u=new t.RelationshipValue;u.deleteLater(),u.type_name=e.typeName;for(var l=0,p=Object.entries(e.properties);l<p.length;l++){var d=(0,C.Z)(p[l],2),c=d[0],h=d[1];u.set_key_value(c,Le(h,t))}return e.id&&u.set_id(e.id),e.originId&&e.destinationId&&u.set_related_entity_ids(e.originId,e.destinationId),u}throw new y.Z("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function Ie(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Le(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof ye.Z?ve(e,t):""}var De=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).name=null,n.supportedCategory=null,n.analyzers=[],n.searchProperties=new Map,n}return(0,s.Z)(r)}(x.Z);(0,d._)([(0,v.Cb)()],De.prototype,"name",void 0),(0,d._)([(0,v.Cb)()],De.prototype,"supportedCategory",void 0),(0,d._)([(0,v.Cb)()],De.prototype,"analyzers",void 0),(0,d._)([(0,v.Cb)()],De.prototype,"searchProperties",void 0);var Ge,Re,Se,Ne,je,Fe,Pe,Oe=De=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.SearchIndex")],De);function Ae(e){var t,r,n,a;return e.deleteLater(),new K({timestamp:e.timestamp,spatialReference:new O.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:Pe[null===(t=e.identifier_info)||void 0===t||null===(t=t.identifier_mapping_info)||void 0===t||null===(t=t.identifier_info_type)||void 0===t?void 0:t.value],databaseNativeIdentifier:null===(r=e.identifier_info)||void 0===r||null===(r=r.identifier_mapping_info)||void 0===r?void 0:r.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:null===(n=e.identifier_info)||void 0===n||null===(n=n.identifier_mapping_info)||void 0===n||null===(n=n.uniform_property_identifier)||void 0===n?void 0:n.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Ne[null===(a=e.identifier_info)||void 0===a||null===(a=a.identifier_generation_info)||void 0===a||null===(a=a.uuid_method_hint)||void 0===a?void 0:a.value]}},searchIndexes:Ke(e.search_indexes),entityTypes:He(e.entity_types),relationshipTypes:We(e.relationship_types)})}function ze(e){return e.deleteLater(),new B(Ue(e))}function Qe(e){return e.deleteLater(),new z({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Be(e.fields)})}function Ue(e){return{name:e.name,alias:e.alias,role:Ge[e.role.value]?Ge[e.role.value]:null,strict:e.strict,properties:Je(e.properties),fieldIndexes:Ve(e.field_indexes)}}function qe(e){return e.deleteLater(),new U({alias:e.alias,name:e.name,fieldType:Re[e.field_type.value]?Re[e.field_type.value]:null,geometryType:Se[e.geometry_type.value]?Se[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:Fe[e.role.value],defaultValue:e.default_value})}function Ye(e){e.deleteLater();for(var t=Ue(e),r=[],n=0;n<e.end_points.size();n++){var a=e.end_points.get(n);r.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return new V(Object.assign({endPoints:r},t))}function He(e){for(var t=[],r=0;r<e.size();r++)t.push(ze(e.get(r)));return t}function Be(e){for(var t=[],r=0;r<e.size();r++)t.push(e.get(r));return t}function Je(e){for(var t=[],r=0;r<e.size();r++)t.push(qe(e.get(r)));return t}function Ve(e){for(var t=[],r=0;r<e.size();r++)t.push(Qe(e.get(r)));return t}function We(e){for(var t=[],r=0;r<e.size();r++)t.push(Ye(e.get(r)));return t}function Ke(e){for(var t=[],r=0;r<e.size();r++){var n=new Oe,a=e.get(0);n.name=a.name,n.supportedCategory=je[a.supported_category.value];for(var i=a.analyzers.size(),o=0;o<i;o++)n.analyzers.push({name:a.analyzers.get(o).name});for(var s=0;s<a.search_properties.keys().size();s++){for(var u=a.search_properties.keys().get(s),l=a.search_properties.get(u),p=[],d=0;d<l.property_names.size();d++)p.push(l.property_names.get(d));n.searchProperties.set(u,{propertyNames:p})}t.push(n)}return t}!function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"}(Ge||(Ge={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger"}(Re||(Re={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Se||(Se={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Ne||(Ne={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(je||(je={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(Fe||(Fe={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(Pe||(Pe={}));var $e=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){return(0,o.Z)(this,r),t.call(this,e)}return(0,s.Z)(r)}(_e),Xe=$e=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.ObjectValue")],$e),et=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).path=null,n}return(0,s.Z)(r)}(P.wq);(0,d._)([(0,v.Cb)({type:[_e],json:{write:!0}})],et.prototype,"path",void 0);var tt,rt,nt,at=et=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.Path")],et);function it(e){var t={},r=ot(e,t),n=e.lengths,a=e.coords,i="";if(e.geometry_type.value===tt.ESRI_GEOMETRY_POLYGON)i="rings";else{if(e.geometry_type.value!==tt.ESRI_GEOMETRY_POLYLINE)throw new y.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");i="paths"}t[i]=[];var o=0;return n.forEach((function(e){for(var n=[],s=0;s<e;s++){for(var u=[],l=0;l<r;l++)u[l]=a[o],o++;n.push(u)}t[i].push(n)})),t}function ot(e,t){var r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(tt||(tt={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(rt||(rt={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(nt||(nt={}));var st=h.Z.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),ut={decodedWasmObjToQueryResponseObj:function(e,t){if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case tt.ESRI_GEOMETRY_POINT:return function(e){var t={},r=2;ot(e,t);var n=e.coords;return t.x=n[0],t.y=n[1],e.has_z&&(t.z=n[r],r++),e.has_m&&(t.m=n[r]),new de.Z(t)}(e);case tt.ESRI_GEOMETRY_MULTIPOINT:return function(e){var t={},r=ot(e,t),n=e.lengths,a=e.coords,i=n[0];t.points=[];for(var o=0,s=0;s<i;s++){for(var u=[],l=0;l<r;l++)u[l]=a[o],o++;t.points.push(u)}return new pe.Z(t)}(e);case tt.ESRI_GEOMETRY_POLYLINE:return function(e){return new ce.Z(it(e))}(e);case tt.ESRI_GEOMETRY_POLYGON:return function(e){return new T.Z(it(e))}(e);case tt.ESRI_GEOMETRY_ENVELOPE:case tt.ESRI_GEOMETRY_MULTI_PATCH:return st.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case tt.ESRI_GEOMETRY_NULL:case tt.ESRI_GEOMETRY_ANY:default:return st.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return st.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case rt.OBJECT:return function(e,t){return new Xe(dt(e,t))}(e,t);case rt.ENTITY:return pt(e,t);case rt.RELATIONSHIP:return ct(e,t);case rt.PATH:return function(e,t){for(var r=e.entity_count(),n=e.relationship_count(),a=[],i=0;i<r;i++)a.push(pt(e.get_entity_at(i),t)),i<n&&a.push(ct(e.get_relationship_at(i),t));return new at({path:a})}(e,t);case rt.ARRAY:return function(e,t){for(var r=[],n=e.count(),a=0;a<n;a++){var i=e.get_value_at(a);r.push(lt(i,t))}return r}(e,t);default:return st.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function lt(e,t){return ut.decodedWasmObjToQueryResponseObj(e,t)}function pt(e,t){var r=e.type_name,n=dt(e,t),a=e.get_id();return new Ze(Object.assign({typeName:r,id:a},n))}function dt(e,t){for(var r={},n=e.key_count(),a=0;a<n;a++)r[e.get_key_at(a)]=lt(e.get_value_at(a),t);return{properties:r}}function ct(e,t){var r=e.type_name,n=dt(e,t);return new Ee(Object.assign({typeName:r,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},n))}var yt=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).hasError=null,n.error=null,n.editResults=[],n}return(0,s.Z)(r)}(x.Z);(0,d._)([(0,v.Cb)()],yt.prototype,"hasError",void 0),(0,d._)([(0,v.Cb)()],yt.prototype,"error",void 0),(0,d._)([(0,v.Cb)()],yt.prototype,"editResults",void 0);var ht=yt=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],yt);function ft(e){var t=new ht;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});for(var r=e.get_edit_results_count(),n=0;n<r;n++){for(var a=e.get_edit_results_at(n),i=e.get_edit_results_type_name_at(n),o=[],s=[],u=[],l=a.get_add_results_count(),p=a.get_update_results_count(),d=a.get_delete_results_count(),c=0;c<l;c++){var y=a.get_add_result_at(c);o.push({id:y.id,error:{errorCode:y.error.error_code,errorMessage:y.error.error_message}})}for(var h=0;h<p;h++){var f=a.get_update_result_at(h);s.push({id:f.id,error:{errorCode:f.error.error_code,errorMessage:f.error.error_message}})}for(var v=0;v<d;v++){var m=a.get_delete_result_at(v);u.push({id:m.id,error:{errorCode:m.error.error_code,errorMessage:m.error.error_message}})}t.editResults.push({typeName:i,adds:o,updates:s,deletes:u})}return t}var vt={fetchKnowledgeGraph:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new re({url:t}),(n=[]).push(wt(r)),n.push(kt(r)),e.next=5,Promise.all(n);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refreshDataModel:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut(t);case 2:t.dataModel=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refreshServiceDefinition:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,R.default)(t.url,{query:{f:"json"}});case 2:return i=e.sent.data,e.abrupt("return",(i.capabilities=null===i||void 0===i||null===(r=i.capabilities)||void 0===r?void 0:r.split(","),i.supportedQueryFormats=null===i||void 0===i||null===(n=i.supportedQueryFormats)||void 0===n?void 0:n.split(","),t.serviceDefinition=new X(i),t.serviceDefinition));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),executeQueryStreaming:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(t.url,"/graph/query"),e.next=3,Tt(t);case 3:return e.next=5,jt(i,n);case 5:return o=e.sent,e.next=8,Gt(r,t);case 8:return o.data.body=e.sent,e.next=11,xt(o.data.url,o.data);case 11:if(s=e.sent,!t.dataModel){e.next=19;break}return e.t0=F,e.next=16,zt(s,t.dataModel);case 16:return e.t1=e.sent,e.t2={resultRowsStream:e.t1},e.abrupt("return",new e.t0(e.t2));case 19:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeApplyEdits:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(i=t.serviceDefinition)||void 0===i||!i.dataEditingNotSupported){e.next=2;break}throw new y.Z("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");case 2:return o="".concat(t.url,"/graph/applyEdits"),e.next=5,Tt(t);case 5:return e.next=7,jt(o,n);case 7:return s=e.sent,e.next=10,Lt(r,t);case 10:return s.data.body=e.sent,e.t0=Pt,e.next=14,xt(s.data.url,s.data);case 14:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 16:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeQuery:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s,u,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(t.url,"/graph/query"),e.next=3,(0,R.default)(o,{responseType:"array-buffer",query:(0,D.Z)({f:"pbf",openCypherQuery:r.openCypherQuery},null===n||void 0===n?void 0:n.query),signal:null===n||void 0===n?void 0:n.signal,timeout:null===n||void 0===n?void 0:n.timeout});case 3:if(s=e.sent,u=null===(i=s.getHeader)||void 0===i?void 0:i.call(s,"content-type"),l=s.data,null===u||void 0===u||!u.includes("application/x-protobuf")){e.next=14;break}return e.next=9,oe();case 9:if(e.t0=e.sent.GraphQueryDecoder,(p=new e.t0).deleteLater(),!t.dataModel){e.next=13;break}return e.abrupt("return",new N({resultRows:At(p,l,t.dataModel)}));case 13:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 14:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:u,data:s.data});case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeSearch:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s,u,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.typeCategoryFilter,s="".concat(t.url,"/graph/search"),e.next=4,(0,R.default)(s,{responseType:"array-buffer",query:(0,D.Z)({f:"pbf",searchQuery:'"'.concat(r.searchQuery,'"'),typeCategoryFilter:o},null===n||void 0===n?void 0:n.query),signal:null===n||void 0===n?void 0:n.signal,timeout:null===n||void 0===n?void 0:n.timeout});case 4:if(u=e.sent,l=null===(i=u.getHeader)||void 0===i?void 0:i.call(u,"content-type"),p=u.data,null===l||void 0===l||!l.includes("application/x-protobuf")){e.next=15;break}return e.next=10,oe();case 10:if(e.t0=e.sent.GraphQueryDecoder,(d=new e.t0).deleteLater(),!t.dataModel){e.next=14;break}return e.abrupt("return",new N({resultRows:At(d,p,t.dataModel)}));case 14:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 15:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:l,data:u.data});case 16:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeSearchStreaming:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(t.url,"/graph/search"),e.next=3,Tt(t);case 3:return e.next=5,jt(i,n);case 5:return o=e.sent,e.next=8,St(r);case 8:return o.data.body=e.sent,e.next=11,xt(o.data.url,o.data);case 11:if(s=e.sent,!t.dataModel){e.next=19;break}return e.t0=F,e.next=16,zt(s,t.dataModel);case 16:return e.t1=e.sent,e.t2={resultRowsStream:e.t1},e.abrupt("return",new e.t0(e.t2));case 19:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),_fetchWrapper:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,r));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()};function mt(e,t,r){return gt.apply(this,arguments)}function gt(){return gt=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vt.executeQueryStreaming(t,r,n));case 1:case"end":return e.stop()}}),e)}))),gt.apply(this,arguments)}function bt(){return bt=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vt.fetchKnowledgeGraph(t));case 1:case"end":return e.stop()}}),e)}))),bt.apply(this,arguments)}function wt(e){return _t.apply(this,arguments)}function _t(){return _t=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vt.refreshDataModel(t));case 1:case"end":return e.stop()}}),e)}))),_t.apply(this,arguments)}function kt(e){return Ct.apply(this,arguments)}function Ct(){return Ct=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vt.refreshServiceDefinition(t));case 1:case"end":return e.stop()}}),e)}))),Ct.apply(this,arguments)}function xt(e,t){return Zt.apply(this,arguments)}function Zt(){return Zt=(0,i.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vt._fetchWrapper(t,r));case 1:case"end":return e.stop()}}),e)}))),Zt.apply(this,arguments)}function Tt(e){return Et.apply(this,arguments)}function Et(){return Et=(0,i.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===G.id||void 0===G.id?void 0:G.id.findCredential(t.url),e.t0=r,e.t0){e.next=10;break}if(!t.dataModel){e.next=8;break}return e.next=6,Ut(t);case 6:e.next=10;break;case 8:return e.next=10,wt(t);case 10:case"end":return e.stop()}}),e)}))),Et.apply(this,arguments)}function Mt(e,t,r){if(0!==e.error_code)throw new y.Z(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function It(e,t,r,n){null==t?r.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?r.set_param_key_value(e,t):t instanceof ye.Z?r.set_param_key_value(e,ve(t,n)):t instanceof Array?r.set_param_key_value(e,he(t,n)):r.set_param_key_value(e,fe(t,n))}function Lt(e,t){return Dt.apply(this,arguments)}function Dt(){return Dt=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o,s,u,l,p,d,c,h,f,v,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.dataModel,e.t0){e.next=4;break}return e.next=4,wt(r);case 4:if(r.dataModel){e.next=6;break}throw new y.Z("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");case 6:return e.next=8,oe();case 8:s=e.sent,u=!(null===(n=t.options)||void 0===n||!n.cascadeDelete),(l=new s.GraphApplyEditsEncoder(s.SpatialReferenceUtil.WGS84(),null!==(i=t.options)&&void 0!==i&&i.inputQuantizationParameters?Ie(null===(o=t.options)||void 0===o?void 0:o.inputQuantizationParameters):s.InputQuantizationUtil.WGS84_lossless())).deleteLater(),l.cascade_delete=u,e.prev=12,null!==(p=t.entityAdds)&&void 0!==p&&p.forEach((function(e){Mt(l.add_entity(Me(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(d=t.relationshipAdds)&&void 0!==d&&d.forEach((function(e){if(!e.originId||!e.destinationId)throw new y.Z("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");Mt(l.add_relationship(Me(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(c=t.entityUpdates)&&void 0!==c&&c.forEach((function(e){if(!e.id)throw new y.Z("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");Mt(l.update_entity(Me(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(h=t.relationshipUpdates)&&void 0!==h&&h.forEach((function(e){if(!e.id)throw new y.Z("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");Mt(l.update_relationship(Me(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(f=t.entityDeletes)&&void 0!==f&&f.forEach((function(e){var t;if(!e.typeName)throw new y.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");var r=l.make_delete_helper(e.typeName,!0);r.deleteLater(),null===(t=e.ids)||void 0===t||t.forEach((function(e){r.delete_by_id(e)}))})),null!==(v=t.relationshipDeletes)&&void 0!==v&&v.forEach((function(e){var t;if(!e.typeName)throw new y.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");var r=l.make_delete_helper(e.typeName,!1);null===(t=e.ids)||void 0===t||t.forEach((function(e){r.delete_by_id(e)}))})),l.encode(),e.next=19;break;case 16:throw e.prev=16,e.t1=e.catch(12),new y.Z("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:e.t1});case 19:return m=l.get_encoding_result(),e.abrupt("return",(Mt(m.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),m.get_byte_buffer()));case 21:case"end":return e.stop()}}),e,null,[[12,16]])}))),Dt.apply(this,arguments)}function Gt(e,t){return Rt.apply(this,arguments)}function Rt(){return Rt=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o,s,u,l,p,d,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:if(n=e.sent,(i=new n.GraphQueryRequestEncoder).deleteLater(),i.output_spatial_reference=n.SpatialReferenceUtil.WGS84(),i.open_cypher_query=t.openCypherQuery,t.bindParameters)for(o=0,s=Object.entries(t.bindParameters);o<s.length;o++)u=(0,C.Z)(s[o],2),l=u[0],p=u[1],It(l,p,i,n);if(!t.bindGeometryQuantizationParameters){e.next=9;break}me(t.bindGeometryQuantizationParameters,i),e.next=16;break;case 9:if(e.t0=r.dataModel,e.t0){e.next=13;break}return e.next=13,wt(r);case 13:if(4326===(null===(d=r.dataModel)||void 0===d||null===(d=d.spatialReference)||void 0===d?void 0:d.wkid)){e.next=15;break}throw new y.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");case 15:i.input_quantization_parameters=n.InputQuantizationUtil.WGS84_lossless();case 16:t.outputQuantizationParameters&&ge(t.outputQuantizationParameters,i,n),e.prev=17,i.encode(),e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(17),new y.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:e.t1});case 24:if(0===(c=i.get_encoding_result()).error.error_code){e.next=27;break}throw new y.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:c.error.error_code,errorMessage:c.error.error_message});case 27:return e.abrupt("return",c.get_byte_buffer());case 28:case"end":return e.stop()}}),e,null,[[17,21]])}))),Rt.apply(this,arguments)}function St(e){return Nt.apply(this,arguments)}function Nt(){return Nt=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:if(n=e.sent,(i=new n.GraphSearchRequestEncoder).deleteLater(),i.search_query=t.searchQuery,i.type_category_filter=n.esriNamedTypeCategory[t.typeCategoryFilter],!0===t.returnSearchContext&&(i.return_search_context=t.returnSearchContext),null!=t.start&&t.start>0&&(i.start_index=t.start),null!=t.num&&(i.max_num_results=t.num),!(null!=t.idsFilter&&Array.isArray(t.idsFilter)&&t.idsFilter.length>0)){e.next=12;break}e.prev=5,i.set_ids_filter(he(t.idsFilter,n)),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(5),new y.Z("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:e.t0});case 12:null===(r=t.namedTypesFilter)||void 0===r||r.forEach((function(e){i.add_named_type_filter(e)})),e.prev=13,i.encode(),e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(13),new y.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:e.t1});case 20:if(0===(o=i.get_encoding_result()).error.error_code){e.next=23;break}throw new y.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});case 23:return e.abrupt("return",o.get_byte_buffer());case 24:case"end":return e.stop()}}),e,null,[[5,9],[13,17]])}))),Nt.apply(this,arguments)}function jt(e,t){return Ft.apply(this,arguments)}function Ft(){return Ft=(0,i.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,R.default)(t,{responseType:"native-request-init",method:"post",query:(0,D.Z)({f:"pbf"},null===r||void 0===r?void 0:r.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:null===r||void 0===r?void 0:r.signal,timeout:null===r||void 0===r?void 0:r.timeout}));case 1:case"end":return e.stop()}}),e)}))),Ft.apply(this,arguments)}function Pt(e){return Ot.apply(this,arguments)}function Ot(){return Ot=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=t.headers.get("content-type"))||void 0===r||!r.includes("application/x-protobuf")){e.next=10;break}return e.next=4,t.arrayBuffer();case 4:return n=e.sent,e.next=7,oe();case 7:return e.t0=e.sent.GraphApplyEditsDecoder,i=new e.t0,e.abrupt("return",(i.deleteLater(),i.decode(new Uint8Array(n)),ft(i)));case 10:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:t.text()});case 11:case"end":return e.stop()}}),e)}))),Ot.apply(this,arguments)}function At(e,t,r){e.push_buffer(new Uint8Array(t));for(var n=[],a=0;e.next_row();){a||(a=e.get_header_keys().size());for(var i=new Array(a),o=0;o<a;o++){var s=e.get_value(o);i[o]=lt(s,r)}n.push(i)}if(e.has_error())throw new y.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return n}function zt(e,t){return Qt.apply(this,arguments)}function Qt(){return Qt=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.headers.get("content-type"),t.headers.get("content-length")&&h.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),null===n||void 0===n||!n.includes("application/x-protobuf")){e.next=8;break}return s=null===(o=t.body)||void 0===o?void 0:o.getReader(),e.next=5,oe();case 5:return e.t0=e.sent.GraphQueryDecoder,u=new e.t0,e.abrupt("return",(u.deleteLater(),new ReadableStream({start:function(e){return(0,i.Z)((0,a.Z)().mark((function t(){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(){return null===s||void 0===s?void 0:s.read().then((function(t){var a,i=t.done,o=t.value;if(!i){var l=At(u,o,r);return l.length>0&&e.enqueue(l),n()}if(u.has_error()&&(a=new y.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:u.error.error_code,errorMessage:u.error.error_message})),s.releaseLock(),a)throw e.error(a),a;e.close()}))},t.prev=1,t.abrupt("return",n());case 5:t.prev=5,t.t0=t.catch(1),null!==s&&void 0!==s&&s.releaseLock(),e.error(new y.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:t.t0})),e.close();case 8:case"end":return t.stop()}}),t,null,[[1,5]])})))()}})));case 8:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:t.text()});case 9:case"end":return e.stop()}}),e)}))),Qt.apply(this,arguments)}function Ut(e){return qt.apply(this,arguments)}function qt(){return qt=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(t.url,"/dataModel/queryDataModel"),e.next=3,(0,R.default)(n,{responseType:"array-buffer",query:{f:"pbf"}});case 3:if(i=e.sent,o=null===(r=i.getHeader)||void 0===r?void 0:r.call(i,"content-type"),s=i.data,null===o||void 0===o||!o.includes("application/x-protobuf")){e.next=13;break}return e.next=9,oe();case 9:if(u=e.sent.decode_data_model_from_protocol_buffer(new Uint8Array(s))){e.next=12;break}throw new y.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");case 12:return e.abrupt("return",Ae(u));case 13:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:i.data});case 14:case"end":return e.stop()}}),e)}))),qt.apply(this,arguments)}var Yt=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).openCypherQuery="",n}return(0,s.Z)(r)}(x.Z);(0,d._)([(0,v.Cb)()],Yt.prototype,"openCypherQuery",void 0);var Ht=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).bindParameters=null,n.bindGeometryQuantizationParameters=null,n.outputQuantizationParameters=null,n}return(0,s.Z)(r)}(Yt=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQuery")],Yt));(0,d._)([(0,v.Cb)()],Ht.prototype,"bindParameters",void 0),(0,d._)([(0,v.Cb)()],Ht.prototype,"bindGeometryQuantizationParameters",void 0),(0,d._)([(0,v.Cb)()],Ht.prototype,"outputQuantizationParameters",void 0);var Bt=Ht=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],Ht),Jt=r(86638),Vt="ESRI__ID",Wt="ESRI__ORIGIN_ID",Kt="ESRI__DESTINATION_ID",$t="ESRI__LAYOUT_GEOMETRY",Xt=12,er=h.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager"),tr=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n,a,i,s;(0,o.Z)(this,r),(s=t.call(this,e)).inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},s.entityTypeNames=new Set,s.relationshipTypeNames=new Set,s.geographicLookup=new Map,s.sublayerCaches=new Map,s._processingCacheUpdatesLookup=new Map,s._memberIdTypeLookup=new Map;var u=new Map;return null!==(n=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==n&&n.forEach((function(t){var r,n;t.name&&(u.set(t.name,"entity"),s._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(r=e.inclusionModeDefinition)&&void 0!==r&&r.generateAllSublayers)||s.entityTypeNames.add(t.name),null===(n=t.properties)||void 0===n||n.forEach((function(e){var r;e.geometryType&&"esriGeometryNull"!==e.geometryType&&s.geographicLookup.set(t.name,{name:null!==(r=e.name)&&void 0!==r?r:"",geometryType:e.geometryType})})))})),null!==(a=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==a&&a.forEach((function(t){var r,n;t.name&&(u.set(t.name,"relationship"),s._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(r=e.inclusionModeDefinition)&&void 0!==r&&r.generateAllSublayers)||s.relationshipTypeNames.add(t.name),null===(n=t.properties)||void 0===n||n.forEach((function(e){var r;e.geometryType&&"esriGeometryNull"!==e.geometryType&&s.geographicLookup.set(t.name,{name:null!==(r=e.name)&&void 0!==r?r:"",geometryType:e.geometryType})})))})),null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.forEach((function(t,r){var n;if("entity"===u.get(r))s.entityTypeNames.add(r);else{var a;if("relationship"!==u.get(r))return er.warn("A named type, ".concat(r,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(a=e.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.delete(r));s.relationshipTypeNames.add(r)}var i=new Map;null!==(n=t.members)&&void 0!==n&&n.forEach((function(e){s._memberIdTypeLookup.set(e.id,r);var t=s.getById(e.id);t&&i.set(e.id,t)})),s.sublayerCaches.set(r,i)})),s}return(0,s.Z)(r,[{key:"addToLayerInclusionSet",value:function(e){var t=this;e.forEach((function(e){var r=e.typeName,n=e.id;if(!t.inclusionModeDefinition)throw new y.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(t.inclusionModeDefinition.namedTypeDefinitions.has(r)){if(t.inclusionModeDefinition.namedTypeDefinitions.has(r)){var a=t.inclusionModeDefinition.namedTypeDefinitions.get(r);if(a.useAllData)throw new y.Z("knowledge-graph:layer-data-manager","You cannot add members to an exclusion list for a sublayer where the sublayer is set to always retrieve its entire data set");a.members||(a.members=new Map),a.members.set(n,{id:n}),t._memberIdTypeLookup.set(n,r)}}else{var i=new Map;i.set(n,{id:n}),t.inclusionModeDefinition.namedTypeDefinitions.set(r,{useAllData:!1,members:i}),t._memberIdTypeLookup.set(n,r)}}))}},{key:"getById",value:function(e){return L.getInstance().readFromStoreById(e)}},{key:"getData",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s,u,l,p,d,c,y,h,f,v,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.objectType.name&&null!==(i=this.inclusionModeDefinition)&&void 0!==i&&i.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0)||this.inclusionModeDefinition.namedTypeDefinitions.has(r.objectType.name)){e.next=2;break}return e.abrupt("return",[]);case 2:if(o=t||new Jt.Z({where:"1=1",outFields:["*"]}),"link-chart"!==r.parentCompositeLayer.type){e.next=12;break}if(p=r.parentCompositeLayer,d=this._processingCacheUpdatesLookup.get(null!==(s=r.objectType.name)&&void 0!==s?s:""),c=o.outFields,y=o.geometry,h="",f="",y&&y.extent&&(h=(0,b.fC)(y.extent.ymin,y.extent.xmin,Xt),f=(0,b.fC)(y.extent.ymax,y.extent.xmax,Xt)),e.t0=c&&1===c.length&&c[0]===Vt&&"1=1"===o.where,e.t0){e.next=10;break}return e.next=10,Promise.all(null!==d&&void 0!==d?d:[]);case 10:return v=this.sublayerCaches.has(null!==(u=r.objectType.name)&&void 0!==u?u:"")?Array.from(null===(l=this.sublayerCaches.get(r.objectType.name))||void 0===l?void 0:l.values()):[],m=[],e.abrupt("return",(v.forEach((function(e){if(e.geometry=p.linkChartDiagramLookup.get(e.attributes[r.objectIdField]),e.attributes[$t]=e.geometry,h&&f){var t=p.linkChartGeohashLookup.get(e.attributes[r.objectIdField]);t?t>=h&&t<=f&&m.push(e):m.push(e)}else m.push(e)})),m));case 12:return e.abrupt("return",this.retrieveDataFromService(o,r,n));case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getConnectedRecordIds",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,o,s=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],n=[],o=new Map,t.forEach((function(e){if(s._memberIdTypeLookup.has(e)){var t,r=s._memberIdTypeLookup.get(e);if(!s.entityTypeNames.has(r))return;o.has(r)?null===(t=o.get(r))||void 0===t||t.push(e):o.set(r,[e])}})),o.forEach((function(e,t){var o="MATCH (n:".concat(t,")-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]"),u=new Promise((function(t){(0,i.Z)((0,a.Z)().mark((function t(){var n,i,u,l,p,d;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,mt(s.knowledgeGraph,new Bt({openCypherQuery:o,bindParameters:{ids:e}}));case 2:n=t.sent.resultRowsStream.getReader(),t.prev=3;case 4:return t.next=6,n.read();case 6:if(i=t.sent,u=i.done,l=i.value,!u){t.next=11;break}return t.abrupt("break",14);case 11:for(p=0;p<l.length;p++)d=l[p],r.push({id:d[0],typeName:d[1]}),r.push({id:d[2],typeName:d[3]});case 12:t.next=4;break;case 14:t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(3),"AbortError"===t.t0.name){t.next=20;break}throw t.t0;case 20:er.info("Request aborted as expected");case 21:case"end":return t.stop()}}),t,null,[[3,16]])})))().then((function(){t()}))}));n.push(u)})),e.next=5,Promise.all(n);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshCacheContent",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,o){var s,u,l,p,d,c,h,f,v,m,g,b,w,_=this,k=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=!(k.length>3&&void 0!==k[3])||k[3],h=L.getInstance(),f=[],v=new Map,m=new Map,null!==(s=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((function(e){e.name&&m.set(e.name,e)})),null!==(u=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){e.name&&m.set(e.name,e)})),t||this.inclusionModeDefinition?t?t.forEach((function(e){if(_._memberIdTypeLookup.has(e)){var t,r=_._memberIdTypeLookup.get(e);v.has(r)?null===(t=v.get(r))||void 0===t||t.push(e):v.set(r,[e])}})):null===(l=this.inclusionModeDefinition)||void 0===l||null===(l=l.namedTypeDefinitions)||void 0===l||l.forEach((function(e,t){e.useAllData?v.set(t,null):e.members&&e.members.forEach((function(e){var r;v.has(t)&&null!==v.get(t)?null===(r=v.get(t))||void 0===r||r.push(e.id):v.set(t,[e.id])}))})):(null!==(p=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==p&&p.forEach((function(e){e.name&&v.set(e.name,null)})),null===(d=this.knowledgeGraph.dataModel.entityTypes)||void 0===d||d.forEach((function(e){e.name&&v.set(e.name,null)}))),g=(0,n.Z)(v),e.prev=4,w=(0,a.Z)().mark((function e(){var t,n,s,u,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,C.Z)(b.value,2),s=n[0],u=n[1],l=new Promise((function(e){var t=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,i,l,p,d,f,v,g,b;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Set,i=[],p="",d=!1,r||null!==(t=m.get(s))&&void 0!==t&&null!==(t=t.properties)&&void 0!==t&&t.forEach((function(e){e.name&&n.add(e.name)})),o&&_.geographicLookup.has(s)&&(v=null===(f=_.geographicLookup.get(s))||void 0===f?void 0:f.name)&&n.add(v),!_.entityTypeNames.has(s)){e.next=7;break}p="MATCH (n:".concat(s,") ").concat(u?"WHERE id(n) IN $ids ":"","return ID(n)"),n.forEach((function(e){p+=", n.".concat(e),i.push(e)})),e.next=10;break;case 7:if(_.relationshipTypeNames.has(s)){e.next=9;break}throw new y.Z("knowledge-graph:layer-data-manager","The graph type of ".concat(s," could not be determined. Was this type set in the KG data model and inclusion definition?"));case 9:d=!0,p="MATCH ()-[n:".concat(s,"]->() ").concat(u?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),n.forEach((function(e){p+=", n.".concat(e),i.push(e)}));case 10:return l=new Bt(u?{openCypherQuery:p,bindParameters:{ids:u}}:{openCypherQuery:p}),e.next=13,mt(_.knowledgeGraph,l);case 13:g=e.sent.resultRowsStream.getReader(),b=(0,a.Z)().mark((function e(){var t,r,n,o,u,l,p,y,f,v,m,b,w,k,C;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.read();case 2:if(u=e.sent,l=u.done,p=u.value,!l){e.next=7;break}return e.abrupt("return",1);case 7:for(y=[],f=0;f<p.length;f++){for(v=p[f],b=0,(w={properties:{}}).id=v[m=0],m++,b++,d&&(w.originId=v[m],m++,b++,w.destinationId=v[m],m++,b++);m<v.length;m++)w.properties[i[m-b]]=v[m];y.push(w)}k=h.writeToStore(y,Vt,null===(t=_.geographicLookup.get(s))||void 0===t?void 0:t.name),_.sublayerCaches.has(s)||_.sublayerCaches.set(s,new Map),c&&!(null!==(r=_.inclusionModeDefinition)&&void 0!==r&&r.namedTypeDefinitions.has(s))&&null!==(n=_.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.set(s,{useAllData:!1,members:new Map}),c&&(null===(o=_.inclusionModeDefinition)||void 0===o||!o.namedTypeDefinitions.get(s).members)&&(_.inclusionModeDefinition.namedTypeDefinitions.get(s).members=new Map),C=_.sublayerCaches.get(s),k.forEach((function(e){var t,r;null!==C&&void 0!==C&&C.set(e.attributes[Vt],e),c&&(null===(t=_.inclusionModeDefinition)||void 0===t||!t.namedTypeDefinitions.get(s).members.has(e.attributes[Vt]))&&(null!==(r=_.inclusionModeDefinition)&&void 0!==r&&r.namedTypeDefinitions.get(s).members.set(e.attributes[Vt],{id:e.attributes[Vt]}),_._memberIdTypeLookup.set(e.attributes[Vt],s))}));case 13:case"end":return e.stop()}}),e)}));case 15:return e.delegateYield(b(),"t0",16);case 16:if(!e.t0){e.next=18;break}return e.abrupt("break",20);case 18:e.next=15;break;case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t().then((function(){e(null)}))})),f.push(l),null===(t=_._processingCacheUpdatesLookup.get(s))||void 0===t||t.push(l);case 3:case"end":return e.stop()}}),e)})),g.s();case 7:if((b=g.n()).done){e.next=11;break}return e.delegateYield(w(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),g.e(e.t1);case 16:return e.prev=16,g.f(),e.finish(16);case 19:return e.next=21,Promise.all(f);case 21:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"removeFromLayer",value:function(e){var t=this,r=new Set;e.forEach((function(e){var n;t._memberIdTypeLookup.get(e)&&r.add(t._memberIdTypeLookup.get(e)),t._memberIdTypeLookup.delete(e),null===(n=t.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.forEach((function(t){var r;(null===(r=t.members)||void 0===r?void 0:r.has(e))&&t.members.delete(e)}))})),r.forEach((function(r){var n;null===(n=t.sublayerCaches.get(r))||void 0===n||n.forEach((function(n,a){var i;e.includes(a)&&(null===(i=t.sublayerCaches.get(r))||void 0===i||i.delete(a))}))}))}},{key:"retrieveDataFromService",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s,u,l,p,d,c,y,h,f,v,m,g,b,w,_,k,C,x,I,D,G,R,S,N,j,F,P,O,A,z,Q,U,q,Y,H,B,J,V,W,K;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=L.getInstance(),l=new Set,p=[],c="",y=[],h="relationship"===r.graphType,f=null===(i=this.inclusionModeDefinition)||void 0===i||null===(i=i.namedTypeDefinitions)||void 0===i||null===(i=i.get(r.objectType.name))||void 0===i?void 0:i.useAllData,v=r.parentCompositeLayer.sublayerIdsCache.get(r.objectType.name),m=!f&&v?Array.from(v).sort():null,null===(o=this.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||null===(o=o.get(r.objectType.name))||void 0===o||!o.useAllData){e.next=8;break}(null===(s=this.inclusionModeDefinition)||void 0===s||null===(s=s.namedTypeDefinitions)||void 0===s||null===(s=s.get(r.objectType.name))||void 0===s?void 0:s.useAllData)&&null!=t.objectIds&&(m=t.objectIds),e.next=20;break;case 8:if(!(null!=t.objectIds&&m&&m.length>0)){e.next=13;break}g=t.objectIds,t.objectIds=m.filter((function(e){return g.includes(e)})),e.next=20;break;case 13:if(null==t.objectIds){e.next=17;break}m=t.objectIds,e.next=20;break;case 17:if(null===(b=this.inclusionModeDefinition)||void 0===b||!b.namedTypeDefinitions.has(r.objectType.name)||null!==(w=this.inclusionModeDefinition.namedTypeDefinitions.get(r.objectType.name))&&void 0!==w&&w.members&&!((null===(_=this.inclusionModeDefinition.namedTypeDefinitions.get(r.objectType.name))||void 0===_||null===(_=_.members)||void 0===_?void 0:_.size)<1)){e.next=19;break}return e.abrupt("return",(t.objectIds=[],[]));case 19:t.objectIds=m;case 20:if(null!=t.outFields&&((k=t.outFields).includes("*")?r.fields.forEach((function(e){l.add(e.name)})):k.forEach((function(e){e!==Vt&&e!==r.geometryFieldName&&l.add(e)}))),null==t.geometry){e.next=38;break}if(null===(I=t.geometry)||void 0===I||null===(C=I.extent)||void 0===C||!C.spatialReference||null!==(x=I.spatialReference)&&void 0!==x&&x.isWGS84){e.next=29;break}return e.next=26,(0,E.initializeProjection)(I.extent.spatialReference,M.Zn);case 26:D=(0,E.project)(I.extent,M.Zn),e.next=30;break;case 29:D=I.extent;case 30:if(null==t.where||"1=1"===t.where){e.next=35;break}return e.next=33,(0,Z.E)(t.where.toUpperCase(),r.fieldsIndex);case 33:G=e.sent,r.fields.forEach((function(e){G.fieldNames.includes(e.name)&&l.add(e.name)}));case 35:c=h?"Match ()-[n:".concat(r.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(r.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(r.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(r.geometryFieldName,") return ID(n)"),r.geometryFieldName&&l.add(r.geometryFieldName),l.forEach((function(e){c+=", n.".concat(e),p.push(e)})),d=new Bt({openCypherQuery:c,bindParameters:{param_filter_geom:new T.Z({rings:[[[D.xmin,D.ymin],[D.xmin,D.ymax],[D.xmax,D.ymax],[D.xmax,D.ymin],[D.xmin,D.ymin]]]})}}),e.next=52;break;case 38:if(R="",null==t.where||"1=1"===t.where){e.next=48;break}return e.next=42,(0,Z.E)(t.where,r.fieldsIndex);case 42:S=e.sent,r.fields.forEach((function(e){S.fieldNames.includes(e.name)&&l.add(e.name)})),N=["column-reference","string","number","binary-expression"],j=["=","<","<=","<>",">",">=","AND","OR","LIKE"],F=!1,P=function e(t){if("column-reference"===t.type)return"n.".concat(t.column);if("string"===t.type)return"'".concat(t.value,"'");if("number"===t.type)return"".concat(t.value);if("binary-expression"===t.type&&N.includes(t.left.type)&&N.includes(t.right.type)&&j.includes(t.operator))return"".concat(e(t.left)," ").concat(t.operator," ").concat(e(t.right));if("binary-expression"===t.type&&"LIKE"===t.operator){var r="";if("function"===t.left.type&&"column-reference"===t.left.args.value[0].type)r+="lower(n.".concat(t.left.args.value[0].column,")");else{if("column-reference"!==t.left.type)return F=!0,"";r+="lower(n.".concat(t.left.column,")")}if(r+=" CONTAINS (","string"!==t.right.type)return F=!0,"";var n=t.right.value;return"%"===n.charAt(0)&&(n=n.slice(1)),"%"===n.charAt(n.length-1)&&(n=n.slice(0,-1)),r+="'".concat(n.toLowerCase(),"')")}return F=!0,""},R=P(S.parseTree),F&&(R="");case 48:O="",O=h?"Match ()-[n:".concat(r.objectType.name,"]->()"):"Match (n:".concat(r.objectType.name,")"),A=!1,m&&(A=!0,O+=" WHERE ID(n) IN $ids"),R&&(O+=A?" AND":" WHERE",O+=" ".concat(R)),O+=" return ID(n)",h&&(O+=", id(startNode(n)), id(endNode(n))"),t.returnGeometry&&r.geometryFieldName&&l.add(r.geometryFieldName),l.forEach((function(e){O+=", n.".concat(e),p.push(e)})),d=new Bt(m?{openCypherQuery:O,bindParameters:{ids:m}}:{openCypherQuery:O});case 52:return e.next=54,mt(r.parentCompositeLayer.dataManager.knowledgeGraph,d,n);case 54:z=e.sent.resultRowsStream.getReader();case 55:return e.next=57,z.read();case 57:if(U=e.sent,q=U.done,Y=U.value,!q){e.next=62;break}return e.abrupt("break",67);case 62:for(H=[],B=0;B<Y.length;B++){for(J=Y[B],W=0,(K={properties:{}}).id=J[V=0],V++,W++,h&&(K.originId=J[V],V++,W++,K.destinationId=J[V],V++,W++);V<J.length;V++)K.properties[p[V-W]]=J[V];H.push(K)}y=y.concat(u.writeToStore(H,Vt,null===(Q=r.parentCompositeLayer.dataManager.geographicLookup.get(r.objectType.name))||void 0===Q?void 0:Q.name));case 65:e.next=55;break;case 67:return e.abrupt("return",y);case 68:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(x.Z);(0,d._)([(0,v.Cb)()],tr.prototype,"knowledgeGraph",void 0),(0,d._)([(0,v.Cb)()],tr.prototype,"inclusionModeDefinition",void 0),(0,d._)([(0,v.Cb)()],tr.prototype,"entityTypeNames",void 0),(0,d._)([(0,v.Cb)()],tr.prototype,"relationshipTypeNames",void 0),(0,d._)([(0,v.Cb)()],tr.prototype,"geographicLookup",void 0),(0,d._)([(0,v.Cb)()],tr.prototype,"sublayerCaches",void 0),tr=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],tr);var rr=r(93433),nr=r(44055),ar=(r(94931),r(78451),r(98689),r(57823),r(32066),r(49018),r(34999),r(28189),r(9014)),ir=r(40464),or=(r(31009),r(97114)),sr=r(27011),ur=r(63543),lr=(0,r(25610).v)(),pr=r(6693),dr=r(64390),cr=r(71684),yr=r(56811),hr=r(83040),fr=r(37270),vr=r(49818),mr=r(81085),gr=r(82485),br=r(53866),wr=r(27823),_r=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n,a,i,s,l;if((0,o.Z)(this,r),(l=t.call(this,e)).capabilities=(0,ur.MS)(!1,!1),l.definitionExpression="",l.displayField="",l.elevationInfo=null,l.geometryType=null,l.geometryFieldName=null,l.graphType=null,l.hasM=!1,l.hasZ=!1,l.labelsVisible=null,l.labelingInfo=null,l.objectIdField=Vt,l.objectType=null,l.parentCompositeLayer=null,l.popupTemplate=null,l.source={openPorts:function(){return l.load().then((function(){var e=new MessageChannel;return new gr.Z(e.port1,{channel:e,client:{queryFeatures:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Jt.Z.fromJSON(e);return l.queryFeaturesJSON(r,t)}}},(function(){return null})),[e.port2]}))}},l.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?l.geometryType="polyline":l.geometryType="point",l.geometryFieldName=$t;else if(null!==(n=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))&&void 0!==n&&n.geometryType&&"esriGeometryNull"!==(null===(a=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))||void 0===a?void 0:a.geometryType)){var p,d,c,y,h=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);l.geometryFieldName=null!==(p=null===h||void 0===h?void 0:h.name)&&void 0!==p?p:null,l.geometryType=null!==h&&void 0!==h&&h.geometryType?wr.M.fromJSON(h.geometryType):null;var f=null===h||void 0===h?void 0:h.name,v=f?null===(d=e.objectType.properties)||void 0===d?void 0:d[f]:null;v?(l.hasM=null!==(c=v.hasM)&&void 0!==c&&c,l.hasZ=null!==(y=v.hasZ)&&void 0!==y&&y):(l.hasM=!1,l.hasZ=!1)}else l.geometryType=null;return null!==(i=e.objectType.properties)&&void 0!==i&&i.forEach((function(e){var t=e.fieldType;"esriFieldTypeOID"===t&&(t="esriFieldTypeInteger"),l.fields.push(hr.Z.fromJSON({name:e.name,type:t,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),l.fields.push(hr.Z.fromJSON({name:l.objectIdField,type:"esriFieldTypeString",alias:l.objectIdField,editable:!1})),l._set("fields",(0,rr.Z)(l.fields)),null!==(s=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)&&void 0!==s&&s.spatialReference&&(l.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?l.renderer=(0,ar.i)((0,ur.bU)(wr.M.toJSON("polyline")).renderer):l.renderer=(0,ar.i)((0,ur.bU)(wr.M.toJSON("point")).renderer):l.renderer=(0,ar.i)((0,ur.bU)(wr.M.toJSON(l.geometryType)).renderer),(0,u.Z)(l)}return(0,s.Z)(r,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){(0,fr.YN)(e,this.fieldsIndex),this._set("renderer",e)}},{key:"createPopupTemplate",value:function(e){return(0,mr.eZ)(this,e)}},{key:"createQuery",value:function(){return new Jt.Z({where:"1=1",outFields:["*"]})}},{key:"getField",value:function(e){for(var t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}},{key:"getFieldDomain",value:function(e,t){return null}},{key:"queryFeatures",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o,s,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return n=e.sent,i=n.resolvedQuery,o=n.queryEngine,e.t0=vr.Z,e.next=8,o.executeQuery(i.toJSON(),null===r||void 0===r?void 0:r.signal);case 8:return e.t1=e.sent,s=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(s.features.forEach((function(e){e.sourceLayer=u})),s));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return n=e.sent,i=n.resolvedQuery,o=n.queryEngine,e.next=7,o.executeQuery(i.toJSON(),null===r||void 0===r?void 0:r.signal);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return n=e.sent,i=n.resolvedQuery,o=n.queryEngine,e.abrupt("return",o.executeQueryForCount(i.toJSON(),null===r||void 0===r?void 0:r.signal));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,n,i,o,s,u,l,p,d,c,y,h=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=h.length>0&&void 0!==h[0]?h[0]:{},s=h.length>1?h[1]:void 0,u=(0,D.Z)((0,D.Z)({},o),{},{returnGeometry:!0}),e.next=5,this._setupQueryObjects(u);case 5:return l=e.sent,p=l.resolvedQuery,d=l.queryEngine,e.next=10,d.executeQueryForExtent(p.toJSON(),null===s||void 0===s?void 0:s.signal);case 10:return c=e.sent,e.abrupt("return",(y=null!=(null===(t=c.extent)||void 0===t?void 0:t.xmin)&&null!=(null===(r=c.extent)||void 0===r?void 0:r.xmax)&&null!=(null===(n=c.extent)||void 0===n?void 0:n.ymin)&&null!=(null===(i=c.extent)||void 0===i?void 0:i.ymax)?new br.Z(c.extent):new br.Z,{count:c.count,extent:y}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Jt.Z.from(t),"link-chart"!==this.parentCompositeLayer.type||!this._cachedQueryEngine){e.next=5;break}i=this._cachedQueryEngine,e.next=9;break;case 5:return e.next=7,this.parentCompositeLayer.dataManager.getData(n,this,r);case 7:o=e.sent,i=this.loadQueryEngine(o);case 9:return e.abrupt("return",i.executeQueryForIds(n.toJSON(),null===r||void 0===r?void 0:r.signal));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"loadQueryEngine",value:function(e){var t=new or.Z({geometryType:wr.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new sr.q({fields:this.fields.map((function(e){return e.toJSON()})),geometryType:wr.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return r.featureStore.addMany(e),r}},{key:"refreshCachedQueryEngine",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentCompositeLayer.dataManager.getData(new Jt.Z({where:"1=1",outFields:[Vt]}),this);case 2:t=e.sent,this._cachedQueryEngine=this.loadQueryEngine(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setupQueryObjects",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Jt.Z.from(t),o=i.geometry,e.t0=o&&!(null!==(n=o.spatialReference)&&void 0!==n&&n.isWGS84),!e.t0){e.next=6;break}return e.next=5,(0,E.initializeProjection)(o.spatialReference,M.Zn);case 5:i.geometry=(0,E.project)(o instanceof T.Z||o instanceof ce.Z?o:o.extent,M.Zn);case 6:if("link-chart"!==this.parentCompositeLayer.type||!this._cachedQueryEngine){e.next=10;break}s=this._cachedQueryEngine,e.next=14;break;case 10:return e.next=12,this.parentCompositeLayer.dataManager.getData(i,this,r);case 12:u=e.sent,s=this.loadQueryEngine(u);case 14:return e.abrupt("return",{resolvedQuery:i,queryEngine:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}((0,dr.M)(function(e){var t=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).fields=[],e.fieldsIndex=null,e}return(0,s.Z)(r)}(e);return(0,d._)([(0,v.Cb)(lr.fields)],t.prototype,"fields",void 0),(0,d._)([(0,v.Cb)(lr.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,d._)([(0,g.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t}((0,pr.h)((0,yr.M)((0,cr.Q)(w.Z))))));(0,d._)([(0,v.Cb)()],_r.prototype,"capabilities",void 0),(0,d._)([(0,v.Cb)({readOnly:!0})],_r.prototype,"defaultPopupTemplate",null),(0,d._)([(0,v.Cb)()],_r.prototype,"definitionExpression",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"displayField",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"elevationInfo",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"geometryType",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"geometryFieldName",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"graphType",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"hasM",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"hasZ",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"labelsVisible",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"labelingInfo",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"objectIdField",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"objectType",void 0),(0,d._)([(0,v.Cb)()],_r.prototype,"parentCompositeLayer",void 0),(0,d._)([(0,v.Cb)({type:nr.Z,json:{name:"popupInfo",write:!0}})],_r.prototype,"popupTemplate",void 0),(0,d._)([(0,v.Cb)({types:ir.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],_r.prototype,"renderer",null),(0,d._)([(0,v.Cb)()],_r.prototype,"source",void 0),(0,d._)([(0,v.Cb)({json:{read:!1}})],_r.prototype,"type",void 0);var kr,Cr,xr=_r=(0,d._)([(0,g.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],_r),Zr=null;function Tr(){return kr||(kr=r.e(662).then(r.bind(r,39672)).then((function(e){return e.l})).then((function(e){return(0,e.default)({locateFile:function(e){return(0,ne.V)("esri/libs/linkchartlayout/".concat(e))}})})).then((function(e){!function(e){Zr=e}(e)})),kr)}function Er(e,t,r,n,a,i){var o=r.length,s=a.length,u=Float64Array.BYTES_PER_ELEMENT,l=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,d=15+o*(p+2*u)+s*(2*l),c=Zr._malloc(d);try{var y=c+16-c%16,h=y+o*u,f=h+o*u,v=f+s*l,m=v+s*l,g=function(){return[Zr.HEAPF64.subarray(y>>3,(y>>3)+o),Zr.HEAPF64.subarray(h>>3,(h>>3)+o),Zr.HEAPU32.subarray(f>>2,(f>>2)+s),Zr.HEAPU32.subarray(v>>2,(v>>2)+s),Zr.HEAPU8.subarray(m,m+o)]},b=g(),w=(0,C.Z)(b,5),_=w[0],k=w[1],x=w[2],Z=w[3],T=w[4];_.set(r),k.set(n),x.set(a),Z.set(i),T.set(t);var E=e(o,m,y,h,s,f,v),M=g(),I=(0,C.Z)(M,5),L=I[0],D=I[1],G=I[2],R=I[3],S=I[4];return r.set(L),n.set(D),a.set(G),i.set(R),t.set(S),E}finally{Zr._free(c)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(Cr||(Cr={}));var Mr,Ir,Lr,Dr,Gr,Rr,Sr,Nr;!function(e){e.getMinIdealEdgeLength=function(){return Zr.getMinIdealEdgeLength()},e.apply=function(e,t,r,n,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Er((function(e,t,r,n,a,u,l){return Zr.applyForceDirectedLayout(e,t,r,n,a,u,l,i,o,s)}),e,t,r,n,a)}}(Mr||(Mr={})),function(e){e.apply=function(e,t,r,n,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Er((function(e,t,r,n,a,u,l){return Zr.applyCommunityLayout(e,t,r,n,a,u,l,i,o,s)}),e,t,r,n,a)}}(Ir||(Ir={})),function(e){e.apply=function(e,t,r,n,a){return Er(Zr.applySimpleLayout,e,t,r,n,a)}}(Lr||(Lr={})),function(e){e.apply=function(e,t,r,n,a){return Er(Zr.applyHierarchicalLayout,e,t,r,n,a)}}(Dr||(Dr={})),function(e){e.apply=function(e,t,r,n,a){return Er(Zr.applyRadialTreeLayout,e,t,r,n,a)}}(Gr||(Gr={})),function(e){e.apply=function(e,t,r,n,a){return Er(Zr.applySmartTreeLayout,e,t,r,n,a)}}(Rr||(Rr={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Sr||(Sr={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Nr||(Nr={}));var jr=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;if((0,o.Z)(this,r),(n=t.call(this,e)).dataPreloadedInLocalCache=!1,n._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},n._graphTypeLookup=new Map,n.layers=new c.Z,n.linkChartDiagramLookup=new Map,n.linkChartExtent=new br.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),n.linkChartGeohashLookup=new Map,n.sublayerIdsCache=new Map,n.tables=new c.Z,n.type="link-chart",n._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new y.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it");return(0,u.Z)(n)}return(0,s.Z)(r,[{key:"normalizeCtorArgs",value:function(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}},{key:"_initializeLayerProperties",value:function(e){var t,r,n,a,i,o,s,u,l,p,d=this;if(!this.title&&this.url){var c=this.url.split("/");this.title=c[c.length-2]}var f=new Set,v=[],m=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new y.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((function(e){e.name&&d._graphTypeLookup.set(e.name,e)})),null!==(r=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==r&&r.forEach((function(e){e.name&&d._graphTypeLookup.set(e.name,e)})),null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers?(v=null!==(a=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==a?a:[],m=null!==(i=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==i?i:[]):null!==(o=e.inclusionModeDefinition)&&void 0!==o&&o.namedTypeDefinitions&&(null===(s=e.inclusionModeDefinition)||void 0===s?void 0:s.namedTypeDefinitions.size)>0?null===(u=e.inclusionModeDefinition)||void 0===u||u.namedTypeDefinitions.forEach((function(t,r){var n,a;if(!d._graphTypeLookup.get(r))return h.Z.getLogger(d).warn("A named type, ".concat(r,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(n=e.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.delete(r));d._graphTypeLookup.get(r)instanceof V||"strictOrigin"in d._graphTypeLookup.get(r)?f.has(r)||(f.add(r),m.push(d._graphTypeLookup.get(r))):d._graphTypeLookup.get(r)instanceof B||"properties"in d._graphTypeLookup.get(r)?f.has(r)||(f.add(r),v.push(d._graphTypeLookup.get(r))):(h.Z.getLogger(d).warn("A named type, ".concat(r,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(a=e.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.delete(r))})):(v=null!==(l=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==l?l:[],m=null!==(p=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==p?p:[]);var g=new tr({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=v,this.memberRelationshipTypes=m,this.dataManager=g}},{key:"load",value:function(e){var t=this;return this.addResolvingPromise(new Promise((function(r){(function(e){return bt.apply(this,arguments)})(t.url).then((function(n){var o,s,u,l;if(t._initializeLayerProperties({knowledgeGraph:n,inclusionModeDefinition:t._originalInclusionList}),null!==(o=t.dataManager.inclusionModeDefinition)&&void 0!==o&&null!==(o=o.namedTypeDefinitions)&&void 0!==o&&o.size||(t.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(s=t.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((function(e){var r;e.name&&(null===(r=t.dataManager.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.set(e.name,{useAllData:!0}))})),null!==(u=t.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){var r;e.name&&(null===(r=t.dataManager.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.set(e.name,{useAllData:!0}))}))),t.dataPreloadedInLocalCache)t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(l=t.dataManager.inclusionModeDefinition)||void 0===l||l.namedTypeDefinitions.forEach((function(e){var r;e.useAllData=!1,null!==(r=e.members)&&void 0!==r&&r.forEach((function(e){var r;r=e.linkChartLocation instanceof k.Z?e.linkChartLocation:e.linkChartLocation?(0,_.GH)(e.linkChartLocation):null,t.linkChartDiagramLookup.set(e.id,r),r&&2===r.coords.length&&0===r.lengths.length?t.linkChartGeohashLookup.set(e.id,(0,b.fC)(r.coords[1],r.coords[0],Xt)):t.linkChartGeohashLookup.set(e.id,"")})),t.addResolvingPromise(t._initializeDiagram().then((0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.layers.forEach(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.tables.forEach(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))))}));else{var p,d="GEOGRAPHIC"===(null===(p=t.defaultLinkChartConfig)||void 0===p?void 0:p.layoutMode);t.addResolvingPromise(t.dataManager.refreshCacheContent(void 0,!1,d,!0).then((0,i.Z)((0,a.Z)().mark((function r(){var n,i;return(0,a.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(0,f.k_)(e),n=[],i=[],t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((function(e){e.useAllData=!1}))),r.next=6,t._initializeDiagram();case 6:return t.layers.forEach((function(e){i.push(e.refreshCachedQueryEngine()),n.push(new Promise((function(t){e.on("layerview-create",(function(){t(null)}))})))})),t.tables.forEach((function(e){i.push(e.refreshCachedQueryEngine())})),r.next=10,Promise.all(i);case 10:case"end":return r.stop()}}),r)})))))}r(null)}))}))),Promise.resolve(this)}},{key:"addRecords",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._handleNewRecords(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"expand",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.getConnectedRecordIds(t);case 2:return r=e.sent,n=r.filter((function(e){var t;return!(null!==(t=i.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))})),e.next=6,this._handleNewRecords(r);case 6:return e.abrupt("return",{records:n});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadLayerAssumingLocalCache",value:function(){var e,t,r=this;this.memberRelationshipTypes.forEach((function(e){var t=new xr({objectType:e,parentCompositeLayer:r,graphType:"relationship",title:e.name});t.geometryType?r.layers.push(t):r.tables.push(t),r.dataManager.sublayerCaches.has(e.name)||r.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((function(e){var t=new xr({objectType:e,parentCompositeLayer:r,graphType:"entity",title:e.name});t.geometryType?r.layers.push(t):r.tables.push(t),r.dataManager.sublayerCaches.has(e.name)||r.dataManager.sublayerCaches.set(e.name,new Map)})),(null===(e=this.dataManager.inclusionModeDefinition)||void 0===e?void 0:e.namedTypeDefinitions)&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.forEach((function(e,t){var n,a=function(e,t,r){return e.has(t)||e.set(t,r()),e.get(t)}(r.sublayerIdsCache,t,(function(){return new Set}));null===(n=e.members)||void 0===n||n.forEach((function(e){if(a.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof k.Z)r.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?r.linkChartGeohashLookup.set(e.id,(0,b.fC)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],Xt)):r.linkChartGeohashLookup.set(e.id,"");else{var t=(0,_.GH)(e.linkChartLocation);r.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?r.linkChartGeohashLookup.set(e.id,(0,b.fC)(e.linkChartLocation.x,e.linkChartLocation.y,Xt)):r.linkChartGeohashLookup.set(e.id,"")}}))})))}},{key:"calculateLinkChartLayout",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,n,i,o,s,u,l,p,d,c,f,v,m,g,w,k,C,x,Z,T,E,M,I,L,D,G,R=this,S=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=S.length>0&&void 0!==S[0]?S[0]:"RADIAL_TREE",i=S.length>1?S[1]:void 0,o=[],s=[],this.dataManager.sublayerCaches.forEach((function(e,t){R.dataManager.entityTypeNames.has(t)?e.forEach((function(e){o.push({typeName:t,feature:e})})):R.dataManager.relationshipTypeNames.has(t)&&e.forEach((function(e){s.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map,u=new Map,l=new Map,p=new Map,d=new Map,c=new Uint8Array(o.length),f=new Float64Array(o.length),v=new Float64Array(o.length),m=new Uint32Array(s.length),g=new Uint32Array(s.length),w=[],"FORCE_DIRECTED",k=null!==(t=null===i||void 0===i?void 0:i.xScaleFactor)&&void 0!==t?t:1,C=null!==(r=null===i||void 0===i?void 0:i.yScaleFactor)&&void 0!==r?r:1,x=new br.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),"FORCE_DIRECTED",T=0,E=0,e.t0="GEOGRAPHIC"===n?"FORCE_DIRECTED":n,e.next="FORCE_DIRECTED"===e.t0?9:"COMMUNITY"===e.t0?11:"HIERARCHICAL"===e.t0?13:"RADIAL_TREE"===e.t0?15:"SMART_TREE"===e.t0?17:19;break;case 9:return Z=Mr.apply,e.abrupt("break",20);case 11:return Z=Ir.apply,e.abrupt("break",20);case 13:return Z=Dr.apply,e.abrupt("break",20);case 15:return Z=Gr.apply,e.abrupt("break",20);case 17:return Z=Rr.apply,e.abrupt("break",20);case 19:Z=Lr.apply;case 20:return o.forEach((function(e){var t,r,a,o,s,u,l=e.typeName,p=e.feature;if(null!==i&&void 0!==i&&null!==(t=i.lockedNodeLocations)&&void 0!==t&&t.has(p.attributes[Vt])){"GEOGRAPHIC"===n&&R.dataManager.geographicLookup.has(l)?c[T]=Cr.IsGeographic:c[T]=Cr.None;var y=i.lockedNodeLocations.get(p.attributes[Vt]);f[T]=y.x,v[T]=y.y}else if("GEOGRAPHIC"===n&&R.dataManager.geographicLookup.has(l)){var h;c[T]=Cr.IsGeographic;var m=null,g=p.attributes[R.dataManager.geographicLookup.get(l).name];switch(null===(h=R.dataManager.geographicLookup.get(l))||void 0===h?void 0:h.geometryType){case"esriGeometryPoint":f[T]=null===g||void 0===g?void 0:g.x,v[T]=null===g||void 0===g?void 0:g.y;break;case"esriGeometryPolygon":null!=(null===(r=m=null===g||void 0===g?void 0:g.centroid)||void 0===r?void 0:r.x)&&null!=(null===(a=m)||void 0===a?void 0:a.y)?(f[T]=m.x,v[T]=m.y):c[T]=Cr.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":null!=(null===(s=m=null===g||void 0===g||null===(o=g.extent)||void 0===o?void 0:o.center)||void 0===s?void 0:s.x)&&null!=(null===(u=m)||void 0===u?void 0:u.y)?(f[T]=m.x,v[T]=m.y):c[T]=Cr.IsMovable;break;default:c[T]=Cr.IsMovable}(null==f[T]||null==v[T]||Number.isNaN(f[T])||Number.isNaN(v[T]))&&(c[T]=Cr.IsMovable,f[T]=0,v[T]=0)}else c[T]=Cr.IsMovable,f[T]=0,v[T]=0;d.set(p.attributes[Vt],T),w[T]={feature:p,typeName:l},T++})),M=!1,s.forEach((function(e){var t=d.get(e.feature.attributes[Wt]),r=d.get(e.feature.attributes[Kt]);void 0!==t&&void 0!==r?(m[E]=t,g[E]=r,E++):(M=!0,R.linkChartDiagramLookup.set(e.feature.attributes[Wt],null),R.linkChartGeohashLookup.set(e.feature.attributes[Wt],null))})),M&&h.Z.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),e.next=26,Tr();case 26:if(Z(c,f,v,m,g)){e.next=28;break}throw new y.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");case 28:for(I=0;I<w.length;I++)c[I]===Cr.IsMovable&&(f[I]=f[I]*k,v[I]=v[I]*C),v[I]>84.9999&&(v[I]=84.9999),v[I]<-84.9999&&(v[I]=-84.9999),f[I]>179.9999&&(f[I]=179.9999),f[I]<-179.9999&&(f[I]=-179.9999),w[I].feature.attributes[$t]=new de.Z(f[I],v[I]),u.has(w[I].typeName)?null===(L=u.get(w[I].typeName))||void 0===L||L.set(w[I].feature.attributes[Vt],w[I].feature):((D=new Map).set(w[I].feature.attributes[Vt],w[I].feature),u.set(w[I].typeName,D)),p.set(w[I].feature.attributes[Vt],w[I].feature),G=(0,_.GH)(w[I].feature.attributes[$t]),this.linkChartDiagramLookup.set(w[I].feature.attributes[Vt],w[I].feature.attributes[$t]?G:null),this.linkChartGeohashLookup.set(w[I].feature.attributes[Vt],(0,b.fC)(w[I].feature.attributes[$t].y,w[I].feature.attributes[$t].x,Xt)),w[I].feature.attributes[$t].x<x.xmin&&(x.xmin=w[I].feature.attributes[$t].x),w[I].feature.attributes[$t].x>x.xmax&&(x.xmax=w[I].feature.attributes[$t].x),w[I].feature.attributes[$t].y<x.ymin&&(x.ymin=w[I].feature.attributes[$t].y),w[I].feature.attributes[$t].y>x.ymax&&(x.ymax=w[I].feature.attributes[$t].y);return e.abrupt("return",(this.linkChartExtent.xmin=x.xmin,this.linkChartExtent.xmax=x.xmax,this.linkChartExtent.ymin=x.ymin,this.linkChartExtent.ymax=x.ymax,s.forEach((function(e){var t,r,n=null===(t=w[d.get(e.feature.attributes[Wt])])||void 0===t?void 0:t.feature.attributes[$t],a=null===(r=w[d.get(e.feature.attributes[Kt])])||void 0===r?void 0:r.feature.attributes[$t];if(n&&a){var i=new ce.Z({paths:[[n.x,n.y],[a.x,a.y]]});if(e.feature.attributes[$t]=i,l.has(e.typeName)){var o=l.get(e.typeName);null===o||void 0===o||o.set(e.feature.attributes[Vt],e.feature)}else{var s=new Map;s.set(e.feature.attributes[Vt],e.feature),l.set(e.typeName,s)}p.set(e.feature.attributes[Vt],e.feature);var u=(0,_.GH)(e.feature.attributes[$t]);R.linkChartDiagramLookup.set(e.feature.attributes[Vt],e.feature.attributes[$t]?u:null),R.linkChartGeohashLookup.set(e.feature.attributes[Vt],"")}})),this._currentLinkChartConfig={layoutMode:n,xScaleFactor:k,yScaleFactor:C},{nodes:u,links:l,idMap:p}));case 30:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"applyNewLinkChartLayout",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,n,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"RADIAL_TREE",r=i.length>1?i[1]:void 0,n=[],e.next=5,this.calculateLinkChartLayout(t,r);case 5:return this.layers.forEach((function(e){n.push(e.refreshCachedQueryEngine())})),e.next=8,Promise.all(n);case 8:this.layers.forEach((function(e){e.emit("refresh",{dataChanged:!0})}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentNodeLocations",value:function(){var e,t=new Map;return null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach((function(e){var r;null===e||void 0===e||null===(r=e.members)||void 0===r||r.forEach((function(e){var r,n=e.linkChartLocation,a=e.id;n&&(r="x"in n?{x:n.x,y:n.y}:{x:n.coords[0],y:n.coords[1]},t.set(a,new de.Z({x:r.x,y:r.y})))}))})),t}},{key:"synchronizeInclusionListWithCache",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r;null!==(r=t.dataManager.inclusionModeDefinition)&&void 0!==r&&r.namedTypeDefinitions.forEach((function(e,r){if(e.useAllData=!1,e.members&&e.members.size>0){if(!t.dataManager.sublayerCaches.get(r))return;var n=Array.from(t.dataManager.sublayerCaches.get(r).keys());Array.from(e.members.keys()).filter((function(e){return!n.includes(e)})).forEach((function(t){var r;null===(r=e.members)||void 0===r||r.delete(t)}))}})),e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshLinkChartCache",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.refreshCacheContent(t);case 2:return r=[],this.layers.forEach((function(e){r.push(e.refreshCachedQueryEngine())})),e.next=6,Promise.all(r);case 6:this.layers.forEach((function(e){e.emit("refresh",{dataChanged:!0})}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleNewRecords",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,i,o,s,u,l,p,d,c,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this.dataManager.addToLayerInclusionSet(t),i=(0,n.Z)(t);try{for(i.s();!(o=i.n()).done;)s=o.value,this.sublayerIdsCache.has(s.typeName)||(this.sublayerIdsCache.set(s.typeName,new Set),r.push(s.typeName)),this.sublayerIdsCache.get(s.typeName).add(s.id)}catch(a){i.e(a)}finally{i.f()}for(u=0,l=r;u<l.length;u++)p=l[u],this._graphTypeLookup.has(p)&&(d=this._graphTypeLookup.get(p),y=new xr({objectType:d,parentCompositeLayer:this,graphType:c="endPoints"in d?"relationship":"entity",title:p}),"entity"===c?this.dataManager.entityTypeNames.add(p):this.dataManager.relationshipTypeNames.add(p),y.geometryType?this.layers.push(y):this.tables.push(y),this.dataManager.sublayerCaches.set(p,new Map));return e.next=7,this.dataManager.refreshCacheContent(t.map((function(e){return e.id})));case 7:return e.next=9,this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_initializeDiagram",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defaultLinkChartConfig){e.next=9;break}if(!this.defaultLinkChartConfig.doNotRecalculateLayout){e.next=5;break}null!==(t=this.dataManager.inclusionModeDefinition)&&void 0!==t&&null!==(t=t.namedTypeDefinitions)&&void 0!==t&&t.forEach((function(e){var t;null===e||void 0===e||null===(t=e.members)||void 0===t||t.forEach((function(e){var t,n=e.linkChartLocation,a=e.id;if(n){t="x"in n?{x:n.x,y:n.y}:{x:n.coords[0],y:n.coords[1]};var i=(0,_.GH)(t);r.linkChartDiagramLookup.set(a,i),r.linkChartGeohashLookup.set(a,(0,b.fC)(t.x,t.y,Xt)),r.linkChartExtent.xmin>t.x&&(r.linkChartExtent.xmin=t.x),r.linkChartExtent.xmax<t.x&&(r.linkChartExtent.xmax=t.x),r.linkChartExtent.ymin>t.y&&(r.linkChartExtent.ymin=t.y),r.linkChartExtent.ymax<t.y&&(r.linkChartExtent.ymax=t.y)}}))})),this.memberRelationshipTypes.forEach((function(e){var t;e.name&&(null===(t=r.dataManager.sublayerCaches.get(e.name))||void 0===t||t.forEach((function(e){var t=r.linkChartDiagramLookup.get(e.attributes[Wt]),n=r.linkChartDiagramLookup.get(e.attributes[Kt]);if(t&&n){var a=(0,_.GH)(new ce.Z({paths:[[t.coords[0],t.coords[1]],[n.coords[0],n.coords[1]]]}));r.linkChartDiagramLookup.set(e.attributes[Vt],a)}else r.linkChartDiagramLookup.set(e.attributes[Vt],null);r.linkChartGeohashLookup.set(e.attributes[Vt],"")})))})),e.next=7;break;case 5:return e.next=7,this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()});case 7:e.next=11;break;case 9:return e.next=11,this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}((0,pr.h)((0,yr.M)(w.Z)));(0,d._)([(0,v.Cb)()],jr.prototype,"dataPreloadedInLocalCache",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"defaultLinkChartConfig",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"dataManager",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"knowledgeGraph",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"layers",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"linkChartDiagramLookup",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"linkChartExtent",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"linkChartGeohashLookup",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"memberEntityTypes",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"memberRelationshipTypes",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"sublayerIdsCache",void 0),(0,d._)([(0,v.Cb)()],jr.prototype,"tables",void 0),(0,d._)([(0,v.Cb)({json:{read:!1}})],jr.prototype,"type",void 0);var Fr=jr=(0,d._)([(0,g.j)("esri.layers.LinkChartLayer")],jr)},63543:function(e,t,r){r.d(t,{Dm:function(){return c},Hq:function(){return y},MS:function(){return h},bU:function(){return l}});var n=r(4942),a=r(1413),i=r(93169),o=r(84652),s=r(60480),u=r(76115);function l(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?u.I4:"esriGeometryPolyline"===e?u.ET:u.lF}}}var p=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,d=1;function c(e,t){if((0,i.Z)("esri-csp-restrictions"))return function(){return(0,a.Z)((0,n.Z)({},t,null),e)};try{var r="this.".concat(t," = null;");for(var o in e)r+="this".concat(p.test(o)?".".concat(o):'["'.concat(o,'"]')," = ").concat(JSON.stringify(e[o]),";");var s=new Function("\n      return class AttributesClass$".concat(d++," {\n        constructor() {\n          ").concat(r,";\n        }\n      }\n    "))();return function(){return new s}}catch(u){return function(){return(0,a.Z)((0,n.Z)({},t,null),e)}}}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,o.d9)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1}}}}}]);
//# sourceMappingURL=2688.d260d67d.chunk.js.map