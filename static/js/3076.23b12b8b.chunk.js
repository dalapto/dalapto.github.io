"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[3076],{86591:function(e,t,r){r.d(t,{Z:function(){return m}});var n,i=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(27366),l=r(46784),c=r(84652),h=r(49861),f=r(25243),d=r(69912),v=n=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).variableName=null,n.dimensionName=null,n.values=[],n.isSlice=!1,n}return(0,a.Z)(r,[{key:"clone",value:function(){return new n({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,c.d9)(this.values),isSlice:this.isSlice})}}]),r}(l.wq);(0,u._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"variableName",void 0),(0,u._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"dimensionName",void 0),(0,u._)([(0,h.Cb)({type:f.V5.array(f.V5.oneOf([f.V5.native(Number),f.V5.array(f.V5.native(Number))])),json:{write:!0}})],v.prototype,"values",void 0),(0,u._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],v.prototype,"isSlice",void 0);var m=v=n=(0,u._)([(0,d.j)("esri.layers.support.DimensionalDefinition")],v)},55635:function(e,t,r){r.d(t,{OE:function(){return d},Gc:function(){return p},Qg:function(){return v},Rq:function(){return c},gX:function(){return m},z2:function(){return h},ET:function(){return f},Vx:function(){return g}});r(59486);var n=r(15671),i=r(43144),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;(0,n.Z)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return(0,i.Z)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null}},{key:"putBlock",value:function(e,t,r,n){var i=this._cachedBlocks,a=e+"/"+t;if(i.has(a)){var s=i.get(a);s.ts=Date.now(),s.refCount++}else i.set(a,{block:r,ts:Date.now(),refCount:1,controller:n});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),n=Date.now(),i=0;i<r.length&&r[i][1].ts<=n-e._duration;i++)t.delete(r[i][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),s=r(80394),o=r(585),u=new Map,l=new a;function c(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function h(e,t){var r={extent:null,rasterInfo:t,cache:new Map},n=u.get(e);return n?(n.push(r),n.length-1):(u.set(e,[r]),0)}function f(e,t){var r=u.get(e);r&&(r[t]=null,r.some((function(e){return null!=e}))||u.delete(e))}function d(e,t,r){var n,i=u.get(e);if(!i)return null==t?l.decreaseRefCount(e,r):0;if(null==t||null==i[t])return l.decreaseRefCount(e,r);var a=null===(n=i[t])||void 0===n?void 0:n.cache,s=null===a||void 0===a?void 0:a.get(r);if(a&&s){if(s.refCount--,0===s.refCount){a.delete(r);for(var o=0;o<i.length;o++){var c;null===(c=i[o])||void 0===c||c.cache.delete(r)}s.controller&&s.controller.abort()}return s.refCount}return 0}function v(e,t,r){var n,i=u.get(e);if(!i)return null==t?l.getBlock(e,r):null;if(null==t||null==i[t]){for(var a=0;a<i.length;a++){var s,o=null===(s=i[a])||void 0===s?void 0:s.cache.get(r);if(o)return o.refCount++,o.block}return l.getBlock(e,r)}var c=null===(n=i[t])||void 0===n?void 0:n.cache.get(r);if(c)return c.refCount++,c.block;for(var h=0;h<i.length;h++){var f;if(h!==t&&i[h]){var d=null===(f=i[h])||void 0===f?void 0:f.cache,v=null===d||void 0===d?void 0:d.get(r);if(d&&v)return v.refCount++,d.set(r,v),v.block}}return null}function m(e,t,r,n){var i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=u.get(e);if(s)if(null!=t&&null!=s[t]){var o={refCount:1,block:n,isResolved:!1,isRejected:!1,controller:a};n.then((function(){return o.isResolved=!0})).catch((function(){return o.isRejected=!0})),null===(i=s[t])||void 0===i||i.cache.set(r,o)}else l.putBlock(e,r,n,a);else null==t&&l.putBlock(e,r,n,a)}function p(e,t,r){var n,i=u.get(e);i?null!=t&&null!=i[t]?null===(n=i[t])||void 0===n||n.cache.delete(r):l.deleteBlock(e,r):null==t&&l.deleteBlock(e,r)}function y(e,t){var r,n=u.get(e);return n&&null!==(r=n[t])&&void 0!==r?r:null}function g(e,t,r,n,i,a){var u,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=y(e,t);if(c){var h=c.extent,f=c.cache,d=c.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){n=null!==(u=n)&&void 0!==u?u:0;for(var v=r.clone().normalize(),m=d.spatialReference,p=d.transform,g=new Set,_=0;_<v.length;_++){var b=v[_];if(!(b.xmax-b.xmin<=n||b.ymax-b.ymin<=n)){var x=(0,s.tB)(b,m,l);null!=p&&(x=p.inverseTransform(x));var w=new o.Z({x:n,y:n,spatialReference:b.spatialReference});if(null==i&&!(i=(0,s.VO)(w,m,b,l)))return;var T=(0,s.kr)(i,d,a||"closest"),k=T.pyramidLevel,P=T.pyramidResolution;if(T.excessiveReading)return;for(var C=d.storageInfo,I=C.origin,Z={x:Math.max(0,Math.floor((x.xmin-I.x)/P.x)),y:Math.max(0,Math.floor((I.y-x.ymax)/P.y))},R=Math.ceil((x.xmax-x.xmin)/P.x-.1),S=Math.ceil((x.ymax-x.ymin)/P.y-.1),U=k>0?C.pyramidBlockWidth:C.blockWidth,F=k>0?C.pyramidBlockHeight:C.blockHeight,M=Math.max(0,Math.floor(Z.x/U)-1),z=Math.max(0,Math.floor(Z.y/F)-1),V=Math.floor((Z.x+R-1)/U)+1,B=Math.floor((Z.y+S-1)/F)+1,D=z;D<=B;D++)for(var L=M;L<=V;L++)g.add("".concat(k,"/").concat(D,"/").concat(L))}}f.forEach((function(e,t){if(!g.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}}},21969:function(e,t,r){r.d(t,{MO:function(){return u},Tj:function(){return p},Ur:function(){return l},W2:function(){return v},WU:function(){return y},WY:function(){return m},gk:function(){return b},jj:function(){return g},nb:function(){return d}});var n=r(1413),i=r(93433),a=r(63780),s=r(86591);function o(e,t,r){var n=t.shift();if(0===r.length){r.push({sliceId:-1,multidimensionalDefinition:[]})}for(var a=r.length,s=function(){var t,a=r.shift().multidimensionalDefinition;null===(t=n.values)||void 0===t||t.forEach((function(t){r.push({sliceId:-1,multidimensionalDefinition:[].concat((0,i.Z)(a),[{variableName:e,dimensionName:n.name,values:[t]}])})}))},u=0;u<a;u++)s();t.length&&o(e,t,r)}function u(e,t){var r=[],a=0;return(t?e.variables.filter((function(e){return e.name.toLowerCase()===t.toLowerCase()})):(0,i.Z)(e.variables).sort((function(e,t){return e.name>t.name?1:-1}))).forEach((function(e){var t=[],s=(0,i.Z)(e.dimensions).sort((function(e,t){return e.name>t.name?-1:1}));o(e.name,s,t),t.forEach((function(e){r.push((0,n.Z)((0,n.Z)({},e),{},{sliceId:a++}))}))})),r}function l(e,t,r){var n=e;if(t&&(t=(0,i.Z)(t).sort((function(e,t){return e.dimensionName<t.dimensionName?-1:1}))).forEach((function(e){var t=e.dimensionName,r=e.values,i=e.isSlice;r.length&&(n=n.filter((function(e){var n=e.multidimensionalDefinition.find((function(e){return e.dimensionName===t}));if(null==n)return!1;var a=n.values[0];return"number"==typeof a?"number"==typeof r[0]?r.includes(a):r.some((function(e){return e[0]<=a&&e[1]>=a})):"number"==typeof r[0]?r.some((function(e){return a[0]<=e&&a[1]>=e})):i?r.some((function(e){return e[0]===a[0]&&e[0]===a[1]})):r.some((function(e){return e[0]>=a[0]&&e[0]<=a[1]||e[1]>=a[0]&&e[1]<=a[1]||e[0]<a[0]&&e[1]>a[1]}))})))})),n.length&&r&&null!=r.start&&null!=r.end){var a=r.start.getTime(),s=r.end.getTime(),o=n[0].multidimensionalDefinition.findIndex((function(e){return"StdTime"===e.dimensionName}));o>-1&&(n=n.filter((function(e){var t=e.multidimensionalDefinition[o].values[0];return a<=t&&s>=t})))}return n.map((function(e){return e.sliceId}))}function c(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function h(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function f(e,t,r){var a,s;if(null===t||void 0===t||null===(a=t.subsetDefinitions)||void 0===a||!a.length)return e;if(r){var o,u=t.variables;if(u.length&&!u.includes(r))return null;var l=t.subsetDefinitions.find((function(t){return t.dimensionName===e.name&&t.variableName===r}));if(null===l||void 0===l||null===(o=l.values)||void 0===o||!o.length)return e;s=h(l.values)}else{var f=t.dimensions.find((function(t){return t.name===e.name}));s=null===f||void 0===f?void 0:f.extent}var d=s;if(!d||null===d||void 0===d||!d.length)return e;var v=e.values.filter((function(e){return c(e,d)}));return(0,n.Z)((0,n.Z)({},e),{},{extent:(0,i.Z)(d),values:v})}function d(e,t,r){var n;if(null===t||void 0===t||null===(n=t.subsetDefinitions)||void 0===n||!n.length)return!1;var i=t.variables;if(i.length&&e.some((function(e){var t=e.variableName;return t&&!i.includes(t)})))return!0;for(var a,s=function(){var n=e[o],i=t.subsetDefinitions.find((function(e){return(""===n.variableName||e.variableName===n.variableName)&&e.dimensionName===n.dimensionName}));if(null!==i&&void 0!==i&&i.values.length){var a=h(i.values);if(n.isSlice||2!==n.values.length||Array.isArray(n.values[0])||n.values[0]===n.values[1]||!r){if(n.values.some((function(e){return!c(e,a)})))return{v:!0}}else if(!function(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}(n.values,a))return{v:!0}}},o=0;o<e.length;o++)if(a=s())return a.v;return!1}function v(e,t){if(null==e)return{isOutside:!1};var r=t.geometry,n=t.timeExtent,i=t.multidimensionalDefinition,a=null;if(null!=n&&(a=function(e,t){var r,n,i=e.dimensions.find((function(e){return"StdTime"===e.name}));if(null==i||null==t.start&&null==t.end)return t;t=t.clone();var a=t.toJSON(),o=a.start,u=a.end,l=o===u?[o]:null!=o&&null!=u?[o,u]:[null!==o&&void 0!==o?o:u];return 2===l.length&&null!==i&&void 0!==i&&i.extent.length&&(l[0]=Math.max(l[0],i.extent[0]),l[1]=Math.min(l[1],null!==(r=i.extent[1])&&void 0!==r?r:i.extent[0]),l[1]<l[0])||d([new s.Z({variableName:"",dimensionName:"StdTime",isSlice:1===l.length,values:l})],e,!0)?null:(t.start=new Date(l[0]),t.end=new Date(null!==(n=l[1])&&void 0!==n?n:l[0]),t)}(e,n),null==a))return{isOutside:!0};var o=e.areaOfInterest;if(o&&r){var u="point"===r.type?r:"extent"===r.type?r.center:"polygon"===r.type?r.centroid:null;if(u&&!o.contains(u))return{isOutside:!0}}return null!=i&&i.length&&d(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:r,timeExtent:a,multidimensionalDefinition:i}}}function m(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.multidimensionalInfo,s=e.keyProperties;if(null==a)return null;var o=i.variableName,u=i.multidimensionalSubset,l=i.multidimensionalDefinition,c=null!=l?null===(t=l[0])||void 0===t?void 0:t.variableName:null,h=o||c||(null===s||void 0===s?void 0:s.DefaultVariable),f=a.variables;return(null===u||void 0===u||null===(r=u.variables)||void 0===r?void 0:r.length)&&(f=f.filter((function(e){var t=e.name;return u.variables.includes(t)}))),h&&null!==(n=f.find((function(e){return e.name===h})))&&void 0!==n?n:f[0]}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=m(e,t);if(!r)return null;var n=[],i=r.dimensions,a=r.name;if(0===i.length)return[new s.Z({variableName:a,dimensionName:"",values:[],isSlice:!0})];for(var o=0;o<i.length;o++){var u,l=f(i[o],t.multidimensionalSubset,a);if(!l)return null;var c=l.values,h=l.extent,d=null!==(u=null===c||void 0===c?void 0:c[0])&&void 0!==u?u:h[0];"stdz"===l.name.toLowerCase()&&!l.hasRanges&&Math.abs(h[1])<=Math.abs(h[0])&&(d=null!==c&&void 0!==c&&c.length?c[c.length-1]:h[1]),n.push(new s.Z({variableName:a,dimensionName:l.name,values:[d],isSlice:!t.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return n}function y(e){return!(null==e||!e.length)&&e.some((function(e){if(null==e.values)return!0;var t=e.values.length;return 0===t||t>1||!e.isSlice&&Array.isArray(e.values[0])}))}function g(e,t){var r;if(null==t||null==e)return null;var i=t.variables.map((function(e){return(0,n.Z)({},e)}));return null!==e&&void 0!==e&&null!==(r=e.variables)&&void 0!==r&&r.length&&(i=i.filter((function(t){var r=t.name;return e.variables.includes(r)}))).forEach((function(t){t.dimensions=t.dimensions.map((function(r){return f(r,e,t.name)})).filter(a.pC)})),i}function _(e){var t,r,n,i=null===(t=e.values)||void 0===t?void 0:t.length;if(i)return i;var a=e.extent,s=e.unit,o=e.interval||1,u=a?a[1]-a[0]:0;if("ISO8601"!==s)return Math.round(u/o);switch(null!==(r=null===(n=e.intervalUnit)||void 0===n?void 0:n.toLowerCase())&&void 0!==r?r:"seconds"){case"seconds":i=Math.round(u/1e3/o);break;case"minutes":i=Math.round(u/6e4/o);break;case"hours":i=Math.round(u/36e5/o);break;case"days":i=Math.round(u/864e5/o);break;case"months":var l=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),c=new Date(a[0]).getUTCMonth(),h=new Date(a[1]).getUTCMonth();i=0===l?h-c+1:h+11-c+12*(l-1)+1;break;case"years":i=Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/o);break;case"decades":i=Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/o);break;default:i=0}return i}function b(e,t){for(var r,n=0,a=e[0].variableName,s=(0,i.Z)(t.variables).sort((function(e,t){return e.name>t.name?1:-1})),o=function(){var t=s[u],r=(0,i.Z)(t.dimensions).sort((function(e,t){return e.name>t.name?-1:1}));if(t.name!==a)return n+=r.map((function(e){return _(e)})).reduce((function(e,t){return e*t})),0;for(var o,l=r.map((function(e){return _(e)})),c=r.length,h=function(t){var i=e.find((function(e){return e.dimensionName===r[t].name}));if(null==i)return{v:{v:null}};var a=function(e,t){var r,n=t.values;if(null!==n&&void 0!==n&&n.length){var i=Array.isArray(n[0]),a=Array.isArray(e);return i!==a?-1:i&&a?n.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]})):n.indexOf(e)}var s=t.extent;if(Array.isArray(e)||e<s[0]||e>s[1])return-1;var o=t.interval||1;if("ISO8601"!==t.unit)return Math.round((e-s[0])/o);var u=s[0],l=-1;switch((null===(r=t.intervalUnit)||void 0===r?void 0:r.toLowerCase())||"seconds"){case"seconds":l=Math.round((e-u)/1e3/o);break;case"minutes":l=Math.round((e-u)/6e4/o);break;case"hours":l=Math.round((e-u)/36e5/o);break;case"days":l=Math.round((e-u)/864e5/o);break;case"months":var c=new Date(e).getUTCFullYear()-new Date(u).getUTCFullYear(),h=new Date(u).getUTCMonth(),f=new Date(e).getUTCMonth();l=0===c?f-h:f+11-h+12*(c-1);break;case"years":l=Math.round((new Date(e).getUTCFullYear()-new Date(u).getUTCFullYear())/o);break;case"decades":l=Math.round((new Date(e).getUTCFullYear()-new Date(u).getUTCFullYear())/10/o)}return l}(i.values[0],r[t]);if(-1===a)return{v:{v:null}};l.shift(),n+=t===c-1?a:a*l.reduce((function(e,t){return e*t}))},f=0;f<c;f++)if(o=h(f))return o.v;return 1},u=0;u<s.length;u++)if(0!==(r=o())){if(1===r)break;if(r)return r.v}return n}},79739:function(e,t,r){function n(e,t){var r=e.attributeTable,n=e.bandCount;return!(null!=r||!function(e){var t,r;return["u8","s8"].includes(e.pixelType)&&null!=(null===(t=e.statistics)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.min)&&null!=(null===(r=e.statistics[0])||void 0===r?void 0:r.max)&&1===e.bandCount}(e))||!(null==r||n>1)&&(!t||null!=r.fields.find((function(e){return e.name.toLowerCase()===t.toLowerCase()})))}function i(e){var t=e.bandCount,r=e.dataType,n=e.pixelType;return"elevation"===r||"generic"===r&&1===t&&("s16"===n||"s32"===n||"f32"===n||"f64"===n)}function a(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.bandCount,n=e.colormap,i=e.pixelType;return 1===r&&(!(null===n||void 0===n||!n.length)||!t&&"u8"===i)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.attributeTable;return 1===e.bandCount&&(!t||null!=r||null!=e.histograms)}function o(e){var t=e.dataType;return"vector-uv"===t||"vector-magdir"===t}function u(e){var t=e.dataType;return"vector-uv"===t||"vector-magdir"===t}r.d(t,{LV:function(){return o},MG:function(){return n},aG:function(){return u},fI:function(){return s},jX:function(){return i},mO:function(){return a}})},55067:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(37762),i=r(15671),a=r(43144),s=r(11752),o=r(61120),u=r(60136),l=r(29388),c=r(93169),h=r(80613),f=r(64510),d=r(52424),v=r(40655),m=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},p=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this))._tileInfoView=e,n}return(0,a.Z)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(m),this.setStencilReference(e),(0,s.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,n=(0,s.Z)((0,o.Z)(r.prototype),"createRenderParams",this).call(this,e);return n.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,n.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),n}},{key:"prepareRenderPasses",value:function(e){var t=this,n=(0,s.Z)((0,o.Z)(r.prototype),"prepareRenderPasses",this).call(this,e);return n.push(e.registerRenderPass({name:"stencil",brushes:[v.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,c.Z)("esri-tiles-debug")&&n.push(e.registerRenderPass({name:"tileInfo",brushes:[d.Z],drawPhase:h.jx.DEBUG,target:function(){return t.children}})),n}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,r=1,i=(0,n.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.stencilRef=r++}}catch(a){i.e(a)}finally{i.f()}}}]),r}(f.Z)},72900:function(e,t,r){r.d(t,{I:function(){return h}});var n=r(29439),i=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(22753),l=r(87422),c=r(73828),h=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(e,n,a,s,o,u){var l,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:u;return(0,i.Z)(this,r),(l=t.call(this)).triangleCountReportedInDebug=0,l.triangleCount=0,l.texture=null,l.key=new c.Z(e),l.resolution=n,l.x=a,l.y=s,l.width=o,l.height=u,l.rangeX=h,l.rangeY=f,l}return(0,a.Z)(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e){var t=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,i=e.toScreenNoRotation([0,0],[this.x,this.y]),a=(0,n.Z)(i,2),s=a[0],o=a[1],l=this.width/this.rangeX*t,c=this.height/this.rangeY*t;(0,u.s)(r,l,0,0,0,c,0,s,o,1),(0,u.m)(this.transforms.dvs,e.displayViewMat3,r)}}]),r}(l.s)},13076:function(e,t,r){r.r(t),r.d(t,{default:function(){return mt}});var n=r(74165),i=r(15861),a=r(15671),s=r(43144),o=r(60136),u=r(29388),l=r(27366),c=r(52639),h=r(32718),f=r(66978),d=r(94172),v=r(49861),m=(r(25243),r(63780),r(93169),r(69912)),p=r(21969),y=r(34930),g=r(95986),_=r(29439),b=r(11752),x=r(61120),w=r(93433),T=r(65156),k=r(86226),P=r(1413),C=r(92026),I=r(22753),Z=r(23588),R=r(15245),S=r(87422),U=r(8548),F=r(48673),M={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"},z=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,a.Z)(this,r),(e=t.call(this))._textureInvalidated=!0,e._colormapTextureInvalidated=!0,e._rasterTexture=null,e._rasterTextureBandIds=null,e._transformGridTexture=null,e._colormapTexture=null,e._colormap=null,e._supportsBilinearTexture=!0,e._processedTexture=null,e.functionTextures=[],e.projected=!1,e.stencilRef=0,e.coordScale=[1,1],e._processed=!1,e._symbolizerParameters=null,e.height=null,e.isRendereredSource=!1,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e.rawPixelData=null,e._suspended=!1,e._bandIds=null,e._interpolation=null,e._transformGrid=null,e.width=null,e.x=0,e.y=0,e.source=n,e.transformGrid=i,e.interpolation=s,e}return(0,s.Z)(r,[{key:"destroy",value:function(){this._disposeTextures()}},{key:"processedTexture",get:function(){return this._processedTexture},set:function(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}},{key:"rasterTexture",get:function(){return this._rasterTexture},set:function(e){var t;this._rasterTexture!==e&&(null!==(t=this._rasterTexture)&&void 0!==t&&t.dispose(),this._rasterTexture=e)}},{key:"processed",get:function(){return this._processed},set:function(e){this._processed=e,e||((0,C.M2)(this.processedTexture),this.invalidateTexture())}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||M},set:function(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}},{key:"source",get:function(){return this._source},set:function(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.projected=!1,this.invalidateTexture())}},{key:"suspended",get:function(){return this._suspended},set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e,this._isBandIdschanged(e)&&(this.projected=!1,this.invalidateTexture())}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?U.cw.LINEAR:U.cw.NEAREST)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e,this._transformGridTexture=(0,C.M2)(this._transformGridTexture)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}},{key:"_createTransforms",value:function(){return{dvs:(0,Z.c)()}}},{key:"setTransform",value:function(e){var t=(0,I.g)(this.transforms.dvs),r=e.toScreenNoRotation([0,0],[this.x,this.y]),n=(0,_.Z)(r,2),i=n[0],a=n[1],s=this.resolution/this.pixelRatio/e.resolution,o=s*this.width,u=s*this.height,l=Math.PI*this.rotation/180;(0,I.h)(t,t,(0,R.f)(i,a)),(0,I.h)(t,t,(0,R.f)(o/2,u/2)),(0,I.r)(t,t,-l),(0,I.h)(t,t,(0,R.f)(-o/2,-u/2)),(0,I.l)(t,t,(0,R.f)(o,u)),(0,I.m)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"getTextures",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.forProcessing,n=void 0!==r&&r,i=t.useProcessedTexture,a=void 0!==i&&i,s=a&&null!==(e=this._processedTexture)&&void 0!==e?e:this._rasterTexture,o=[],u=[];return s?a?(u.push(s),o.push("u_image"),this._colormapTexture&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u}):(this._transformGridTexture&&(u.push(this._transformGridTexture),o.push("u_transformGrid")),u.push(s),o.push("u_image"),this._colormapTexture&&!n&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u}):{names:o,textures:u}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}},{key:"updateTexture",value:function(e){var t=e.context;if(this.stage){var r=this._isValidSource(this.source);r&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(t)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(t),this._rasterTexture&&(r?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,F.Br)(t,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()}},{key:"updateProcessedTexture",value:function(){var e=this.functionTextures;0!==e.length&&(this.processedTexture=e.shift(),e.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()})),e.length=0)}},{key:"_createOrDestroyRasterTexture",value:function(e){var t,r,n,i=null===(t=this.source)||void 0===t?void 0:t.extractBands(this.bandIds);if(this._isValidSource(i)){var a=!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=!(null===(r=e.capabilities.textureFloat)||void 0===r||!r.textureFloatLinear);var s=this._getTextureSamplingMethod(this.interpolation),o=this.isRendereredSource||!(null!==(n=e.capabilities.textureFloat)&&void 0!==n&&n.textureFloat);this._rasterTexture=(0,F.s9)(e,i,s,o),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?(0,w.Z)(this.bandIds):null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}},{key:"_isBandIdschanged",value:function(e){var t=this._rasterTextureBandIds;return!(null==t&&null==e||t&&e&&t.join("")===e.join(""))}},{key:"_isValidSource",value:function(e){var t;return null!=e&&(null===(t=e.pixels)||void 0===t?void 0:t.length)>0}},{key:"_getTextureSamplingMethod",value:function(e){var t=this.symbolizerParameters,r=t.type,n=t.colormap,i="lut"===r||"stretch"===r&&null!=n;return!this._supportsBilinearTexture||i||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}},{key:"_updateColormapTexture",value:function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,F.iC)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=(0,F.iC)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}},{key:"_disposeTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null),!e&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null,this._colormap=null,this._colormapTextureInvalidated=!0),!e&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}]),r}(S.s);function V(e){var t=[];return e&&(t.push("applyProjection"),1===e.spacing[0]&&t.push("lookupProjection")),t}function B(e,t,r){var n,i=!(null!==(n=r.capabilities.textureFloat)&&void 0!==n&&n.textureFloatLinear),a=[];return"cubic"===e?a.push("bicubic"):"bilinear"===e&&(t?(a.push("bilinear"),a.push("nnedge")):i&&a.push("bilinear")),a}var D={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};var L={createProgram:function(e,t,r){var n=r?[]:V(t.transformGrid);return{defines:n,program:e.painter.materialManager.getProgram(D,n)}},bindTextureAndUniforms:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:i}),s=a.names,o=a.textures;(0,F.RA)(e.context,t,s,o),(0,F.N9)(t,n,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset,h=(0,F.Ue)(l,c);(0,F.N9)(t,n,h)}},E={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};var O={createProgram:function(e,t,r){var n=t.symbolizerParameters.colormap,i=[].concat((0,w.Z)(r?[]:V(t.transformGrid)),(0,w.Z)(B(t.interpolation,null!=n,e.context)));return null!=n&&i.push("applyColormap"),{defines:i,program:e.painter.materialManager.getProgram(E,i)}},bindTextureAndUniforms:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:i}),s=a.names,o=a.textures;(0,F.RA)(e.context,t,s,o),(0,F.N9)(t,n,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset;if(null!=l){var h=(0,F.Ue)(l,c);(0,F.N9)(t,n,h)}var f=(0,F.Fm)(u);(0,F.N9)(t,n,f)}},A={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};var G={createProgram:function(e,t,r){var n=t.symbolizerParameters.colormap,i=[].concat((0,w.Z)(r?[]:V(t.transformGrid)),(0,w.Z)(B(t.interpolation,null!=n,e.context)));return t.isRendereredSource&&!r?i.push("noop"):null!=n&&i.push("applyColormap"),{defines:i,program:e.painter.materialManager.getProgram(A,i)}},bindTextureAndUniforms:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:i}),s=a.names,o=a.textures;(0,F.RA)(e.context,t,s,o),(0,F.N9)(t,n,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset;if(null!=l){var h=(0,F.Ue)(l,c);(0,F.N9)(t,n,h)}var f=(0,F.xW)(u);(0,F.N9)(t,n,f)}},N=new Map;N.set("lut",L),N.set("hillshade",O),N.set("stretch",G);var j=[1,1],q=[2,0,0,0,2,0,-1,-1,0];function W(e,t,r){var n,i,a=e.context,s=e.rasterFunction,o=e.hasBranches,u=s.parameters.raster,l=o?null!==(n=null===u||void 0===u?void 0:u.id)&&void 0!==n?n:-1:0,c=null!==(i=r.functionTextures[l])&&void 0!==i?i:r.rasterTexture;(0,F.RA)(a,t,["u_image"],[c])}function Y(e,t,r){var n=e.rasterFunction.parameters.rasters;if(n){if(n.length<2)return W(e,t,r);var i=n.filter((function(e){return"Constant"!==e.name})).map((function(e){return null!=e.id&&"Identity"!==e.name?r.functionTextures[e.id]:r.rasterTexture}));if((0,F.RA)(e.context,t,["u_image","u_image1","u_image2"].slice(0,i.length),i),i.length!==n.length)if(2===n.length){var a=n.findIndex((function(e){return"Constant"===e.name})),s=0===a?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],o=n[a].parameters.value;t.setUniform1f("u_image1Const",o),t.setUniformMatrix3fv("u_imageSwap",s)}else if(3===n.length){var u=[];if(n.forEach((function(e,t){return"Constant"===e.name&&u.push(t)})),1===u.length){var l=n[u[0]].parameters.value;t.setUniform1f("u_image1Const",l);var c=0===u[0]?[0,1,0,0,0,1,1,0,0]:1===u[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1];t.setUniformMatrix3fv("u_imageSwap",c)}else if(2===u.length){var h=n[u[0]].parameters.value;t.setUniform1f("u_image1Const",h);var f=n[u[1]].parameters.value;t.setUniform1f("u_image2Const",f);var d=n.findIndex((function(e){return"Constant"!==e.name})),v=0===d?[1,0,0,0,1,0,0,0,1]:1===d?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0];t.setUniformMatrix3fv("u_imageSwap",v)}}}}function Q(e){e.setUniform2fv("u_coordScale",j),e.setUniformMatrix3fv("u_dvsMat3",q)}var H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};var X={createProgram:function(e,t){return e.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.width,i=r.height,a=r.resolution;t.setUniform2fv("u_srcImageSize",[n,i]),t.setUniform2fv("u_cellSize",[a,a])}},J={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};var K={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters.indexType;return r.materialManager.getProgram(J,[n])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",n)}},$={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ee={createProgram:function(e,t){return e.painter.materialManager.getProgram($,[])},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),Q(t)}},te={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};var re={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters,i=[{name:"rows",value:n.kernelRows},{name:"cols",value:n.kernelCols}];return r.materialManager.getProgram(te,i)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t),t.setUniform2fv("u_srcImageSize",[r.width,r.height]);var n=e.rasterFunction.parameters,i=n.kernel,a=n.clampRange;t.setUniform1fv("u_kernel",i),t.setUniform2fv("u_clampRange",a)}},ne={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ie={createProgram:function(e,t){var r=e.painter,n=[e.rasterFunction.parameters.curvatureType];return r.materialManager.getProgram(ne,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.width,i=r.height,a=r.resolution,s=e.rasterFunction.parameters.zFactor;t.setUniform2fv("u_srcImageSize",[n,i]),t.setUniform1f("u_zlFactor",200*s/a/a)}},ae={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};var se={createProgram:function(e,t){return e.painter.materialManager.getProgram(ae,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",n)}},oe=r(83826),ue={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},le=new Set(["sinh","cosh","tanh","asinh","acosh","atanh"]);var ce={createProgram:function(e){var t=e.painter,r=e.rasterFunction.parameters,n=r.imageCount,i=r.operationName,a=r.rasters,s=r.isOutputRounded,o=i.toLowerCase();e.context.type===oe.zO.WEBGL1&&le.has(o)&&(o="polyfill".concat(o));var u=[o];2===n&&u.push("twoImages");var l=a.filter((function(e){return"Constant"===e.name}));return l.length&&(u.push("oneConstant"),2===l.length&&u.push("twoConstant")),s&&u.push("roundOutput"),t.materialManager.getProgram(ue,u)},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),Q(t);var n=e.rasterFunction.parameters.domainRange;t.setUniform2fv("u_domainRange",n)}},he={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};var fe={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters.bandCount>1?["multiBand"]:[];return r.materialManager.getProgram(he,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters,i=n.includedRanges,a=n.noDataValues;t.setUniform1fv("u_includedRanges",i),t.setUniform1fv("u_noDataValues",a)}},de={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ve={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters.scaled?["scaled"]:[];return r.materialManager.getProgram(de,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",n)}},me={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};var pe={createProgram:function(e,t){return e.painter.materialManager.getProgram(me,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters,i=n.noDataRanges,a=n.rangeMaps,s=n.allowUnmatched,o=n.clampRange;t.setUniform1fv("u_noDataRanges",i),t.setUniform1fv("u_rangeMaps",a),t.setUniform1f("u_unmatchMask",s?1:0),t.setUniform2fv("u_clampRange",o)}},ye=r(6394),ge={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};var _e={createProgram:function(e,t){var r,n,i=e.painter,a=[],s=t.interpolation,o=t.transformGrid,u=!(null===(r=e.rasterFunction)||void 0===r||null===(r=r.parameters)||void 0===r||!r.requireBilinear),l="bilinear"===s?!(null!==(n=e.context.capabilities.textureFloat)&&void 0!==n&&n.textureFloatLinear):u;return"cubic"===s?a.push("bicubic"):l&&a.push("bilinear"),o&&(a.push("applyProjection"),1===o.spacing[0]&&a.push("lookupProjection")),i.materialManager.getProgram(ge,a)},bindTextureAndUniforms:function(e,t,r){var n=r.getTextures({forProcessing:!0}),i=n.names,a=n.textures;(0,F.RA)(e.context,t,i,a),t.setUniform1f("u_scale",1),t.setUniform2fv("u_offset",[0,0]),t.setUniform2fv("u_coordScale",[1,1]),t.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]),t.setUniform1i("u_flipY",0),t.setUniform1f("u_opacity",1);var s=r.width,o=r.height,u=r.source,l=r.transformGrid;t.setUniform2fv("u_srcImageSize",[u.width,u.height]),t.setUniform2fv("u_targetImageSize",[s,o]),t.setUniform2fv("u_transformSpacing",l?l.spacing:ye.Z),t.setUniform2fv("u_transformGridSize",l?l.size:ye.Z)}},be={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};var xe={createProgram:function(e,t){var r=e.painter,n="percent-rise"===e.rasterFunction.parameters.slopeType?["percentRise"]:[];return r.materialManager.getProgram(be,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.width,i=r.height,a=r.resolution,s=e.rasterFunction.parameters,o=s.zFactor,u=s.slopeType,l=s.pixelSizePower,c=s.pixelSizeFactor;t.setUniform2fv("u_srcImageSize",[n,i]),t.setUniform2fv("u_cellSize",[a,a]),t.setUniform1f("u_zFactor",o),t.setUniform1f("u_pixelSizePower","adjusted"===u?l:0),t.setUniform1f("u_pixelSizeFactor","adjusted"===u?c:0)}},we={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};var Te={createProgram:function(e,t){var r=e.rasterFunction.parameters,n=r.useGamma,i=r.bandCount,a=r.isOutputRounded,s=[];return n&&s.push("useGamma"),i>1&&s.push("multiBand"),a&&s.push("roundOutput"),e.painter.materialManager.getProgram(we,s)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.width,i=r.height,a=e.rasterFunction.parameters;t.setUniform2fv("u_srcImageSize",[n,i]),t.setUniform1f("u_minOutput",a.outMin),t.setUniform1f("u_maxOutput",a.outMax),t.setUniform1fv("u_factor",a.factor),t.setUniform1fv("u_minCutOff",a.minCutOff),t.setUniform1fv("u_maxCutOff",a.maxCutOff),t.setUniform1fv("u_gamma",a.gamma),t.setUniform1fv("u_gammaCorrection",a.gammaCorrection)}},ke=r(57808),Pe=r(52311),Ce=new Map;function Ie(e,t,r){var n=new Pe.X;return n.width=t,n.height=r,n.internalFormat=e.type===oe.zO.WEBGL2?U.lP.RGBA32F:U.VI.RGBA,n.samplingMode=U.cw.NEAREST,n.dataType=U.Br.FLOAT,n.isImmutable=e.type===oe.zO.WEBGL2,n.wrapMode=U.e8.CLAMP_TO_EDGE,n}function Ze(e,t,r,n){var i=e.rasterFunction.name.toLowerCase(),a="reproject"===i?_e:function(e){return Ce.get(e.toLowerCase())}(i);if(null!=a){var s=function(e,t,r,n){var i=e.context,a=e.requestRender,s=e.allowDelayedRender,o=n.createProgram(e,r);if(s&&null!=a&&!o.compiled)return a(),null;var u=r.width,l=r.height;return i.bindFramebuffer(t),i.setViewport(0,0,u,l),i.useProgram(o),o}(e,r,n,a);if(s){a.bindTextureAndUniforms(e,s,n),t.draw();var o=n.width,u=n.height,l=Ie(e.context,o,u),c=new ke.x(e.context,l);if(r.copyToTexture(0,0,o,u,0,0,c),"reproject"===i)n.rasterTexture=c,n.projected=!0;else{var h=e.hasBranches?e.rasterFunction.id:0;n.functionTextures[h]=c}}}}Ce.set("aspect",X),Ce.set("bandarithmetic",K),Ce.set("compositeband",ee),Ce.set("convolution",re),Ce.set("curvature",ie),Ce.set("extractband",se),Ce.set("local",ce),Ce.set("mask",fe),Ce.set("ndvi",ve),Ce.set("remap",pe),Ce.set("slope",xe),Ce.set("stretch",Te);var Re=r(94109),Se=r(25866),Ue=r(3886),Fe=r(53634),Me=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).name="raster",e._quad=null,e._rendererUniformInfos=new Map,e._fbo=null,e}return(0,s.Z)(r,[{key:"dispose",value:function(){(0,C.M2)(this._quad),(0,C.M2)(this._fbo)}},{key:"prepareState",value:function(e){var t=e.context,r="raster"===e.renderPass;t.setBlendingEnabled(!r),t.setBlendFunctionSeparate(U.zi.ONE,U.zi.ONE_MINUS_SRC_ALPHA,U.zi.ONE,U.zi.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!r)}},{key:"draw",value:function(e,t){if(function(e){return null!=e.source}(t)&&!t.suspended){var r=e.renderPass;if("raster-bitmap"!==r)return"raster"===r?this._process(e,t):void this._drawBitmap(e,t,!0);this._drawBitmap(e,t)}}},{key:"_process",value:function(e,t){var r="Reproject"===e.rasterFunction.name;if(r?!t.rasterTexture||!t.projected:!t.processed){var n=e.timeline,i=e.context;n.begin(this.name);var a=i.getBoundFramebufferObject(),s=i.getViewport();r||(t.processedTexture=(0,C.M2)(t.processedTexture)),i.setStencilFunction(U.wb.EQUAL,t.stencilRef,255),t.updateTexture(e),this._initQuad(i);var o=this._getRasterFBO(i,t.width,t.height),u=o.isStandardRasterTileSize,l=o.fbo;Ze(e,this._quad,l,t),u||l.dispose(),i.bindFramebuffer(a),i.setViewport(s.x,s.y,s.width,s.height),n.end(this.name)}}},{key:"_drawBitmap",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.timeline,i=e.context;if(n.begin(this.name),i.setStencilFunction(U.wb.EQUAL,t.stencilRef,255),t.updateTexture(e),r&&!t.processedTexture){if(t.updateProcessedTexture(),!t.processedTexture)return void n.end(this.name);t.processed=!0}this._initBitmapCommonUniforms(t);var a=t.symbolizerParameters.type,s=function(e){return N.get(e)}(a),o=e.requestRender,u=e.allowDelayedRender,l=s.createProgram(e,t,r),c=l.defines,h=l.program;if(!u||null==o||h.compiled){i.useProgram(h);var f=this._getUniformInfos(a,i,h,c);this._quad||(this._quad=new Se.Z(i,[0,0,1,0,0,1,1,1])),s.bindTextureAndUniforms(e,h,t,f,r),this._quad.draw(),n.end(this.name)}else o()}},{key:"_initBitmapCommonUniforms",value:function(e){if(!e.commonUniforms){var t=(0,F.zS)(1,[0,0]),r=e.transformGrid,n=e.width,i=e.height,a=(0,F.Tc)(r,[n,i],[e.source.width,e.source.height],1,!1);e.commonUniforms=(0,P.Z)((0,P.Z)((0,P.Z)({},t),a),{},{u_coordScale:e.coordScale})}}},{key:"_getRasterFBO",value:function(e,t,r){var n=t===Re.I_||r===Re.I_;return n?(this._fbo||(this._fbo=this._createNewFBO(e,t,r)),{isStandardRasterTileSize:n,fbo:this._fbo}):{isStandardRasterTileSize:n,fbo:this._createNewFBO(e,t,r)}}},{key:"_createNewFBO",value:function(e,t,r){var n=Ie(e,t,r);return new Fe.X(e,n)}},{key:"_initQuad",value:function(e){this._quad||(this._quad=new Se.Z(e,[0,0,1,0,0,1,1,1]))}},{key:"_getUniformInfos",value:function(e,t,r,n){var i=n.length>0?e+"-"+n.join("-"):e;if(this._rendererUniformInfos.has(i))return this._rendererUniformInfos.get(i);var a=(0,F.v)(t,r);return this._rendererUniformInfos.set(i,a),a}}]),r}(Ue.Z),ze=r(72900),Ve=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i,s,o,u){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,a.Z)(this,r),(l=t.call(this,e,n,i,s,o,u)).bitmap=null,l.bitmap=new z(c,null,null),l.bitmap.coordScale=[o,u],l.bitmap.once("isReady",(function(){return l.ready()})),l}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,b.Z)((0,x.Z)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e){(0,b.Z)((0,x.Z)(r.prototype),"setTransform",this).call(this,e),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"_createTransforms",value:function(){return{dvs:(0,Z.c)(),tileMat3:(0,Z.c)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(ze.I),Be=r(80613),De=r(55067),Le=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return(0,s.Z)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),r=(0,_.Z)(this._tileInfoView.tileInfo.size,2),n=r[0],i=r[1],a=this._tileInfoView.getTileResolution(e.level);return new Ve(e,a,t[0],t[3],n,i)}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"imagery (tile)",brushes:[Me],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:Be.jx.MAP});return[].concat((0,w.Z)((0,b.Z)((0,x.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[n])}},{key:"doRender",value:function(e){if(this.visible&&e.drawPhase===Be.jx.MAP){var t=this.rasterFunctionChain;if(!t)return e.renderPass="raster-bitmap",void(0,b.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e);var n=(0,_.Z)(this._tileInfoView.tileInfo.size,2),i=n[0],a=n[1];if(e.renderPass="raster",e.rasterFunction={name:"Reproject",parameters:{targetImageSize:[i,a],requireBilinear:t.hasSurfaceFunction},pixelType:"f32",id:0,isNoopProcess:!1},(0,b.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e),null!==t&&void 0!==t&&t.functions.length)for(var s=t.functions,o=t.hasBranches,u=0;u<s.length;u++){var l=s[u];"Constant"!==l.name&&"Identity"!==l.name&&(e.renderPass="raster",e.rasterFunction=l,e.hasBranches=o,(0,b.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e))}e.rasterFunction=null,e.renderPass="bitmap",(0,b.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e)}}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds((0,T.Ue)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,n=(0,k.ut)(r.spatialReference);if(n){var i=r.lodAt(e.level);if(!i)return t;var a=i.resolution,s=n/a%r.size[0],o=s?(r.size[0]-s)*a:0;t[0]-=o*e.world,t[2]-=o*e.world}}return t}}]),r}(De.Z),Ee=r(97326),Oe=(r(59486),r(41691)),Ae=r(585),Ge=r(96212),Ne=r(22824),je=r(55635),qe=r(80394),We=r(79739),Ye=(r(5131),r(37995)),Qe=(r(73828),r(32344)),He=r(85269),Xe=r(90316),Je=r(53866),Ke=[0,0],$e=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._emptyTilePixelBlock=null,e._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=[],e.previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._isCustomTilingScheme=!1,e._maxIndexedColormapSize=0,e._rasterFunctionState="na",e._globalUpdateRequested=!1,e.attached=!1,e.timeExtent=null,e.redrawOrRefetch=(0,f.Ds)((0,i.Z)((0,n.Z)().mark((function t(){var r,i,a,s,o,u=arguments;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=u.length>0&&void 0!==u[0]?u[0]:{},e.previousLOD&&!e.layerView.suspended){t.next=3;break}return t.abrupt("return");case 3:if(i=e._rasterFunctionState,t.t0=r.reprocess,!t.t0){t.next=9;break}return t.next=8,e.updatingHandles.addPromise(e.layer.updateRasterFunction());case 8:e.updateRasterFunctionParameters();case 9:return a=e._rasterFunctionState,s=(0,Ee.Z)(e),o=s.type,t.abrupt("return",r.refetch||"raster"!==o&&r.reprocess||"cpu"===a||"cpu"===i?e.updatingHandles.addPromise(e.doRefresh()):e.updatingHandles.addPromise(e._redrawImage(r.signal)));case 11:case"end":return t.stop()}}),t)})))),e}return(0,s.Z)(r,[{key:"useWebGLForProcessing",get:function(){var e;return null===(e=this._get("useWebGLForProcessing"))||void 0===e||e},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){var e;return null===(e=this._get("useProgressiveUpdate"))||void 0===e||e},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new He.Z({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,n=t.resolution,i=t.scale,a=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[a.level],u=r.toJSON?r:Je.Z.fromJSON(r);(0,je.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,u,n,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null===(s=this.previousLOD)||void 0===s?void 0:s.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}},{key:"moveEnd",value:function(){var e=this;!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.layerView.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.layerView.requestUpdate()}},{key:"updating",get:function(){var e;return(null===(e=this._fetchQueue)||void 0===e?void 0:e.updating)||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}},{key:"attach",value:function(){var e=this,t=(0,Xe.hc)("2d");this._maxIndexedColormapSize=4*(t.maxTextureSize||4096),t.supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new Ye.Z(this.layerView.tileInfo,this.layerView.fullExtent);var r=this._computeFetchConcurrency();this._fetchQueue=new Qe.Z({tileInfoView:this._tileInfoView,concurrency:r,process:function(t,r){return e._fetchTile1(t,r)}});var n=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new He.Z({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:n,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,je.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}},{key:"acquireTile",value:function(e){var t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(function(){e.destroy(),t.layerView.requestUpdate()})),this.layerView.requestUpdate()}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;var r=e=e||this._tileInfoView.tileInfo.size,n=(0,_.Z)(r,2),i=n[0],a=n[1],s=new Ge.Z({width:i,height:a,pixels:[new Uint8Array(i*a)],mask:new Uint8Array(i*a),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}},{key:"_getBandIds",value:function(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;var e=this.layer,t=e.bandIds,r=e.raster,n="rasterFunction"in r?r.rasterFunction.rawInputBandIds:null;return null!==t&&void 0!==t&&t.length&&null!==n&&void 0!==n&&n.length&&1!==r.rasterInfo.bandCount?t.map((function(e){return n[Math.min(e,n.length-1)]})):t||n}},{key:"updateRasterFunctionParameters",value:function(){}},{key:"_fetchTile1",value:function(e,t){var r=null!=t?t.signal:null,n=this.canUseWebGLForProcessing(),i=this.layerView,a=i.tileInfo,s=!a.isWrappable&&null!=(0,qe.ut)(i.view.spatialReference),o=n&&this.layer.raster.hasUniqueSourceStorageInfo,u={allowPartialFill:!0,datumTransformation:i.datumTransformation,interpolation:n?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:o,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:r,srcResolution:this._srcResolutions[e.level],timeExtent:i.timeExtent,tileInfo:a,disableWrapAround:s};return this.fetchTile(e,u)}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.layerView,t=e.view.spatialReference;if(this._canUseLayerLODs()){var r=this.layer.tileInfo,n=r.origin,i=r.lods,a=i.map((function(e){return e.scale})),s=Ne.Z.create({spatialReference:t,size:Re.I_,scales:a,origin:n});return e.set("tileInfo",s),void(this._srcResolutions=i.map((function(e){var t=e.resolution;return{x:t,y:t}})))}var o=(0,We.jX)(this.layer.rasterInfo),u=(0,qe.vF)(this.layer.rasterInfo,t,{tileSize:Re.I_,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:o}),l=u.scales,c=u.srcResolutions,h=u.isCustomTilingScheme,f=Ne.Z.create({spatialReference:t,size:Re.I_,scales:l}),d=new Ae.Z({x:e.fullExtent.xmin,y:e.fullExtent.ymax,spatialReference:t});(0===f.origin.x||f.origin.x>d.x)&&(f.origin=d),this._isCustomTilingScheme=h,e.set("tileInfo",f),this._srcResolutions=null!==c&&void 0!==c?c:[]}},{key:"_canUseLayerLODs",value:function(){var e,t=this.layer,r=this.layerView;if("Map"!==t.raster.tileType)return!1;var n=t.tileInfo.lods,i=null===(e=r.view.constraints)||void 0===e?void 0:e.effectiveLODs;return(null===i||void 0===i?void 0:i.length)===n.length&&i.every((function(e,t){var r=e.scale;return Math.abs(r-n[t].scale)<.001}))}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updatingHandles.addPromise(this._enqueueTileFetch1(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_enqueueTileFetch1",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,o,u,l,c=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=30;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(i=e.sent,a=this._getBandIds(),s=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.layerView.moving||0!==this._fetchQueue.length){e.next=18;break}return s=!1,e.prev=9,e.next=12,this._redrawImage(null===(o=this._abortController)||void 0===o?void 0:o.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),(0,f.D_)(e.t0)&&h.Z.getLogger(this).error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:return!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams(),u=this._tileInfoView.getTileCoords(Ke,t.key),l=this._tileInfoView.getTileResolution(t.key),e.next=22,this.updateTileSource(t,{source:i,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:s,bandIds:a,coords:u,resolution:l});case 22:t.once("attach",(function(){return c.layerView.requestUpdate()})),this.container.addChild(t),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(1),(0,f.D_)(e.t1)||h.Z.getLogger(this).error(e.t1);case 29:this.layerView.requestUpdate();case 30:case"end":return e.stop()}}),e,this,[[1,26],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,a=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.container.children.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:if(!this.layerView.hasTilingEffects){e.next=9;break}return e.next=7,this._updateGlobalSymbolizerParams(t);case 7:e.next=10;break;case 9:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 10:return r=this.container.children.map(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.updateTileSymbolizerParameters(t,{local:a._symbolizerParams,global:a._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,(0,f.as)(r);case 13:this.container.requestRender();case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateGlobalSymbolizerParams",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,s,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,r);case 3:if((i=e.sent)&&i.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:a=this.previousLOD.resolution,s=this._getBandIds(),o=this.layer.symbolizer.generateWebGLParameters({pixelBlock:i.pixelBlock.extractBands(s),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:a,y:a},bandIds:s}),!this.canUseWebGLForProcessing()&&o&&"stretch"===o.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(o.factor=o.factor.map((function(e){return 255*e})),o.outMin=Math.round(255*o.outMin),o.outMax=Math.round(255*o.outMax)),this._globalSymbolizerParams=o;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){var e=this.previousLOD.resolution,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=this.layerView,n=t.url,i=t.raster,a=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:r.timeExtent}).multidimensionalDefinition,s=i.rasterInfo.multidimensionalInfo?i.getSliceIndex(a):null,o=(0,je.Rq)(n,s);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,je.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,je.z2)(o,i.rasterInfo),e){var u=r.view,l=this._tileInfoView.getClosestInfoForScale(u.scale),c=this._srcResolutions[l.level];(0,je.Vx)(o,this._blockCacheRegistryId,u.extent,u.resolution,c,i.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}},{key:"doRefresh",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,r=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.attached){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:return this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),t=[],this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.refresh((function(e){return t.push(r._enqueueTileFetch(e))})),e.next=12,(0,f.as)(t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(Oe.r);(0,l._)([(0,v.Cb)()],$e.prototype,"_fetchQueue",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"_globalUpdateRequested",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"attached",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"container",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"layer",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"layerView",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"type",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"useWebGLForProcessing",null),(0,l._)([(0,v.Cb)()],$e.prototype,"useProgressiveUpdate",null),(0,l._)([(0,v.Cb)()],$e.prototype,"timeExtent",void 0),(0,l._)([(0,v.Cb)()],$e.prototype,"updating",null),$e=(0,l._)([(0,m.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],$e);var et=r(31666),tt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).type="raster",e}return(0,s.Z)(r,[{key:"attach",value:function(){(0,b.Z)((0,x.Z)(r.prototype),"attach",this).call(this),this.container=new Le(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}},{key:"detach",value:function(){(0,b.Z)((0,x.Z)(r.prototype),"detach",this).call(this),this.container.removeAllChildren(),this.container=null}},{key:"canUseWebGLForProcessing",value:function(){var e,t=this.layer.symbolizer,r=null===(e=t.lookup)||void 0===e||null===(e=e.colormapLut)||void 0===e?void 0:e.indexedColormap,n=r&&r.length>this._maxIndexedColormapSize;return this.useWebGLForProcessing&&t.canRenderInWebGL&&!n&&!("majority"===this.layer.interpolation&&(0,et.JV)(this.layer))}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateRasterFunctionParameters",value:function(){var e=this.layer,t=e.raster,r=e.type,n=this.container;if("Function"!==t.datasetFormat||"wcs"===r)return n.rasterFunctionChain=null,n.children.forEach((function(e){var t=e.bitmap;t&&(t.suspended=!0,t.processed=!1,t.projected&&(t.invalidateTexture(),t.rasterTexture=null))})),void(this._rasterFunctionState="na");var i=this._rasterFunctionState,a=t.rasterFunction,s=t.primaryRasters,o=a.supportsGPU&&(!s||s.rasters.length<=1),u=o?a.flatWebGLFunctionChain:null,l=this.layer.renderer,c=!o||!(null!==u&&void 0!==u&&u.functions.length)||"raster-stretch"===(null===l||void 0===l?void 0:l.type)&&l.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();n.rasterFunctionChain=c?null:u;var h=null==a?"na":n.rasterFunctionChain?"gpu":"cpu";n.children.forEach((function(e){var t=e.bitmap;t&&(t.suspended=i!==h,t.processed=!1,t.processedTexture=null)})),this._rasterFunctionState=h}},{key:"updateTileSource",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,o,u,l,c,h,f,d,v,m,p,y;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._getBandIds(),s=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),u=r.source,l=r.globalSymbolizerParams,c=r.suspended,h=r.coords,f=r.resolution,d=this.layerView.hasTilingEffects?l:r.symbolizerParams,v=t.bitmap,i=(0,_.Z)(h,2),v.x=i[0],v.y=i[1],v.resolution=f,!u||null==u||null==u.pixelBlock){e.next=14;break}if(m={extent:u.extent,pixelBlock:u.pixelBlock},v.rawPixelData=m,!o){e.next=7;break}v.source=u.pixelBlock,v.isRendereredSource=!1,e.next=11;break;case 7:return e.next=9,this.layer.applyRenderer(m,"stretch"===(null===l||void 0===l?void 0:l.type)?l:void 0);case 9:p=e.sent,v.source=p,v.isRendereredSource=!0;case 11:v.symbolizerParameters=o?d:null,o?v.transformGrid||(v.transformGrid=u.transformGrid):v.transformGrid=null,e.next=16;break;case 14:y=this.createEmptyTilePixelBlock(),v.source=y,v.symbolizerParameters=o?d:null,v.transformGrid=null;case 16:v.bandIds=o?a:null,v.width=this._tileInfoView.tileInfo.size[0],v.height=this._tileInfoView.tileInfo.size[1],v.interpolation=s,v.suspended=c,v.invalidateTexture();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSymbolizerParameters",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,o,u,l,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.local,a=r.global,s=this._getBandIds(),o=this._getLayerInterpolation(),u=this.canUseWebGLForProcessing(),l=t.bitmap,c=l.rawPixelData,!u&&null!=c){e.next=5;break}l.isRendereredSource&&null!=c&&(l.source=c.pixelBlock),l.isRendereredSource=!1,e.next=9;break;case 5:return e.next=7,this.layer.applyRenderer(c,"stretch"===(null===a||void 0===a?void 0:a.type)?a:void 0);case 7:l.source=e.sent,l.isRendereredSource=!0;case 9:l.symbolizerParameters=u?this.layerView.hasTilingEffects?a:i:null,l.bandIds=u?s:null,l.interpolation=o,l.suspended=!1;case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLayerInterpolation",value:function(){var e=this.layer,t=e.interpolation,r=e.renderer;if(!r)return t;var n=r.type;return"raster-colormap"===n||"unique-value"===n||"class-breaks"===n?"nearest":"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),r}($e);(0,l._)([(0,v.Cb)()],tt.prototype,"container",void 0),(0,l._)([(0,v.Cb)()],tt.prototype,"layer",void 0),(0,l._)([(0,v.Cb)()],tt.prototype,"type",void 0);var rt=tt=(0,l._)([(0,m.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],tt),nt=r(64145),it=r(57874),at=r(60831),st=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i,s,o,u){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,a.Z)(this,r),(l=t.call(this,e,n,i,s,o,u)).tileData=new at.F(c),l.tileData.coordScale=[o,u],l.tileData.once("isReady",(function(){return l.ready()})),l}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,b.Z)((0,x.Z)(r.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{dvs:(0,Z.c)(),tileMat3:(0,Z.c)()}}},{key:"setTransform",value:function(e){(0,b.Z)((0,x.Z)(r.prototype),"setTransform",this).call(this,e);var t=this.resolution/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,i=(0,_.Z)(this.tileData.offset,2),a=i[0],s=i[1],o=[this.x+a*this.resolution,this.y-s*this.resolution],u=e.toScreenNoRotation([0,0],o),l=(0,_.Z)(u,2),c=l[0],h=l[1],f=this.tileData.symbolizerParameters.symbolTileSize,d=Math.round((this.width-this.tileData.offset[0])/f)*f,v=Math.round((this.height-this.tileData.offset[1])/f)*f,m=d/this.rangeX*t,p=v/this.rangeY*t;(0,I.s)(n,m,0,0,0,p,0,c,h,1),(0,I.m)(this.transforms.dvs,e.displayViewMat3,n),this.tileData.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),r}(ze.I),ot=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],e}return(0,s.Z)(r,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,T.Ue)(),e),r=(0,_.Z)(this._tileInfoView.tileInfo.size,2),n=r[0],i=r[1],a=this._tileInfoView.getTileResolution(e.level);return new st(e,a,t[0],t[3],n,i)}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"imagery (vf tile)",brushes:[it.Z],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:Be.jx.MAP});return[].concat((0,w.Z)((0,b.Z)((0,x.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[n])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===Be.jx.MAP&&this.symbolTypes.forEach((function(n){e.renderPass=n,(0,b.Z)((0,x.Z)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(De.Z),ut=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._handle=null,e.type="rasterVF",e}return(0,s.Z)(r,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,P.Z)((0,P.Z)({},r),{},{interpolation:"nearest",requestProjectedLocalDirections:!0}),e.next=3,this.layer.fetchTile(t.level,t.row,t.col,r);case 3:if(i=e.sent,e.t0="vector-magdir"===this.layer.rasterInfo.dataType&&null!==i&&void 0!==i&&i.pixelBlock,!e.t0){e.next=9;break}return e.next=8,this.layer.convertVectorFieldData(i.pixelBlock,r);case 8:i.pixelBlock=e.sent;case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSource",value:function(e,t){var r=t.symbolizerParams,n=e.tileData;n.key=e.key,n.width=this._tileInfoView.tileInfo.size[0],n.height=this._tileInfoView.tileInfo.size[1];var i=r.symbolTileSize,a=t.source;if(n.offset=this._getTileSymbolOffset(n.key,i),null!=a&&null!=a.pixelBlock){var s={extent:a.extent,pixelBlock:a.pixelBlock};n.rawPixelData=s,n.symbolizerParameters=r,n.source=this._sampleVectorFieldData(a.pixelBlock,r,n.offset)}else{var o=[Math.round((this._tileInfoView.tileInfo.size[0]-n.offset[0])/i),Math.round((this._tileInfoView.tileInfo.size[1]-n.offset[1])/i)],u=this.createEmptyTilePixelBlock(o);n.source=u,n.symbolizerParameters=r}return n.invalidateVAO(),Promise.resolve()}},{key:"updateTileSymbolizerParameters",value:function(e,t){var r,n=t.local,i=n.symbolTileSize,a=e.tileData;a.offset=this._getTileSymbolOffset(a.key,i);var s=a.symbolizerParameters.symbolTileSize;a.symbolizerParameters=n;var o=null===(r=a.rawPixelData)||void 0===r?void 0:r.pixelBlock;return null!=o&&s!==i&&(a.source=this._sampleVectorFieldData(o,a.symbolizerParameters,a.offset)),Promise.resolve()}},{key:"attach",value:function(){var e=this;(0,b.Z)((0,x.Z)(r.prototype),"attach",this).call(this),this.container=new ot(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,d.YP)((function(){return e.layer.renderer}),(function(t){return e._updateSymbolType(t)}))}},{key:"detach",value:function(){var e;(0,b.Z)((0,x.Z)(r.prototype),"detach",this).call(this),this.container.removeAllChildren(),null!==(e=this._handle)&&void 0!==e&&e.remove(),this._handle=null,this.container=null}},{key:"_getTileSymbolOffset",value:function(e,t){var r=e.col*this._tileInfoView.tileInfo.size[0]%t,n=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,n>t/2?t-n:-n]}},{key:"_sampleVectorFieldData",value:function(e,t,r){var n=t.symbolTileSize;return(0,nt.nb)(e,"vector-uv",n,r)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),r}($e);(0,l._)([(0,v.Cb)()],ut.prototype,"container",void 0),(0,l._)([(0,v.Cb)()],ut.prototype,"layer",void 0),(0,l._)([(0,v.Cb)()],ut.prototype,"type",void 0);var lt=ut=(0,l._)([(0,m.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],ut),ct=r(10064),ht=r(45948),ft=r(24405),dt=r(67581),vt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,e}return(0,s.Z)(r,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}},{key:"displayParameters",get:function(){var e=this.layer,t=this._get("displayParameters");return e.renderer?{bandIds:e.bandIds,renderer:e.renderer,interpolation:e.interpolation,multidimensionalDefinition:e.multidimensionalDefinition,rasterFunction:"imagery-tile"===e.type?e.rasterFunction:null}:t}},{key:"update",value:function(e){var t;null!==(t=this.subview)&&void 0!==t&&t.update(e),this.notifyChange("updating")}},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,d.YP)((function(){return e.displayParameters}),(function(t,r){var n,i,a=t.interpolation!==(null===r||void 0===r?void 0:r.interpolation)&&("majority"===t.interpolation||"majority"===(null===r||void 0===r?void 0:r.interpolation))&&(0,et.JV)(e.layer),s=t.renderer!==(null===r||void 0===r?void 0:r.renderer)&&(null===r||void 0===r||null===(n=r.renderer)||void 0===n?void 0:n.type)!==(null===(i=t.renderer)||void 0===i?void 0:i.type);s&&e._updateSubview();var o=t.multidimensionalDefinition!==(null===r||void 0===r?void 0:r.multidimensionalDefinition),u=t.rasterFunction!==(null===r||void 0===r?void 0:r.rasterFunction),l=u&&!e._useWebGLForProcessing,c=o||a||s||l;e.subview.redrawOrRefetch({refetch:c,reprocess:u}).catch((function(t){(0,f.D_)(t)||h.Z.getLogger(e).error(t)})),e.notifyChange("updating")})),(0,d.YP)((function(){var t;return null!==(t=e.layer.blendMode)&&void 0!==t?t:"normal"}),(function(t){e.subview.container.blendMode=t}),d.tX),(0,d.YP)((function(){var t;return null!==(t=e.layer.effect)&&void 0!==t?t:null}),(function(t){e.subview.container.effect=t}),d.tX),(0,d.YP)((function(){var t;return null!==(t=e.layer.multidimensionalSubset)&&void 0!==t?t:null}),(function(t,r){var n=e.layer.multidimensionalDefinition;null!=n&&(0,p.nb)(n,t)!==(0,p.nb)(n,r)&&(e.subview.redrawOrRefetch({refetch:!0}).catch((function(t){(0,f.D_)(t)||h.Z.getLogger(e).error(t)})),e.notifyChange("updating"))}),d.Z_),(0,d.YP)((function(){return e.timeExtent}),(function(){e.subview.timeExtent=e.timeExtent,e.subview.redrawOrRefetch({refetch:!0}).catch((function(t){(0,f.D_)(t)||h.Z.getLogger(e).error(t)}))}),d.nn)])}},{key:"detach",value:function(){var e;this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null!==(e=this.subview)&&void 0!==e&&e.destroy(),this.subview=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.subview.moveEnd()}},{key:"hitTest",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{type:"graphic",layer:this.layer,mapPoint:t,graphic:new c.Z({attributes:{},geometry:t.clone()})}]);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){return this.subview?this.subview.doRefresh():Promise.resolve()}},{key:"_updateSubview",value:function(){var e,t=null===(e=this.layer.renderer)||void 0===e?void 0:e.type;if(t){var r="vector-field"===t?"rasterVF":"flow"===t?"flow":"raster";if(this.subview){var n;if(this.subview.type===r)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null!==(n=this.subview)&&void 0!==n&&n.destroy(),this.subview=null}var i,a=this.layer;if("useWebGLForProcessing"in(i="rasterVF"===r?new lt({layer:a,layerView:this}):"flow"===r?new y.Z({layer:a,layerView:this}):new rt({layer:a,layerView:this}))&&(i.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in i&&(i.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in i){var s=this.subview;i.previousLOD=s&&"previousLOD"in s?s.previousLOD:null}this._attachSubview(i),this.subview=i,this.requestUpdate()}}},{key:"_attachSubview",value:function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}},{key:"_detachSubview",value:function(e){(null===e||void 0===e?void 0:e.attached)&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}}]),r}(function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.tileInfo=null,e}return(0,s.Z)(r,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"_getfullExtent",value:function(){return this.projectFullExtent(this.view.spatialReference)}},{key:"hasTilingEffects",get:function(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}},{key:"datumTransformation",get:function(){return(0,qe._D)(this.layer.fullExtent,this.view.spatialReference,!0)}},{key:"supportsSpatialReference",value:function(e){return!!this.projectFullExtent(e)}},{key:"projectFullExtent",value:function(e){var t=this.layer.fullExtent,r=(0,qe._D)(t,e,!1);return(0,qe.tB)(t,e,r)}},{key:"fetchPopupFeatures",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,o,u,l,h,f,d,v,m,p,y,g,_,b,x,w,T,k;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}throw new ct.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i});case 3:if(a=i.popupEnabled,s=(0,ft.V5)(i,r),a&&null!=s){e.next=6;break}throw new ct.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:s});case 6:return o=[],e.next=9,i.identify(t,{timeExtent:this.timeExtent});case 9:if(u=e.sent,l=u.value,h=u.magdirValue,f=u.processedValue,d="",l&&l.length){if(d="imagery-tile"===i.type&&i.hasStandardTime()&&null!=l[0]?l.map((function(e){return i.getStandardTimeValue(e)})).join(", "):l.join(", "),(m={ObjectId:0})[p="Raster.ServicePixelValue"]=null!==(v=null===f||void 0===f?void 0:f.join(", "))&&void 0!==v?v:d,m[p+".Raw"]=d,null!=(y=i.rasterInfo.attributeTable)&&(g=y.fields,_=y.features,b=g.find((function(e){return"value"===e.name.toLowerCase()})),x=b?_.find((function(e){return String(e.attributes[b.name])===d})):null,x))for(w in x.attributes)x.attributes.hasOwnProperty(w)&&(m[this._rasterFieldPrefix+w]=x.attributes[w]);"vector-magdir"!==(T=i.rasterInfo.dataType)&&"vector-uv"!==T||(m["Raster.Magnitude"]=null===h||void 0===h?void 0:h[0],m["Raster.Direction"]=null===h||void 0===h?void 0:h[1]),(k=new c.Z(this.fullExtent.clone(),null,m)).layer=i,k.sourceLayer=k.layer,o.push(k)}return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(e);return(0,l._)([(0,v.Cb)()],t.prototype,"layer",void 0),(0,l._)([(0,v.Cb)(ht.qG)],t.prototype,"timeExtent",void 0),(0,l._)([(0,v.Cb)()],t.prototype,"view",void 0),(0,l._)([(0,v.Cb)()],t.prototype,"fullExtent",null),(0,l._)([(0,v.Cb)()],t.prototype,"tileInfo",void 0),(0,l._)([(0,v.Cb)({readOnly:!0})],t.prototype,"hasTilingEffects",null),(0,l._)([(0,v.Cb)()],t.prototype,"datumTransformation",null),t=(0,l._)([(0,m.j)("esri.views.layers.ImageryTileLayerView")],t)}((0,r(13107).Z)((0,g.y)(dt.Z))));(0,l._)([(0,v.Cb)()],vt.prototype,"subview",void 0),(0,l._)([(0,v.Cb)()],vt.prototype,"useWebGLForProcessing",null),(0,l._)([(0,v.Cb)()],vt.prototype,"useProgressiveUpdate",null),(0,l._)([(0,v.Cb)({readOnly:!0})],vt.prototype,"displayParameters",null);var mt=vt=(0,l._)([(0,m.j)("esri.views.2d.layers.ImageryTileLayerView2D")],vt)},31666:function(e,t,r){r.d(t,{JV:function(){return a},oq:function(){return i}});var n=new(r(43404).X)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function i(e){return n.toJSON(e)}function a(e){var t=e.raster.rasterInfo,r=t.bandCount,n=t.attributeTable,i=t.colormap,a=t.pixelType;return 1===r&&(null!=n||null!=i||"u8"===a||"s8"===a)}},13107:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(27366),u=r(32718),l=r(66978),c=r(94172),h=r(49861),f=(r(25243),r(63780),r(93169),r(69912)),d=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,c.on)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){(0,l.D_)(t)||u.Z.getLogger(e).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return(0,o._)([(0,h.Cb)()],t.prototype,"layer",void 0),t=(0,o._)([(0,f.j)("esri.layers.mixins.RefreshableLayerView")],t)}},48673:function(e,t,r){r.d(t,{Br:function(){return c},Fm:function(){return p},N9:function(){return g},RA:function(){return _},Tc:function(){return f},Ue:function(){return d},iC:function(){return h},s9:function(){return l},v:function(){return y},xW:function(){return m},zS:function(){return v}});var n=r(29439),i=r(6394),a=r(83826),s=r(8548),o=r(57808),u=r(52311);function l(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",i=!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&"u8"===t.pixelType),l=i?s.Br.FLOAT:s.Br.UNSIGNED_BYTE,c=null==t.pixels||0===t.pixels.length?null:i?t.getAsRGBAFloat():t.getAsRGBA(),h=null===(r=e.capabilities.textureFloat)||void 0===r?void 0:r.textureFloatLinear,f=new u.X;return f.width=t.width,f.height=t.height,f.internalFormat=e.type===a.zO.WEBGL2&&i?s.lP.RGBA32F:s.VI.RGBA,f.samplingMode=!h||"bilinear"!==n&&"cubic"!==n?s.cw.NEAREST:s.cw.LINEAR,f.dataType=l,f.wrapMode=s.e8.CLAMP_TO_EDGE,new o.x(e,f,c)}function c(e,t){var r=t.spacing,i=t.offsets,l=t.coefficients,c=(0,n.Z)(t.size,2),h=c[0],f=c[1],d=r[0]>1,v=new u.X;v.width=d?4*h:h,v.height=f,v.internalFormat=e.type===a.zO.WEBGL2?s.lP.RGBA32F:s.VI.RGBA,v.dataType=s.Br.FLOAT,v.samplingMode=s.cw.NEAREST,v.wrapMode=s.e8.CLAMP_TO_EDGE;var m=new Float32Array(d?h*f*16:2*i.length);if(d&&null!=l)for(var p=0,y=0;p<l.length;p++)m[y++]=l[p],p%3==2&&(m[y++]=1);else for(var g=0;g<f;g++)for(var _=0;_<h;_++){var b=4*(g*h+_),x=2*(_*f+g);m[b]=i[x],m[b+1]=i[x+1],m[b+3]=-1===i[x]?0:1}return new o.x(e,v,m)}function h(e,t){var r=new u.X;return r.internalFormat=s.VI.RGBA,r.width=t.length/4,r.height=1,r.samplingMode=s.cw.NEAREST,r.wrapMode=s.e8.CLAMP_TO_EDGE,new o.x(e,r,t)}function f(e,t,r){return{u_flipY:!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u_applyTransform:!!e,u_opacity:arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u_transformSpacing:e?e.spacing:i.Z,u_transformGridSize:e?e.size:i.Z,u_targetImageSize:t,u_srcImageSize:r}}function d(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function v(e,t){return{u_scale:e,u_offset:t}}function m(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function p(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function y(e,t){var r=e.gl,n=t.glName,i=new Map;if(null==n)return i;for(var a,s=r.getProgramParameter(n,r.ACTIVE_UNIFORMS),o=0;o<s;o++)(a=r.getActiveUniform(n,o))&&i.set(a.name,{location:r.getUniformLocation(n,a.name),info:a});return i}function g(e,t,r){Object.keys(r).forEach((function(n){var i=t.get(n)||t.get(n+"[0]");i&&function(e,t,r,n){if(null===n||null==r)return!1;var i=n.info;switch(i.type){case s.Se.FLOAT:i.size>1?e.setUniform1fv(t,r):e.setUniform1f(t,r);break;case s.Se.FLOAT_VEC2:e.setUniform2fv(t,r);break;case s.Se.FLOAT_VEC3:e.setUniform3fv(t,r);break;case s.Se.FLOAT_VEC4:e.setUniform4fv(t,r);break;case s.Se.FLOAT_MAT3:e.setUniformMatrix3fv(t,r);break;case s.Se.FLOAT_MAT4:e.setUniformMatrix4fv(t,r);break;case s.Se.INT:i.size>1?e.setUniform1iv(t,r):e.setUniform1i(t,r);break;case s.Se.BOOL:e.setUniform1i(t,r?1:0);break;case s.Se.INT_VEC2:case s.Se.BOOL_VEC2:e.setUniform2iv(t,r);break;case s.Se.INT_VEC3:case s.Se.BOOL_VEC3:e.setUniform3iv(t,r);break;case s.Se.INT_VEC4:case s.Se.BOOL_VEC4:e.setUniform4iv(t,r);break;default:return!1}}(e,n,r[n],i)}))}function _(e,t,r,n){r.length===n.length&&(n.some((function(e){return null==e}))||r.some((function(e){return null==e}))||r.forEach((function(r,i){t.setUniform1i(r,i),e.bindTexture(n[i],i)})))}}}]);
//# sourceMappingURL=3076.23b12b8b.chunk.js.map