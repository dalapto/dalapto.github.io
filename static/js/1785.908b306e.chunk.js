"use strict";(self.webpackChunkreact_arcgis=self.webpackChunkreact_arcgis||[]).push([[1785,5164],{26885:function(e,t,r){r.d(t,{H:function(){return k}});var n=r(74165),i=r(15861),a=r(15671),s=r(43144),l=r(10064),u=r(93169),o=r(32718),d=r(92026),c=r(66978),f=r(94109),h=r(84328),p=r(84319),y=r(64668),v=r(8548),m=r(53634),g=r(57808),x=r(52311),_=o.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),b=(0,y.g)(y.J,_),E=function(){function e(t,r,n){(0,a.Z)(this,e),this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;var i=t.buffer,s=t.pixelType,l=t.textureOnly,u=(0,p.UK)(s);this.shared=n,this.pixelType=s,this.size=r,this.textureOnly=l,l||(this.data=new u(i)),this._resetRange()}return(0,s.Z)(e,[{key:"destroy",value:function(){var e=this;(0,d.yw)(this._texture,(function(e){return e.dispose()}));var t=function(t){(0,d.yw)(e._fbos[t],(function(e){"0"===t&&e.detachColorTexture(),e.dispose()})),e._fbos[t]=null};for(var r in this._fbos)t(r);this._texture=null}},{key:"_textureDesc",get:function(){var e=new x.X;return e.wrapMode=v.e8.CLAMP_TO_EDGE,e.samplingMode=v.cw.NEAREST,e.dataType=this.pixelType,e.width=this.size,e.height=this.size,e}},{key:"setData",value:function(e,t,r){var n=(0,h.jL)(e),i=this.data,a=n*this.texelSize+t;!i||a>=i.length||(i[a]=r,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n))}},{key:"getData",value:function(e,t){if(null==this.data)return null;var r=(0,h.jL)(e)*this.texelSize+t;return!this.data||r>=this.data.length?null:this.data[r]}},{key:"getTexture",value:function(e){var t;return null!==(t=this._texture)&&void 0!==t?t:this._initTexture(e)}},{key:"getFBO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this._fbos[t]){var r=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new m.X(e,r)}return this._fbos[t]}},{key:"locked",get:function(){return!(this.pixelType!==v.Br.UNSIGNED_BYTE||!this.shared||this.textureOnly||!(0,u.Z)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}},{key:"hasDirty",get:function(){var e=this.dirtyStart;return this.dirtyEnd>=e}},{key:"updateTexture",value:function(e,t){if(!this.locked){try{var r=this.dirtyStart,n=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();var i=this.data.buffer,a=this.getTexture(e),s=(r-r%this.size)/this.size,u=(n-n%this.size)/this.size,o=s,d=this.size,c=u,f=s*this.size*4,h=4*(d+c*this.size)-f,y=(0,p.UK)(this.pixelType),v=new y(i,f*y.BYTES_PER_ELEMENT,h),m=this.size,g=c-o+1;if(g>this.size)return void _.error(new l.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));a.updateData(0,0,o,m,g,v)}catch(x){}t()}}},{key:"update",value:function(e){var t=e.data,r=e.start,n=e.end;if(null!=t&&null!=this.data)for(var i=this.data,a=r*this.texelSize,s=0;s<t.length;s++){var l=1<<s%this.texelSize;e.layout&l&&(i[a+s]=t[s])}this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,n)}},{key:"resize",value:function(e,t){var r=this.size;if(this.size=t,this.textureOnly)r!==this.size&&(this._lastTexture=this._texture,this._texture=null);else{var n=(0,p.UK)(this.pixelType);this.destroy(),this.data=new n(e.buffer)}}},{key:"_resetRange",value:function(){this.dirtyStart=2147483647,this.dirtyEnd=0}},{key:"_initTexture",value:function(e){var t,r=new g.x(e,this._textureDesc,null!==(t=this.data)&&void 0!==t?t:void 0);if(null!=this._lastTexture&&this._fbos[0]){var n=this._lastTexture.descriptor.width,i=this._lastTexture.descriptor.height,a=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,l=this.getFBO(e),u=(0,p.Yw)(a),o=new((0,p.UK)(a))(new ArrayBuffer(n*i*u*this.texelSize)),d=e.getBoundFramebufferObject(),c=e.getViewport(),f=c.x,h=c.y,y=c.width,v=c.height;e.bindFramebuffer(l),l.readPixels(0,0,n,i,s,a,o),r.updateData(0,0,0,2*n,i/2,o),e.setViewport(f,h,y,v),e.bindFramebuffer(d)}return this.destroy(),this._texture=r,this._texture}}]),e}(),k=function(){function e(t){(0,a.Z)(this,e),this._onUpdate=t,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}return(0,s.Z)(e,[{key:"initialize",value:function(e){var t=e.blocks,r=e.shared,n=e.size;if(this.shared=r,this.size=n,b("Initializing AttributeStoreView",e),null==this._data)this._data=(0,d.Fd)(t,(function(e){return new E(e,n,r)}));else for(var i=0;i<this._data.length;i++){var a=this._data[i],s=t[i];null!=s&&(null==a?this._data[i]=new E(s,n,r):a.resize(s,n))}this._initialized=!0}},{key:"destroy",value:function(){(0,d.yw)(this._data,(function(e){return(0,d.Fd)(e,(function(e){return e.destroy()}))})),(0,d.yw)(this._defaultTexture,(function(e){return e.dispose()}))}},{key:"isEmpty",value:function(){return null==this._data}},{key:"isUpdating",value:function(){var e=null!=this._pendingAttributeUpdate,t=e;return(0,u.Z)("esri-2d-log-updating")&&console.log("Updating AttributeStoreView ".concat(t,"\n  -> hasPendingUpdate ").concat(e)),t}},{key:"getBlock",value:function(e){return null==this._data?null:this._data[e]}},{key:"setLabelMinZoom",value:function(e,t){this.setData(e,0,1,t)}},{key:"getLabelMinZoom",value:function(e){return this.getData(e,0,1,255)}},{key:"getFilterFlags",value:function(e){return this.getData(e,0,0,0)}},{key:"getVVSize",value:function(e){return this.getData(e,f.aK,0,0)}},{key:"getData",value:function(e,t,r,n){if(!this._data)return 0;var i=this._data[t];if(null==i)return 0;var a=i.getData(e,r);return null!=a?a:n}},{key:"setData",value:function(e,t,r,n){this._data[t].setData(e,r,n)}},{key:"lockTextureUpload",value:function(){this._locked=!0}},{key:"unlockTextureUpload",value:function(){this._locked=!1}},{key:"forceTextureUpload",value:function(){this._forceNextUpload=!0}},{key:"requestUpdate",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributeUpdate){e.next=2;break}return e.abrupt("return",void _.error(new l.Z("mapview-webgl","Tried to update attribute data with a pending update")));case 2:return r=(0,c.hh)(),e.abrupt("return",(b("AttributeStoreView Update Requested",t),this._pendingAttributeUpdate={data:t,resolver:r},this._onUpdate(),r.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){if(this._initialized&&null!=this._pendingAttributeUpdate){(0,u.Z)("esri-2d-update-debug")&&console.debug("AttributeStoreView::update");for(var e=this._pendingAttributeUpdate,t=e.data,r=e.resolver,n=this._data,i=function(e){var r=t.blocks[e],i=n[e];(0,d.yw)(i,(function(t){return(0,d.yw)(r,(function(r){b("Updating block ".concat(e),r),t.update(r)}))}))},a=0;a<t.blocks.length;a++)i(a);this._pendingAttributeUpdate=null,r(),this._onUpdate()}}},{key:"bindTextures",value:function(e){var t,r,n,i,a,s,l,u,o,c,h,p,y,v,m=this,g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(x,f.iJ),void(g&&(e.bindTexture(x,f.nM),e.bindTexture(x,f.Ij),e.bindTexture(x,f.f2),e.bindTexture(x,f.By),e.bindTexture(x,f.mx),e.bindTexture(x,f.Xj)));var _=this._data;this._locked&&!this._forceNextUpload||((0,d.JR)(_,(function(t){return t.updateTexture(e,(function(){return m._onUpdate()}))})),this._forceNextUpload=!1),e.bindTexture(null!==(t=null===(r=_[f._5])||void 0===r?void 0:r.getTexture(e))&&void 0!==t?t:x,f.iJ),g&&(e.bindTexture(null!==(n=null===(i=_[f.pU])||void 0===i?void 0:i.getTexture(e))&&void 0!==n?n:x,f.Xj),e.bindTexture(null!==(a=null===(s=_[f.xl])||void 0===s?void 0:s.getTexture(e))&&void 0!==a?a:x,f.nM),e.bindTexture(null!==(l=null===(u=_[f.aK])||void 0===u?void 0:u.getTexture(e))&&void 0!==l?l:x,f.Ij),e.bindTexture(null!==(o=null===(c=_[f.lK])||void 0===c?void 0:c.getTexture(e))&&void 0!==o?o:x,f.f2),e.bindTexture(null!==(h=null===(p=_[f.By])||void 0===p?void 0:p.getTexture(e))&&void 0!==h?h:x,f.By),e.bindTexture(null!==(y=null===(v=_[f.mx])||void 0===v?void 0:v.getTexture(e))&&void 0!==y?y:x,f.mx))}},{key:"_getDefaultTexture",value:function(e){if(null==this._defaultTexture){var t=new x.X;t.wrapMode=v.e8.CLAMP_TO_EDGE,t.samplingMode=v.cw.NEAREST,t.width=1,t.height=1,this._defaultTexture=new g.x(e,t,new Uint8Array(4))}return this._defaultTexture}}]),e}()},84328:function(e,t,r){r.d(t,{KS:function(){return o},PX:function(){return a},QS:function(){return c},_I:function(){return n},jL:function(){return u},nE:function(){return d},vs:function(){return l},xp:function(){return s}});var n=8388607,i=8388608,a=0,s=1,l=function(e){return(e&i)>>>23},u=function(e){return e&n},o=function(e){return l(e)===s?254:255};function d(e){return l(e)===s}function c(e,t){return((t?i:0)|e)>>>0}},39694:function(e,t,r){r.d(t,{I:function(){return u},S:function(){return o}});var n=r(74165),i=r(37762),a=r(15671),s=r(43144),l=r(70734),u=function(){function e(t,r,n,i,s){(0,a.Z)(this,e),this.target=t,this.geometryType=r,this.materialKey=n,this.indexFrom=i,this.indexCount=s}return(0,s.Z)(e,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}},{key:"extend",value:function(e){this.indexCount+=e}}]),e}(),o=function(){function e(t,r){(0,a.Z)(this,e),this.geometryType=0,this._target=t,this.geometryType=r}return(0,s.Z)(e,[{key:"addRecord",value:function(e){var t=this._target,r=this.geometryType,n=e.materialKey,i=e.indexFrom,a=e.indexCount,s=e.vertexFrom,o=e.vertexCount;if(a||(i=s,a=o),null!=this._head){for(var d=null,c=this._head;c;){if(i<c.data.indexFrom)return this._insert(n,i,a,d,c);d=c,c=c.next}this._insert(n,i,a,d,null)}else{var f=new u(t,r,n,i,a);this._head=new l.a(f)}}},{key:"forEach",value:function(e){null!=this._head&&this._head.forEach(e)}},{key:"infos",value:(0,n.Z)().mark((function e(){var t,r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this._head){e.next=18;break}t=(0,i.Z)(this._head.values()),e.prev=2,t.s();case 4:if((r=t.n()).done){e.next=10;break}return a=r.value,e.next=8,a;case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))},{key:"_insert",value:function(e,t,r,n,i){if(null==n&&null==i){var a=new u(this._target,this.geometryType,e,t,r);this._head=new l.a(a)}return null==n&&null!=i?this._insertAtHead(e,t,r,i):null!=n&&null==i?this._insertAtEnd(e,t,r,n):null!=n&&null!=i?this._insertAtMiddle(e,t,r,n,i):void 0}},{key:"_insertAtHead",value:function(e,t,r,n){var i=t+r;if(e===n.data.materialKey&&i===n.data.indexFrom)n.data.indexFrom=t,n.data.indexCount+=r;else{var a=new u(this._target,this.geometryType,e,t,r);this._head=new l.a(a),this._head.next=n}}},{key:"_insertAtEnd",value:function(e,t,r,n){if(n.data.materialKey===e&&n.data.indexEnd===t)n.data.indexCount+=r;else{var i=new u(this._target,this.geometryType,e,t,r),a=new l.a(i);n.next=a}}},{key:"_insertAtMiddle",value:function(e,t,r,n,i){var a=t+r;if(n.data.materialKey===e&&n.data.indexEnd===t)n.data.indexCount+=r,n.data.materialKey===i.data.materialKey&&n.data.indexEnd===i.data.indexFrom&&(n.data.indexCount+=i.data.indexCount,n.next=i.next);else if(e===i.data.materialKey&&a===i.data.indexFrom)i.data.indexFrom=t,i.data.indexCount+=r;else{var s=new u(this._target,this.geometryType,e,t,r),o=new l.a(s);n.next=o,o.next=i}}}],[{key:"from",value:function(t,r,n,a){var s=new e(t,r);if(null!=a){var l,u=(0,i.Z)(a);try{for(u.s();!(l=u.n()).done;){var o=l.value;n.seekIndex(o),s.addRecord(n)}}catch(d){u.e(d)}finally{u.f()}}else for(;n.next();)s.addRecord(n);return s}}]),e}()},72900:function(e,t,r){r.d(t,{I:function(){return c}});var n=r(29439),i=r(15671),a=r(43144),s=r(60136),l=r(29388),u=r(22753),o=r(87422),d=r(73828),c=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(e,n,a,s,l,u){var o,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:u;return(0,i.Z)(this,r),(o=t.call(this)).triangleCountReportedInDebug=0,o.triangleCount=0,o.texture=null,o.key=new d.Z(e),o.resolution=n,o.x=a,o.y=s,o.width=l,o.height=u,o.rangeX=c,o.rangeY=f,o}return(0,a.Z)(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e){var t=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,i=e.toScreenNoRotation([0,0],[this.x,this.y]),a=(0,n.Z)(i,2),s=a[0],l=a[1],o=this.width/this.rangeX*t,d=this.height/this.rangeY*t;(0,u.s)(r,o,0,0,0,d,0,s,l,1),(0,u.m)(this.transforms.dvs,e.displayViewMat3,r)}}]),r}(o.s)},98774:function(e,t,r){r.d(t,{o:function(){return m}});var n=r(29439),i=r(11752),a=r(61120),s=r(60136),l=r(29388),u=r(15671),o=r(43144),d=r(22018),c=r(11245),f=r(22753),h=r(23588),p=r(94109),y=r(72900),v=function(){function e(){(0,u.Z)(this,e)}return(0,o.Z)(e,[{key:"acquire",value:function(e){return{refCount:1,version:-1,labelMat2d:(0,c.c)(),tileMat3:(0,h.c)(),dvs:(0,h.c)()}}},{key:"release",value:function(e){}}]),e}(),m=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(e,n,i,a){return(0,u.Z)(this,r),t.call(this,e,n,i,a,p.I_,p.I_)}return(0,o.Z)(r,[{key:"destroy",value:function(){(0,i.Z)((0,a.Z)(r.prototype),"destroy",this).call(this),this._transforms&&r.TransformCache.release(this.key.hash)}},{key:"setTransform",value:function(e){var t=this.resolution/e.resolution,r=this.transforms.tileMat3,i=e.toScreenNoRotation([0,0],[this.x,this.y]),a=(0,n.Z)(i,2),s=a[0],l=a[1],u=this.width/this.rangeX*t,o=this.height/this.rangeY*t;(0,f.s)(r,u,0,0,0,o,0,s,l,1),(0,f.m)(this.transforms.dvs,e.displayViewMat3,r);var h=this.transforms.labelMat2d,p=window.devicePixelRatio,y=(0,d.d)((0,c.c)(),u*p,0,0,o*p,s*p,l*p);(0,d.m)(h,e.viewMat2d,y)}},{key:"_createTransforms",value:function(){return r.TransformCache.acquire(this.key.hash)}}]),r}(y.I);m.TransformCache=new v},50477:function(e,t,r){r.d(t,{$:function(){return u}});var n=r(15671),i=r(43144),a=r(94109),s=r(39694),l=2147483647,u=function(){function e(t){(0,n.Z)(this,e),this._head=t,this._cursor=t}return(0,i.Z)(e,[{key:"size",value:function(){for(var e=this._cursor,t=0;e;)t+=e.size(),e=e._link;return t}},{key:"id",get:function(){return this._cursor.id},set:function(e){this._cursor.id=e}},{key:"materialKey",get:function(){return this._cursor.materialKey},set:function(e){this._cursor.materialKey=e}},{key:"insertAfter",get:function(){return this._cursor.insertAfter}},{key:"indexFrom",get:function(){return this._cursor.indexFrom},set:function(e){this._cursor.indexFrom=e}},{key:"indexCount",get:function(){return this._cursor.indexCount},set:function(e){this._cursor.indexCount=e}},{key:"vertexFrom",get:function(){return this._cursor.vertexFrom},set:function(e){this._cursor.vertexFrom=e}},{key:"vertexCount",get:function(){return this._cursor.vertexCount},set:function(e){this._cursor.vertexCount=e}},{key:"sortKey",get:function(){return this._cursor.sortKey},set:function(e){this._cursor.sortKey=e}},{key:"index",get:function(){return this._cursor._indexStart+this._cursor._index}},{key:"seekIndex",value:function(e){var t=e;for(this._cursor=this._head;this._cursor;){var r=this._cursor.size();if(t<r)return this._cursor._index=t,!0;t-=r,this._cursor=this._cursor._link}return!1}},{key:"forEach",value:function(e){for(var t=this.getCursor();t.next();)e(t)}},{key:"link",value:function(e){if(this._head){for(var t=this._head;t._link;)t=t._link;t._link=e._head,t._link._indexStart=t._indexStart+t.size()}else this._head=e._head}},{key:"getCursor",value:function(){return this.copy()}},{key:"getDrawInfo",value:function(e,t){return new s.I(e,t,this.materialKey,this.indexFrom,this.indexCount)}},{key:"lookup",value:function(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}},{key:"copy",value:function(){var t,r=new e(null===(t=this._head)||void 0===t?void 0:t.copy());if(!r._head)return r;for(var n=r._head,i=r._head._link;i;)n._link=i.copy(),i=(n=i)._link;return r}},{key:"next",value:function(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}},{key:"peekId",value:function(){var e;return null!==(e=this._cursor.peekId())&&void 0!==e?e:this._cursor._link.peekId()}},{key:"delete",value:function(e){for(var t=this._head,r=null;t;){if(t.delete(e))return t.isEmpty()&&(null!=r&&(r._link=t._link),t===this._head&&(this._head=t._link),t===this._cursor&&(this._cursor=t._link)),!0;r=t,t=t._link}return!1}}],[{key:"from",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength/o.BYTES_PER_RECORD-r;return new e(new o(new Int32Array(t,r*o.BYTES_PER_RECORD,n*o.ELEMENTS_PER_RECORD)))}}]),e}();u.ELEMENTS_PER_RECORD=a.XJ,u.BYTES_PER_RECORD=u.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;var o=function(){function e(t){(0,n.Z)(this,e),this._link=null,this._index=-1,this._indexStart=0,this._packedRecordsF32=null,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=t}return(0,i.Z)(e,[{key:"delete",value:function(e){var t=this._index,r=this.lookup(e);if(r)for(this.id=l,++this._deletedCount;this.next()&&this.id===e;)this.id=l,++this._deletedCount;return this._index=t,r}},{key:"isEmpty",value:function(){return this._deletedCount===this.size()}},{key:"link",value:function(e){this._link?this._link.link(e):this._link=e}},{key:"lookup",value:function(e){if(null==this._offsets.instance){this._offsets.instance=new Map;var t=this.copy();t._index=-1;for(var r=0;t.next();)t.id!==r&&(this._offsets.instance.set(t.id,t._index),r=t.id)}if(!this._offsets.instance.has(e))return!1;var n=this._index;return this._index=this._offsets.instance.get(e),this.id!==l||(this._index=n,!1)}},{key:"id",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD]=t}},{key:"materialKey",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+1]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+1]=t}},{key:"insertAfter",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+2]}},{key:"indexFrom",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+3]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+3]=t}},{key:"indexCount",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+4]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+4]=t}},{key:"vertexFrom",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+5]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+5]=t}},{key:"vertexCount",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+6]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+6]=t}},{key:"sortKey",get:function(){return this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*e.ELEMENTS_PER_RECORD+7]},set:function(t){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*e.ELEMENTS_PER_RECORD+7]=t}},{key:"index",get:function(){return this._index}},{key:"size",value:function(){return this._packedRecords.length/e.ELEMENTS_PER_RECORD}},{key:"next",value:function(){for(;++this._index<this.size()&&this.id===l;);return this._index<this.size()}},{key:"peekId",value:function(){var t=(this._index+1)*e.ELEMENTS_PER_RECORD;return t>=this._packedRecords.length?0:this._packedRecords[t]}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this._packedRecords);return t._indexStart=this._indexStart,t._link=this._link,t._index=this._index,t._offsets=this._offsets,t._deletedCount=this._deletedCount,t}}],[{key:"from",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength/this.BYTES_PER_RECORD-r;return new e(new Int32Array(t,r*this.BYTES_PER_RECORD,n*this.ELEMENTS_PER_RECORD))}}]),e}();o.ELEMENTS_PER_RECORD=a.XJ,o.BYTES_PER_RECORD=o.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},70734:function(e,t,r){r.d(t,{a:function(){return s},m:function(){return l}});var n=r(74165),i=r(15671),a=r(43144),s=function(){function e(t){if((0,i.Z)(this,e),this.next=null,Array.isArray(t)){this.data=t[0];for(var r=this,n=1;n<t.length;n++)r.next=new e([t[n]]),r=r.next}else this.data=t}return(0,a.Z)(e,[{key:"values",value:(0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this;case 1:if(!t){e.next=7;break}return e.next=4,t.data;case 4:t=t.next;case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"forEach",value:function(e){for(var t=this;t;)e(t.data),t=t.next}},{key:"find",value:function(e){var t;return e(this.data)?this:null===(t=this.next)||void 0===t?void 0:t.find(e)}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,r=e(this.data)>e(t.data)?this:t;return this.next?this.next.max(e,r):r}},{key:"remove",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this===e?n?(n.next=this.next,n):this.next:null!==(t=null===(r=this.next)||void 0===r?void 0:r.remove(e,this))&&void 0!==t?t:null}},{key:"last",get:function(){return this.next?this.next.last:this}}]),e}(),l=function(){function e(t){(0,i.Z)(this,e),this._head=null,null!=t&&(this._head=new s(t))}return(0,a.Z)(e,[{key:"head",get:function(){return this._head}},{key:"maxAvailableSpace",value:function(){if(null==this._head)return 0;var e=this._head.max((function(e){return e.end-e.start}));return e.data.end-e.data.start}},{key:"firstFit",value:function(e){if(null==this._head)return null;for(var t=null,r=this._head;r;){var n=r.data.end-r.data.start;if(n===e)return t?t.next=r.next:this._head=r.next,r.data.start;if(n>e){var i=r.data.start;return r.data.start+=e,i}t=r,r=r.next}return null}},{key:"free",value:function(e,t){var r=e+t;if(null!=this._head){if(r<=this._head.data.start){if(r===this._head.data.start)return void(this._head.data.start-=t);var n=new s({start:e,end:r});return n.next=this._head,void(this._head=n)}for(var i=this._head,a=i.next;a;){if(a.data.start>=r){if(i.data.end===e){if(i.data.end+=t,i.data.end===a.data.start){var l=a.data.end-a.data.start;return i.data.end+=l,void(i.next=a.next)}return}if(a.data.start===r)return void(a.data.start-=t);var u=new s({start:e,end:r});return u.next=i.next,void(i.next=u)}i=a,a=a.next}if(e!==i.data.end){var o=new s({start:e,end:r});i.next=o}else i.data.end+=t}else{var d=new s({start:e,end:r});this._head=d}}}]),e}()},64668:function(e,t,r){r.d(t,{J:function(){return i},g:function(){return n}});var n=function(e,t){return e&&function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.warn.apply(t,["DEBUG:"].concat(r))}||function(){return null}},i=!1},18745:function(e,t,r){r.d(t,{a:function(){return l}});var n=r(10064),i=r(32718),a=r(80613),s=r(84319);function l(e){return(0,s.hj)(e.minDataValue)&&(0,s.hj)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.X.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.X.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.X.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.X.SIZE_UNIT_VALUE:(i.Z.getLogger("esri.views.2d.engine.webgl").error(new n.Z("mapview-bad-type","Found invalid size VisualVariable",e)),a.X.NONE)}},85164:function(e,t,r){r.r(t),r.d(t,{createSymbolSchema:function(){return u}});var n=r(1413),i=r(80613),a=r(54815);function s(e){var t;return"line-marker"===e.type?{type:"line-marker",color:null===(t=e.color)||void 0===t?void 0:t.toJSON(),placement:e.placement,style:e.style}:e.constructor.fromJSON(e.toJSON()).toJSON()}function l(e){return(0,a.hF)(e)}function u(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;switch(e.type){case"simple-fill":case"picture-fill":return function(e,t,r){var u=(0,a.jj)(i.LW.FILL,t),o=r?l(u):u,d=e.clone(),c=d.outline,f=(0,a.jy)(t.symbologyType);f||(d.outline=null);var h=(0,n.Z)({materialKey:o,hash:d.hash()},s(d));if(f)return h;var p=[];if(p.push(h),c){var y=(0,a.jj)(i.LW.LINE,(0,n.Z)((0,n.Z)({},t),{},{isOutline:!0})),v=(0,n.Z)({materialKey:r?l(y):y,hash:c.hash()},s(c));p.push(v)}return{type:"composite-symbol",layers:p,hash:p.reduce((function(e,t){return t.hash+e}),"")}}(e,t,r);case"simple-marker":case"picture-marker":return function(e,t,r){var u=(0,a.jj)(i.LW.MARKER,t),o=r?l(u):u,d=s(e);return(0,n.Z)((0,n.Z)({materialKey:o,hash:e.hash()},d),{},{angle:e.angle,maxVVSize:t.maxVVSize})}(e,t,r);case"simple-line":return function(e,t,r){var u=(0,a.jy)(t.symbologyType)?i.mD.DEFAULT:t.symbologyType,o=(0,a.jj)(i.LW.LINE,(0,n.Z)((0,n.Z)({},t),{},{symbologyType:u})),d=r?l(o):o,c=e.clone(),f=c.marker;c.marker=null;var h=[];if(h.push((0,n.Z)({materialKey:d,hash:c.hash()},s(c))),f){var p,y=(0,a.jj)(i.LW.MARKER,t),v=r?l(y):y;f.color=null!==(p=f.color)&&void 0!==p?p:c.color,h.push((0,n.Z)({materialKey:v,hash:f.hash(),lineWidth:c.width},s(f)))}return{type:"composite-symbol",layers:h,hash:h.reduce((function(e,t){return t.hash+e}),"")}}(e,t,r);case"text":return function(e,t,r){var u=(0,a.jj)(i.LW.TEXT,t),o=r?l(u):u,d=s(e);return(0,n.Z)((0,n.Z)({materialKey:o,hash:e.hash()},d),{},{angle:e.angle,maxVVSize:t.maxVVSize})}(e,t,r);case"label":return function(e,t,r){var s=e.toJSON(),u=(0,a.jj)(i.LW.LABEL,(0,n.Z)((0,n.Z)({},t),{},{placement:s.labelPlacement}));return(0,n.Z)((0,n.Z)({materialKey:r?l(u):u,hash:e.hash()},s),{},{labelPlacement:s.labelPlacement})}(e,t,r);case"cim":return{type:"cim",rendererKey:t.vvFlags,data:e.data,maxVVSize:t.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:t.vvFlags,data:e,maxVVSize:t.maxVVSize};case"web-style":return(0,n.Z)((0,n.Z)({},s(e)),{},{type:"web-style",hash:e.hash(),rendererKey:t.vvFlags,maxVVSize:t.maxVVSize});default:throw new Error("symbol not supported ".concat(e.type))}}},69534:function(e,t,r){r.d(t,{MD:function(){return U},Ew:function(){return M},q5:function(){return F}});var n=r(93433),i=r(1413),a=r(37762),s=r(63780),l=r(10064),u=r(93169),o=r(32718),d=r(17842),c=r(76672),f=r(48732),h=r(85116),p=r(80613),y=r(84319),v=r(98029),m=r(18745);function g(e){if(!e)return p.X.NONE;var t,r=0,n=(0,a.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if("size"===i.type){var s=(0,m.a)(i);r|=s,"outline"===i.target&&(r|=s<<4)}else"color"===i.type?r|=p.X.COLOR:"opacity"===i.type?r|=p.X.OPACITY:"rotation"===i.type&&(r|=p.X.ROTATION)}}catch(l){n.e(l)}finally{n.f()}return r}var x=r(85164),_=(r(78915),r(691)),b=r(94109);r(95857),r(98125);function E(e,t){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var r=e.getVisualVariablesForType("size");if(!r[0])return 0;var n=r[0];if(t&&"cluster_count"===n.field&&"cluster"===t.type)return t.clusterMaxSize;if("outline"===n.target)return 0;if("stops"===n.transformationType)return n.stops.map((function(e){return e.size})).reduce(k,0);if("clamped-linear"===n.transformationType){var i,a;return i="number"==typeof n.maxSize?n.maxSize:n.maxSize.stops.map((function(e){return e.size})).reduce(k,0),a="number"==typeof n.minSize?n.minSize:n.minSize.stops.map((function(e){return e.size})).reduce(k,0),Math.max(i,a)}return"real-world-size"===n.transformationType?30:void 0}b.eF.metrics,new _.Z(0,0,24,24);function k(e,t){return Math.max(e,t)}var T=r(91370),S=r(20478),w=r(31666),R=o.Z.getLogger("esri.views.2d.layers.features.schemaUtils"),Z="ValidationError";function F(e,t){var r=0,n=0,i=p.mD.DEFAULT;if(null!=e){if(n=E(e,t),"visualVariables"in e&&(r=g(e.visualVariables||[]),"dot-density"===e.type&&(i=p.mD.DOT_DENSITY)),"heatmap"===e.type&&(i=p.mD.HEATMAP),"dictionary"===e.type)return{maxVVSize:n,vvFlags:r,symbologyType:p.mD.DEFAULT};if("pie-chart"===e.type)return{maxVVSize:n,vvFlags:r,symbologyType:p.mD.PIE_CHART};if(i!==p.mD.DOT_DENSITY&&i!==p.mD.HEATMAP){var s=e.getSymbols();"backgroundFillSymbol"in e&&e.backgroundFillSymbol&&s.push(e.backgroundFillSymbol);var l,u=!0,o=!0,d=(0,a.Z)(s);try{for(d.s();!(l=d.n()).done;){var c=l.value;if("cim"!==c.type&&"web-style"!==c.type||(o=!1),"simple-fill"===c.type||"picture-fill"===c.type){var f=c.outline,h=f&&"none"!==f.style&&"solid"!==f.style,y="simple-fill"===c.type&&"none"!==c.style&&"solid"!==c.style;h&&(u=!1),("picture-fill"===c.type||y||h)&&(o=!1)}}}catch(v){d.e(v)}finally{d.f()}u?i=o?p.mD.OUTLINE_FILL_SIMPLE:p.mD.OUTLINE_FILL:o&&(i=p.mD.SIMPLE)}}return{vvFlags:r,maxVVSize:n,symbologyType:i}}var z=null;function M(e){if((0,u.Z)("esri-2d-update-debug")){var t=C(e,!0);console.debug("Created new schema",t),console.debug("Schema diff",(0,f.Hg)(z,t)),z=t}return C(e)}function C(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r,s,u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Array,i=0;return r.push(function(e,t){var r,i,s,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o={indexCount:0,fields:{}},d="featureReduction"in e&&null!==(r=e.featureReduction)&&void 0!==r?r:void 0,c=d?"aggregate":"feature";if("sublayers"in e){var f,y={type:"subtype",subtypeField:e.subtypeField,renderers:{},symbologyType:p.mD.DEFAULT},v={type:"subtype",mapping:{},target:"feature",subtypeField:e.subtypeField},m={type:"subtype",classes:{}},_={type:"symbol",target:"feature",aggregateFields:[],attributes:o,storage:v,mesh:{matcher:y,aggregateMatcher:null,labels:m,sortKey:null}},b=new Set,E=0,k=(0,a.Z)(e.sublayers);try{var z=function(){var e=f.value,t=e.renderer,r=e.subtypeCode,n=e.labelingInfo,i=e.labelsVisible,a=0;"visualVariables"in t&&t.visualVariables&&(t.visualVariables.some((function(e){return"rotation"!==e.type}))&&R.warnOnce("SubtypeGroupLayer currently only supports rotation visualVariables. All other visualVariable types will be ignored."),a=g(t.visualVariables.filter((function(e){return"size"!==e.type}))));var s={symbologyType:p.mD.DEFAULT,vvFlags:a,maxVVSize:0},d=U(o,c,t,s,u),h=P(o,c,t),x=i&&n;if("dictionary"===d.type)throw new l.Z(Z,"Dictionary renderer is not supported in subtype layers");if("subtype"===d.type)throw new l.Z(Z,"Nested subtype renderers is not supported");if(null!=h&&"subtype"===h.type)throw new l.Z(Z,"Nested subtype storage is not supported");if(null!=h&&null!=h.attributeMapping)throw new l.Z(Z,"Non-visual-variable attributes are not supported in subtype layers");if("heatmap"===d.type)throw new l.Z(Z,"Heatmaps are not supported in subtype layers");if("pie-chart"===d.type)throw new l.Z(Z,"Pie-charts are not supported in subtype layers");if(b.has(r))throw new l.Z(Z,"Subtype codes for sublayers must be unique");b.add(r),y.renderers[r]=d,v.mapping[r]=h,x&&(m.classes[r]=x.map((function(e){return N(o,e,"feature",E++,s,u)})))};for(k.s();!(f=k.n()).done;)z()}catch(W){k.e(W)}finally{k.f()}return _}if("heatmap"===(null===(i=e.renderer)||void 0===i?void 0:i.type)&&"raster"===(0,T.rk)()){var M=e.renderer,C=M.radius,D=M.fieldOffset,I=M.field;return{type:"heatmap",aggregateFields:[],attributes:o,target:c,storage:null,mesh:{radius:C,fieldOffset:D,field:L(o,{target:c,field:I,resultType:"numeric"}).field}}}var V=function(e,t,r){var i,s,u="featureReduction"in t&&t.featureReduction;if(!u)return{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};var o="aggregate",d=[],c=null,f=(0,w.oq)(t.geometryType),p=[],y=null;if(u)switch(u.type){case"selection":return R.error(new l.Z(Z,"Mapview does not support `selection` reduction type",u)),{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};case"cluster":case"binning":if(d.push.apply(d,(0,n.Z)(null!==(i=u.fields)&&void 0!==i?i:[])),"cluster"===u.type?f="esriGeometryPoint":"binning"===u.type&&(f="esriGeometryPolygon"),!u.renderer||null!==(s=u.renderer.authoringInfo)&&void 0!==s&&s.isAutoGenerated){if("cluster"===u.type){if(y=(0,S.S1)(d,t.renderer,u,null,!0),u.symbol){var v=F(y,u);c={type:"simple",symbol:(0,x.createSymbolSchema)(u.symbol,v,r),symbologyType:v.symbologyType}}p=u&&u.labelsVisible&&u.labelingInfo||[]}}else{if("cluster"===u.type)y=(0,S.st)(u.renderer,u,null).renderer;else y=u.renderer;var m=F(u.renderer,u);c=U(e,o,u.renderer,m,r),p=u&&u.labelsVisible&&u.labelingInfo||[]}}return function(e,t){var r,n={mesh:!0,storage:!0},i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;){var s=r.value,l=s.name,u=s.onStatisticField,o=s.onStatisticExpression,d=s.statisticType,c=void 0,f=void 0,h="numeric",p="feature";o?f=A(e,{type:"expression",target:p,valueExpression:o.expression,resultType:h}).fieldIndex:c=A(e,{type:"field",target:p,field:u,resultType:h}).field,A(e,{type:"statistic",target:"aggregate",name:l,context:n,inField:c,inFieldIndex:f,statisticType:d})}}catch(W){i.e(W)}finally{i.f()}}(e,d),{labels:(0,h.a)(p,"binning"===u.type?"esriGeometryPolygon":f),matcher:c,fields:d,rendererOverride:y}}(o,e,u),O=(0,w.oq)(e.geometryType),B=null!==(s=V.rendererOverride)&&void 0!==s?s:e.renderer,K=F(B,d),X=U(o,c,B,K,u),j=P(o,c,B),J=function(e,t,r,n){if(null!=n)return null;if(null!=t&&t.length){t.length>1&&R.warn("Layer rendering currently only supports ordering by 1 orderByInfo, but found ".concat(t.length,". All but the first will be discarded"));var i=t[0],a="ascending"===i.order?"asc":"desc";return i.field?{field:i.field,order:a}:i.valueExpression?{fieldIndex:A(e,{type:"expression",target:"feature",valueExpression:i.valueExpression,resultType:"numeric"}).fieldIndex,order:a}:(R.error(new l.Z(Z,"Expected to find a field or valueExpression for OrderByInfo",i)),null)}if(null!=r&&"unique-value"===r.type&&r.orderByClassesEnabled)return{byRenderer:!0,order:"asc"};return null}(o,e.orderBy,e.renderer,d),q=e.labelsVisible&&e.labelingInfo||[],G=(0,h.a)(q,O),Y=0,H=[].concat((0,n.Z)(G.map((function(e){return N(o,e,"feature",Y++,K,u)}))),(0,n.Z)(V.labels.map((function(e){return N(o,e,"aggregate",Y++,K,u)}))));return{type:"symbol",target:c,attributes:o,aggregateFields:V.fields,storage:j,mesh:{matcher:X,labels:{type:"simple",classes:H},aggregateMatcher:V.matcher,sortKey:J}}}(e,i++,t)),r}(e,t),o=function(e){var t;return"heatmap"===(null===(t=e.renderer)||void 0===t?void 0:t.type)&&"raster"===(0,T.rk)()?{type:"heatmap"}:{type:"symbol"}}(e),f={};u.map((function(t){return function(e,t,r){switch(r.target){case"feature":return void V(e,I(t),r);case"aggregate":if(!("featureReduction"in t))return;var n=t.featureReduction;switch(null===n||void 0===n?void 0:n.type){case"selection":throw new l.Z(Z,"Mapview does not support `selection` reduction type",n);case"binning":return V(e,I(t),r),void function(e,t,r,n){var a;e.aggregate||(e.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:t.fixedBinLevel,fields:(null!==(a=t.fields)&&void 0!==a?a:[]).map((function(e){return(0,i.Z)((0,i.Z)({},e.toJSON()),{},{type:O(e,r)})}))},attributes:{}}),D(e.aggregate,n.attributes.fields)}(e,n,t.fields.map((function(e){return e.toJSON()})),r);case"cluster":return V(e,I(t),r),void function(e,t,r,n){var s,l,u,o=null!==(s=n.aggregateFields)&&void 0!==s?s:[],c=new Set,f=(0,a.Z)(o);try{for(f.s();!(u=f.n()).done;){var h=u.value;c.add(h.name)}}catch(m){f.e(m)}finally{f.f()}var p,y=(0,a.Z)(null!==(l=null===t||void 0===t?void 0:t.fields)&&void 0!==l?l:[]);try{for(y.s();!(p=y.n()).done;){var v=p.value;c.has(v.name)||o.push(v)}}catch(m){y.e(m)}finally{y.f()}e.aggregate||(e.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:(0,d.F2)(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil((0,d.F2)(t.clusterMaxSize)/64),fields:o.map((function(e){return(0,i.Z)((0,i.Z)({},e.toJSON()),{},{type:O(e,r)})}))}}),D(e.aggregate,n.attributes.fields)}(e,n,t.fields.map((function(e){return e.toJSON()})),r)}}}(f,e,t)}));var y=null!=e.subtypeCode?"".concat(e.subtypeField," = ").concat(e.subtypeCode):null;return{source:{definitionExpression:(0,c._)(e.definitionExpression,y),fields:e.fields.map((function(e){return e.toJSON()})),gdbVersion:e.gdbVersion,historicMoment:null===(r=e.historicMoment)||void 0===r?void 0:r.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null===(s=e.timeExtent)||void 0===s?void 0:s.toJSON(),customParameters:e.customParameters},attributes:{fields:{},indexCount:0},processors:u,tileRenderer:o,targets:f}}catch(v){if(v.fieldName===Z)return R.error(v),null;throw v}}function D(e,t){for(var r in t){var n=t[r];if(n.target===e.name){var i=e.attributes[r];if(null!==i&&void 0!==i&&i.context){var a,s,l=i.context;l.mesh=l.mesh||(null===(a=n.context)||void 0===a?void 0:a.mesh),l.storage=l.storage||(null===(s=n.context)||void 0===s?void 0:s.storage)}else e.attributes[r]=n}}return e}function I(e){var t,r,n,i;return[null!==(t=null===(r=e.filter)||void 0===r?void 0:r.toJSON())&&void 0!==t?t:null,null!==(n=null===(i=e.featureEffect)||void 0===i||null===(i=i.filter)||void 0===i?void 0:i.toJSON())&&void 0!==n?n:null]}function V(e,t,r){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),D(e.feature,r.attributes.fields),e}function O(e,t){var r=e.onStatisticExpression,n=e.onStatisticField;switch(e.statisticType){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":if(r){var i=r.returnType;return i?"string"===i?"esriFieldTypeString":"esriFieldTypeDouble":(R.error(new l.Z(Z,"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",e)),"esriFieldTypeString")}var a=t.find((function(e){return e.name===n}));return a?a.type:(R.error(new l.Z(Z,"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",e)),"esriFieldTypeString")}}function L(e,t){return t.field?A(e,(0,i.Z)((0,i.Z)({},t),{},{type:"field",field:t.field})):t.valueExpression?A(e,(0,i.Z)((0,i.Z)({},t),{},{type:"expression",valueExpression:t.valueExpression})):{field:void 0,fieldIndex:void 0}}function A(e,t){switch(t.type){case"expression":var r=t.valueExpression;if(!e.fields[r]){var n=e.indexCount++;e.fields[r]=(0,i.Z)((0,i.Z)({},t),{},{name:r,fieldIndex:n})}return{fieldIndex:e.fields[r].fieldIndex};case"label-expression":var a=JSON.stringify(t.label);if(!e.fields[a]){var s=e.indexCount++;e.fields[a]=(0,i.Z)((0,i.Z)({},t),{},{name:a,fieldIndex:s})}return{fieldIndex:e.fields[a].fieldIndex};case"field":var l=t.field;return"aggregate"===t.target&&e.fields[l]||(e.fields[l]=(0,i.Z)((0,i.Z)({},t),{},{name:l})),{field:l};case"statistic":return e.fields[t.name]=(0,i.Z)({},t),{field:t.name}}}function N(e,t,r,n,a){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=A(e,{type:"label-expression",target:r,context:{mesh:!0},resultType:"string",label:{labelExpression:t.labelExpression,labelExpressionInfo:t.labelExpressionInfo?{expression:t.labelExpressionInfo.expression}:null,symbol:!!t.symbol,where:t.where}}).fieldIndex;return(0,i.Z)((0,i.Z)({},(0,x.createSymbolSchema)(t,a,s)),{},{fieldIndex:l,target:r,index:n})}function P(e,t,r){var n;switch(r.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":n={visualVariables:!0,attributes:null};break;default:n=(0,v.EJ)(r).getStorageSpec(r)}return function(e,t,r,n){if(null==r)return null;var i=r.visualVariables,a=r.attributes,l=null;i&&"visualVariables"in n&&(l=function(e,t,r){if(!r||!r.length)return[];var n={storage:!0},i="numeric";return(0,T.tv)(r).map((function(r){var a,s=(0,y.nU)(r.type),l=L(e,{target:t,valueExpression:r.valueExpression,field:r.field,context:n,resultType:i}),u=l.field,o=l.fieldIndex;switch(r.type){case"size":return"$view.scale"===r.valueExpression?null:{type:"size",binding:s,field:u,fieldIndex:o,normalizationField:L(e,{target:t,field:r.normalizationField,context:n,resultType:i}).field,valueRepresentation:null!==(a=r.valueRepresentation)&&void 0!==a?a:null};case"color":return{type:"color",binding:s,field:u,fieldIndex:o,normalizationField:L(e,{target:t,field:r.normalizationField,context:n,resultType:i}).field};case"opacity":return{type:"opacity",binding:s,field:u,fieldIndex:o,normalizationField:L(e,{target:t,field:r.normalizationField,context:n,resultType:i}).field};case"rotation":return{type:"rotation",binding:s,field:u,fieldIndex:o}}})).filter(s.pC)}(e,t,n.visualVariables));var u=null!=l?4:0,o=null;return null!=a&&(o=a.map((function(r,n){var i=L(e,{valueExpression:r.valueExpression,field:r.field,resultType:"numeric",target:t}),a=i.field,s=i.fieldIndex;return{binding:n+u,field:a,fieldIndex:s}}))),{type:"simple",target:t,attributeMapping:o,vvMapping:l}}(e,t,n,r)}function U(e,t,r,n){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=null!==e&&void 0!==e?e:{indexCount:0,fields:{}};switch(r.type){case"simple":case"dot-density":return function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t.getSymbols(),a=i.length?i[0]:null;return{type:"simple",symbol:(0,x.createSymbolSchema)(a,r,n),symbologyType:r.symbologyType}}(u,r,n,s);case"class-breaks":return function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a={mesh:!0,use:"renderer.field"},s=r.backgroundFillSymbol,l=L(e,{target:t,field:r.field,valueExpression:r.valueExpression,resultType:"numeric",context:a}),u=l.field,o=l.fieldIndex,d=r.normalizationType,c="log"===d?"esriNormalizeByLog":"percent-of-total"===d?"esriNormalizeByPercentOfTotal":"field"===d?"esriNormalizeByField":null,f=r.classBreakInfos.map((function(e){return{symbol:(0,x.createSymbolSchema)(e.symbol,n,i),min:e.minValue,max:e.maxValue}})).sort((function(e,t){return e.min-t.min}));return{type:"interval",attributes:e.fields,field:u,fieldIndex:o,backgroundFillSymbol:(0,x.createSymbolSchema)(s,n,i),defaultSymbol:(0,x.createSymbolSchema)(r.defaultSymbol,n,i),intervals:f,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:c,isMaxInclusive:r.isMaxInclusive,symbologyType:n.symbologyType}}(u,t,r,n,s);case"unique-value":return function(e,t,r,n){var s,u,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=[],c=r.backgroundFillSymbol,f={target:t,context:{mesh:!0},resultType:"string"};if(r.field&&"string"!=typeof r.field)throw new l.Z(Z,"Expected renderer.field to be a string",r);var h,p=L(e,(0,i.Z)((0,i.Z)({},f),{},{field:r.field,valueExpression:r.valueExpression})),y=p.field,v=p.fieldIndex,m=(0,a.Z)(null!==(u=r.uniqueValueInfos)&&void 0!==u?u:[]);try{for(m.s();!(h=m.n()).done;){var g=h.value;d.push({value:""+g.value,symbol:(0,x.createSymbolSchema)(g.symbol,n,o)})}}catch(_){m.e(_)}finally{m.f()}return{type:"map",attributes:e.fields,field:y,fieldIndex:v,field2:L(e,(0,i.Z)((0,i.Z)({},f),{},{field:r.field2})).field,field3:L(e,(0,i.Z)((0,i.Z)({},f),{},{field:r.field3})).field,fieldDelimiter:null!==(s=r.fieldDelimiter)&&void 0!==s?s:void 0,backgroundFillSymbol:(0,x.createSymbolSchema)(c,n),defaultSymbol:(0,x.createSymbolSchema)(r.defaultSymbol,n),map:d,symbologyType:n.symbologyType}}(u,t,r,n,s);case"dictionary":return function(e,t,r){return{type:"dictionary",config:t.config,fieldMap:t.fieldMap,scaleExpression:t.scaleExpression,url:t.url,symbolOptions:r,symbologyType:r.symbologyType}}(u,r,n,s);case"heatmap":return function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t.getSymbols(),a=i.length?i[0]:null;return{type:"heatmap",symbol:(0,x.createSymbolSchema)(a,r,n),symbologyType:r.symbologyType}}(u,r,n,s);case"pie-chart":return function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t.getSymbols(),a=i[0],s=i.length>1?i[1]:null;return{type:"pie-chart",markerSymbol:(0,x.createSymbolSchema)(a,r,n),fillSymbol:(0,x.createSymbolSchema)(s,r,n),symbologyType:r.symbologyType}}(u,r,n,s)}}},91370:function(e,t,r){r.d(t,{TT:function(){return x},aR:function(){return h},rk:function(){return g},tv:function(){return p}});var n=r(93433),i=r(84506),a=r(10064),s=r(93169),l=r(32718),u=r(17842),o=r(90316),d=8,c=d-2,f=l.Z.getLogger("esri.views.2d.layers.features.support.rendererUtils"),h=function(e){if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;var t=e.clone(),r=t.visualVariables.map((function(e){return y(e)?v(e):e}));return t.visualVariables=r,t};function p(e){return e.map((function(e){return y(e)?v(e.clone()):e}))}function y(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function v(e){var t;return e.stops=function(e,t){return t.length<=d?t:(f.warn("Found ".concat(t.length," Visual Variable stops, but MapView only supports ").concat(d,". Displayed stops will be simplified.")),t.length>2*d?function(e,t){for(var r=(0,i.Z)(t),n=r[0],a=r.slice(1),s=a.pop(),l=a[0].value,o=a[a.length-1].value,d=(o-l)/c,f=[],h=l;h<o;h+=d){for(var p=0;h>=a[p].value;)p++;var y=a[p],v=t[p-1],g=h-v.value,x=y.value===v.value?1:g/(y.value-v.value);if("color"===e){var _=a[p],b=t[p-1],E=_.color.clone();E.r=m(b.color.r,E.r,x),E.g=m(b.color.g,E.g,x),E.b=m(b.color.b,E.b,x),E.a=m(b.color.a,E.a,x),f.push({value:h,color:E,label:_.label})}else if("size"===e){var k=a[p],T=t[p-1],S=(0,u.t_)(k.size),w=m((0,u.t_)(T.size),S,x);f.push({value:h,size:w,label:k.label})}else{var R=a[p],Z=m(t[p-1].opacity,R.opacity,x);f.push({value:h,opacity:Z,label:R.label})}}return[n].concat(f,[s])}(e,t):function(e){for(var t=(0,i.Z)(e),r=t[0],a=t.slice(1),s=a.pop();a.length>c;){for(var l=0,u=0,o=1;o<a.length;o++){var d=a[o-1],f=a[o],h=Math.abs(f.value-d.value);h>u&&(u=h,l=o)}a.splice(l,1)}return[r].concat((0,n.Z)(a),[s])}(t))}(e.type,null!==(t=e.stops)&&void 0!==t?t:[]),e}function m(e,t,r){return(1-r)*e+r*t}function g(){if((0,s.Z)("heatmap-force-raster"))return"raster";var e=(0,o.hc)("2d"),t=e.supportsTextureFloat,r=e.supportsTextureHalfFloat,n=e.supportsColorBufferFloat,i=e.supportsColorBufferFloatBlend,a=e.supportsColorBufferHalfFloat;return t&&n&&i||r&&a?"symbol":(0,s.Z)("heatmap-allow-raster-fallback")?"raster":"none"}function x(e){if(!e)return!0;switch(e.type){case"dot-density":if(!(0,o.hc)("2d").supportsTextureFloat)return f.error(new a.Z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case"heatmap":var t=g();if("none"===t||"raster"===t&&!(0,s.Z)("heatmap-force-raster")){var r=(0,o.hc)("2d"),n=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((function(e){return!r[e]})).join(", ");if("none"===t)return f.errorOnce(new a.Z("webgl-missing-extension","Missing WebGL".concat(r.type," requirements for Heatmap: ").concat(n))),!1;"raster"===t&&f.warnOnce("Missing WebGL".concat(r.type," requirements for accelerated Heatmap: ").concat(n,". Feature support may be limited."))}}return!0}},98290:function(e,t,r){r.d(t,{I:function(){return p},qc:function(){return d}});var n=r(1413),i=r(37762),a=r(17842),s=r(65800),l=r(94109),u=r(80613),o=r(18745);function d(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function c(e){return(null!==e&&void 0!==e?e:[]).map((function(e){return function(e){return{value:e.value,size:(0,a.t_)(e.size)}}(e)}))}function f(e){if("string"==typeof e||"number"==typeof e)return(0,a.t_)(e);var t=e;return{type:"size",expression:t.expression,stops:c(t.stops)}}var h=function(e){for(var t=[],r=[],n=c(e),i=n.length,s=0;s<6;s++){var u=n[Math.min(s,i-1)];t.push(u.value),r.push(null==u.size?l.AI:(0,a.F2)(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function p(e){var t,r=e&&e.length>0?{}:null,a=r?{}:null;if(!r||!a)return{vvFields:r,vvRanges:a};var s,l=(0,i.Z)(e);try{for(l.s();!(s=l.n()).done;){var d=s.value;if(d.field&&(r[d.type]=d.field),"size"===d.type){a.size||(a.size={});var p=d;switch((0,o.a)(p)){case u.X.SIZE_MINMAX_VALUE:a.size.minMaxValue={minDataValue:p.minDataValue,maxDataValue:p.maxDataValue,minSize:f(p.minSize),maxSize:f(p.maxSize)};break;case u.X.SIZE_SCALE_STOPS:a.size.scaleStops={stops:c(p.stops)};break;case u.X.SIZE_FIELD_STOPS:if(p.levels){var v={};for(var g in p.levels)v[g]=h(p.levels[g]);a.size.fieldStops={type:"level-dependent",levels:v}}else a.size.fieldStops=(0,n.Z)({type:"static"},h(p.stops));break;case u.X.SIZE_UNIT_VALUE:a.size.unitValue={unit:p.valueUnit,valueRepresentation:null!==(t=p.valueRepresentation)&&void 0!==t?t:void 0}}}else if("color"===d.type)a.color=m(d);else if("opacity"===d.type)a.opacity=y(d);else if("rotation"===d.type){var x=d;a.rotation={type:x.rotationType}}}}catch(_){l.e(_)}finally{l.f()}return{vvFields:r,vvRanges:a}}function y(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,n=0;n<8;++n){var i=r[Math.min(n,r.length-1)];t.values[n]=i.value,t.opacities[n]=i.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var a=e.stops&&e.stops.length>=0?e.stops[0].opacity:0,s=0;s<8;s++)t.values[s]=1/0,t.opacities[s]=a}return t}function v(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function m(e){if(null==e)return null;if(e.normalizationField)return null;var t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;t.field=e.field;for(var r=e.stops,n=0;n<8;++n){var i=r[Math.min(n,r.length-1)];t.values[n]=i.value,v(t.colors,n,i.color)}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var a=e.stops&&e.stops.length>=0&&e.stops[0].color,l=0;l<8;l++)t.values[l]=1/0,v(t.colors,l,a)}for(var u=0;u<32;u+=4)(0,s.pr)(t.colors,u,!0);return t}},95857:function(e,t,r){r.d(t,{I_:function(){return l},XA:function(){return h},Zu:function(){return o},ab:function(){return d},eT:function(){return f},y1:function(){return u},yA:function(){return c}});var n=r(29439),i=(r(75746),r(80885)),a=r(65156),s=r(92975),l=(r(38999),r(94109),r(47975),512),u=50;function o(e,t){var r=(0,s.C5)(t);if(!r)return null;var i=(0,n.Z)(r.valid,2),l=i[0],u=i[1];return e[2]>u?[(0,a.Ue)([e[0],e[1],u,e[3]]),(0,a.Ue)([l,e[1],l+e[2]-u,e[3]])]:e[0]<l?[(0,a.Ue)([l,e[1],e[2],e[3]]),(0,a.Ue)([u-(l-e[0]),e[1],u,e[3]])]:null}function d(e){return"text"===e||"esriTS"===e}function c(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function f(e){switch(e.geometry.type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function h(e){if(!e)return null;var t=e.xmin,r=e.ymin,n=e.xmax,a=e.ymax,s=e.spatialReference;return new i.Z({rings:[[[t,r],[t,a],[n,a],[n,r],[t,r]]],spatialReference:s})}},31666:function(e,t,r){r.d(t,{JV:function(){return a},oq:function(){return i}});var n=new(r(43404).X)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function i(e){return n.toJSON(e)}function a(e){var t=e.raster.rasterInfo,r=t.bandCount,n=t.attributeTable,i=t.colormap,a=t.pixelType;return 1===r&&(null!=n||null!=i||"u8"===a||"s8"===a)}}}]);
//# sourceMappingURL=1785.908b306e.chunk.js.map