"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[7463],{97463:function(e,t,r){r.r(t),r.d(t,{createConnection:function(){return J}});var n=r(37762),o=r(74165),i=r(15861),a=r(1413),s=r(15671),u=r(43144),c=r(60136),l=r(29388),f=r(27366),d=(r(59486),r(76200)),h=r(10064),p=r(32718),y=r(66978),v=r(35995),g=(r(25243),r(63780),r(93169),r(69912)),m=r(11752),k=r(61120),b=r(49861),Z=r(93501),w=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"destroy",value:function(){this.emit("destroy")}},{key:"connectionError",get:function(){return this.errorString?new h.Z("stream-connection",this.errorString):null}},{key:"onFeature",value:function(e){this.emit("data-received",e)}},{key:"onMessage",value:function(e){this.emit("message-received",e)}}]),r}(r(91505).Z.EventedAccessor);(0,f._)([(0,b.Cb)({readOnly:!0})],w.prototype,"connectionError",null);var _,S,x=w=(0,f._)([(0,g.j)("esri.layers.support.StreamConnection")],w);(S=_||(_={}))[S.CONNECTING=0]="CONNECTING",S[S.OPEN=1]="OPEN",S[S.CLOSING=2]="CLOSING",S[S.CLOSED=3]="CLOSED";var F=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;(0,s.Z)(this,r),(n=t.call(this))._outstandingMessages=[],n.errorString=null;var o=e.geometryType,i=e.spatialReference,a=e.sourceSpatialReference;return n._config=e,n._featureZScaler=(0,Z.k)(o,a,i),n._open(),n}return(0,u.Z)(r,[{key:"_open",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tryCreateWebSocket();case 2:if(e.t0=this.destroyed,e.t0){e.next=6;break}return e.next=6,this._handshake();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,m.Z)((0,k.Z)(r.prototype),"destroy",this).call(this),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}},{key:"connectionStatus",get:function(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case _.CONNECTING:case _.OPEN:return"connected";case _.CLOSING:case _.CLOSED:return"disconnected"}}},{key:"sendMessageToSocket",value:function(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}},{key:"sendMessageToClient",value:function(e){this._onMessage(e)}},{key:"updateCustomParameters",value:function(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}},{key:"_tryCreateWebSocket",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,r,n,i,a,s,u=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:this._config.source.path,r=u.length>1&&void 0!==u[1]?u[1]:1e3,n=u.length>2&&void 0!==u[2]?u[2]:0,e.prev=3,!this.destroyed){e.next=6;break}return e.abrupt("return");case 6:return a=(0,v.fl)(t,null!==(i=this._config.customParameters)&&void 0!==i?i:{}),e.next=9,this._createWebSocket(a);case 9:this._websocket=e.sent,this.notifyChange("connectionStatus"),e.next=25;break;case 13:if(e.prev=13,e.t0=e.catch(3),s=r/1e3,!(this._config.maxReconnectionAttempts&&n>=this._config.maxReconnectionAttempts)){e.next=20;break}e.t1=(p.Z.getLogger(this).error(new h.Z("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void this.destroy()),e.next=24;break;case 20:return p.Z.getLogger(this).error(new h.Z("websocket-connection","Failed to connect. Attempting to reconnect in ".concat(s,"s"),e.t0)),e.next=23,(0,y.e4)(r);case 23:e.t1=this._tryCreateWebSocket(t,Math.min(1.5*r,1e3*this._config.maxReconnectionInterval),n+1);case 24:return e.abrupt("return",e.t1);case 25:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_setWebSocketJSONParseHandler",value:function(e){var t=this;e.onmessage=function(e){try{var r=JSON.parse(e.data);t._onMessage(r)}catch(n){return void p.Z.getLogger(t).error(new h.Z("websocket-connection","Failed to parse message, invalid JSON",{error:n}))}}}},{key:"_createWebSocket",value:function(e){var t=this;return new Promise((function(r,n){var o=new WebSocket(e);o.onopen=function(){if(o.onopen=null,t.destroyed)return o.onclose=null,void o.close();o.onclose=function(e){return t._onClose(e)},o.onerror=function(e){return t._onError(e)},t._setWebSocketJSONParseHandler(o),r(o)},o.onclose=function(e){o.onopen=o.onclose=null,n(e)}}))}},{key:"_handshake",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,r,i,a,s,u,c,l,f=this,d=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:1e4,null!=(r=this._websocket)){e.next=4;break}return e.abrupt("return");case 4:return i=(0,y.hh)(),a=r.onmessage,s=this._config,u=s.filter,c=s.outFields,l=s.spatialReference,e.abrupt("return",(i.timeout(t),r.onmessage=function(e){var t,o=null;try{o=JSON.parse(e.data)}catch(_){}o&&"object"==typeof o||(p.Z.getLogger(f).error(new h.Z("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),i.reject(),f.destroy()),(null===(t=o.spatialReference)||void 0===t?void 0:t.wkid)!==(null===l||void 0===l?void 0:l.wkid)&&(p.Z.getLogger(f).error(new h.Z("websocket-connection","Protocol violation. Handshake failed - expected wkid of ".concat(l.wkid),e.data)),i.reject(),f.destroy()),"json"!==o.format&&(p.Z.getLogger(f).error(new h.Z("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),i.reject(),f.destroy()),u&&o.filter!==u&&p.Z.getLogger(f).error(new h.Z("websocket-connection","Tried to set filter, but server doesn't support it")),c&&o.outFields!==c&&p.Z.getLogger(f).error(new h.Z("websocket-connection","Tried to set outFields, but server doesn't support it")),r.onmessage=a;var s,d=(0,n.Z)(f._outstandingMessages);try{for(d.s();!(s=d.n()).done;){var y=s.value;r.send(JSON.stringify(y))}}catch(v){d.e(v)}finally{d.f()}f._outstandingMessages=[],i.resolve()},r.send(JSON.stringify({filter:u,outFields:c,format:"json",spatialReference:{wkid:l.wkid}})),i.promise));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMessage",value:function(e){if(this.onMessage(e),"type"in e)switch(e.type){case"features":case"featureResult":var t,r=(0,n.Z)(e.features);try{for(r.s();!(t=r.n()).done;){var o=t.value;null!=this._featureZScaler&&this._featureZScaler(o.geometry),this.onFeature(o)}}catch(i){r.e(i)}finally{r.f()}}}},{key:"_onError",value:function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),p.Z.getLogger(this).error("websocket-connection",t)}},{key:"_onClose",value:function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&p.Z.getLogger(this).error("websocket-connection","WebSocket closed unexpectedly with error code ".concat(e.code)),this.destroyed||this._open()}}]),r}(x);(0,f._)([(0,b.Cb)()],F.prototype,"connectionStatus",null),(0,f._)([(0,b.Cb)()],F.prototype,"errorString",void 0),F=(0,f._)([(0,g.j)("esri.layers.graphics.sources.connections.WebSocketConnection")],F);var O=r(5192),R=r(86638),C=r(77981),E=r(78952),N={maxQueryDepth:5,maxRecordCountFactor:3},j=function(e){(0,c.Z)(f,e);var t=(0,l.Z)(f);function f(e){var r;return(0,s.Z)(this,f),(r=t.call(this,(0,a.Z)((0,a.Z)({},N),e)))._buddyServicesQuery=null,r._relatedFeatures=null,r}return(0,u.Z)(f,[{key:"_open",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,r,n,i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchServiceDefinition(this._config.source);case 2:return(t=e.sent).timeInfo.trackIdField||p.Z.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect."),r=this._fetchWebSocketUrl(t.streamUrls,this._config.spatialReference),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),e.next=8,this._buddyServicesQuery;case 8:return e.next=10,this._tryCreateWebSocket(r);case 10:n=this._config,i=n.filter,a=n.outFields,this.destroyed||this._setFilter(i,a);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMessage",value:function(e){if("attributes"in e){var t;try{t=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(t.geometry)}catch(r){return void p.Z.getLogger(this).error(new h.Z("geoevent-connection","Failed to parse message",r))}this.onFeature(t)}else this.onMessage(e)}},{key:"_fetchServiceDefinition",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t){var r,n,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,a.Z)({f:"json"},this._config.customParameters),n=(0,d.default)(t.path,{query:r,responseType:"json"}),e.next=4,n;case 4:return i=e.sent.data,e.abrupt("return",(this._serviceDefinition=i,i));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchWebSocketUrl",value:function(e,t){var r=e[0],n=r.urls,o=r.token,i=this._inferWebSocketBaseUrl(n);return(0,v.fl)("".concat(i,"/subscribe"),{outSR:""+t.wkid,token:o})}},{key:"_inferWebSocketBaseUrl",value:function(e){if(1===e.length)return e[0];var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o.includes("wss"))return o}}catch(i){r.e(i)}finally{r.f()}return p.Z.getLogger(this).error(new h.Z("geoevent-connection","Unable to infer WebSocket url",e)),null}},{key:"_setFilter",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t,r){var n,i,a,s,u,c,l=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=this._websocket)&&(null!=t||null!=r)){e.next=3;break}return e.abrupt("return");case 3:return i=JSON.stringify({filter:this._serializeFilter(t,r)}),a=!1,s=(0,y.hh)(),u=function(){a||(l.destroyed||l._websocket!==n||p.Z.getLogger(l).error(new h.Z("geoevent-connection","Server timed out when setting filter")),s.reject())},c=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(p.Z.getLogger(l).error(new h.Z("geoevent-connection","Failed to set service filter",t.error)),l._set("errorString","Could not set service filter - ".concat(t.error)),s.reject(t.error)),l._setWebSocketJSONParseHandler(n),a=!0,s.resolve())},e.abrupt("return",(n.onmessage=c,n.send(i),setTimeout(u,1e4),s.promise));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_serializeFilter",value:function(e,t){var r={};if(null==e&&null==t)return r;if(null!=e&&e.geometry)try{var n=(0,C.im)(e.geometry);if("extent"!==n.type)throw new h.Z("Expected extent but found type ".concat(n.type));r.geometry=JSON.stringify(n.shiftCentralMeridian())}catch(x){p.Z.getLogger(this).error(new h.Z("geoevent-connection","Encountered an error when setting connection geometryDefinition",x))}return null!=e&&e.where&&"1 = 1"!==e.where&&"1=1"!==e.where&&(r.where=e.where),null!=t&&(r.outFields=t.join(",")),r}},{key:"_enrich",value:function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t],n=this._relatedFeatures.get(r);if(!n)return p.Z.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var o=n.attributes,i=n.geometry;for(var a in o)e.attributes[a]=o[a];return i&&(e.geometry=i),e.geometry||e.centroid||p.Z.getLogger(this).error(new h.Z("geoevent-connection","Found malformed feature - no geometry found",e)),e}},{key:"_queryBuddyServices",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,r,i,a,s,u,c,l,f;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this._serviceDefinition,r=t.relatedFeatures,i=t.keepLatestArchive,a=this._queryRelatedFeatures(r),s=this._queryArchive(i),e.next=4,a;case 4:return e.next=6,s;case 6:if(u=e.sent){e.next=9;break}return e.abrupt("return");case 9:c=(0,n.Z)(u.features);try{for(c.s();!(l=c.n()).done;)f=l.value,this.onFeature(this._enrich(f))}catch(o){c.e(o)}finally{c.f()}e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),p.Z.getLogger(this).error(new h.Z("geoevent-connection","Encountered an error when querying buddy services",{error:e.t0}));case 16:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_queryRelatedFeatures",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._queryBuddy(t.featuresUrl);case 4:r=e.sent,this._addRelatedFeatures(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_queryArchive",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",this._queryBuddy(t.featuresUrl));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_queryBuddy",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t){var n,i,a,s,u,c,l,f,d,h,p,y,v,g;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,64326));case 2:return e.t0=e.sent.default,e.t1={url:t},s=new e.t0(e.t1),e.next=7,s.load();case 7:if(u=e.sent,c=u.capabilities,l=c.query.supportsMaxRecordCountFactor,f=c.query.supportsPagination,d=c.query.supportsCentroid,h=this._config.maxRecordCountFactor,p=s.capabilities.query.maxRecordCount,y=l?p*h:p,(v=new R.Z).outFields=null!==(n=this._config.outFields)&&void 0!==n?n:["*"],v.where=null!==(i=null===(a=this._config.filter)||void 0===a?void 0:a.where)&&void 0!==i?i:"1=1",v.returnGeometry=!0,v.returnExceededLimitFeatures=!0,v.outSpatialReference=E.Z.fromJSON(this._config.spatialReference),d&&(v.returnCentroid=!0),l&&(v.maxRecordCountFactor=h),!f){e.next=18;break}return e.abrupt("return",(v.num=y,s.destroy(),this._queryPages(t,v)));case 18:return e.next=20,(0,O.JT)(t,v,this._config.sourceSpatialReference);case 20:return g=e.sent,e.abrupt("return",(s.destroy(),g.data));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_queryPages",value:function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t,r){var n,i,a,s,u,c=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:[],a=c.length>3&&void 0!==c[3]?c[3]:0,r.start=null!=r.num?a*r.num:null,e.next=5,(0,O.JT)(t,r,this._config.sourceSpatialReference);case 5:return s=e.sent,u=s.data,e.abrupt("return",u.exceededTransferLimit&&a<(null!==(n=this._config.maxQueryDepth)&&void 0!==n?n:0)?(u.features.forEach((function(e){return i.push(e)})),this._queryPages(t,r,i,a+1)):(i.forEach((function(e){return u.features.push(e)})),u));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_addRelatedFeatures",value:function(e){var t,r=new Map,o=e.features,i=this._serviceDefinition.relatedFeatures.joinField,a=(0,n.Z)(o);try{for(a.s();!(t=a.n()).done;){var s=t.value,u=s.attributes[i];r.set(u,s)}}catch(c){a.e(c)}finally{a.f()}this._relatedFeatures=r}}]),f}(F),q=j=(0,f._)([(0,g.j)("esri.layers.graphics.sources.connections.GeoEventConnection")],j),P=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;(0,s.Z)(this,r),(n=t.call(this)).connectionStatus="connected",n.errorString=null;var o=e.geometryType,i=e.spatialReference,a=e.sourceSpatialReference;return n._featureZScaler=(0,Z.k)(o,a,i),n}return(0,u.Z)(r,[{key:"updateCustomParameters",value:function(e){}},{key:"sendMessageToSocket",value:function(e){}},{key:"sendMessageToClient",value:function(e){if("type"in e)switch(e.type){case"features":case"featureResult":var t,r=(0,n.Z)(e.features);try{for(r.s();!(t=r.n()).done;){var o=t.value;null!=this._featureZScaler&&this._featureZScaler(o.geometry),this.onFeature(o)}}catch(i){r.e(i)}finally{r.f()}}this.onMessage(e)}}]),r}(x);function J(e,t,r,n,o,i,a,s){var u={source:e,sourceSpatialReference:t,spatialReference:r,geometryType:n,filter:o,maxReconnectionAttempts:i,maxReconnectionInterval:a,customParameters:s};return e?e.path.startsWith("wss://")||e.path.startsWith("ws://")?new F(u):new q(u):new P(u)}(0,f._)([(0,b.Cb)()],P.prototype,"connectionStatus",void 0),(0,f._)([(0,b.Cb)()],P.prototype,"errorString",void 0),P=(0,f._)([(0,g.j)("esri.layers.support.ClientSideConnection")],P)},22585:function(e,t,r){function n(e){var t={};for(var r in e)if("declaredClass"!==r){var o=e[r];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){t[r]=[];for(var i=0;i<o.length;i++)t[r][i]=n(o[i])}else"object"==typeof o?o.toJSON&&(t[r]=JSON.stringify(o)):t[r]=o}return t}r.d(t,{A:function(){return n}})},5192:function(e,t,r){r.d(t,{Ev:function(){return b},JT:function(){return y},Vr:function(){return w},hH:function(){return Z},n7:function(){return k},qp:function(){return g}});var n=r(1413),o=r(74165),i=r(15861),a=r(76200),s=r(35995),u=r(77981),c=r(91340),l=r(22585),f=r(27607),d=r(68620),h="Layer does not support extent calculation.";function p(e,t){var r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;var o,i,a,s=n;if(null!=r&&(i=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),s.geometryType=(0,u.Ji)(r),s.geometry=function(e,t){if(t&&"extent"===e.type)return"".concat(e.xmin,",").concat(e.ymin,",").concat(e.xmax,",").concat(e.ymax);if(t&&"point"===e.type)return"".concat(e.x,",").concat(e.y);var r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(r,e.compactGeometryEnabled),s.inSR=a),n.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(s.objectIds=n.objectIds.join(",")),n.orderByFields&&(s.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?delete s.outFields:n.outFields.includes("*")?s.outFields="*":s.outFields=n.outFields.join(","),n.outSR?(s.outSR=n.outSR.wkid||JSON.stringify(n.outSR),o=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(s.outSR=s.inSR,o=i),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(s.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(s.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(s.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=i&&null!=e.quantizationParameters&&null!=e.quantizationParameters.extent&&i.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(s.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(s.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(s.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){var c=n.timeExtent,l=c.start,f=c.end;null==l&&null==f||(s.time=l===f?l:"".concat(null!==l&&void 0!==l?l:"null",",").concat(null!==f&&void 0!==f?f:"null")),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=i&&null!=o&&i.equals(o)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}function y(e,t,r,n){return v.apply(this,arguments)}function v(){return(v=(0,i.Z)((0,o.Z)().mark((function e(t,r,n,i){var a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r.timeExtent||!r.timeExtent.isEmpty){e.next=4;break}e.t0={data:{features:[]}},e.next=7;break;case 4:return e.next=6,S(t,r,"json",i);case 6:e.t0=e.sent;case 7:return a=e.t0,e.abrupt("return",((0,d.p)(r,n,a.data),a));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r,n){return m.apply(this,arguments)}function m(){return(m=(0,i.Z)((0,o.Z)().mark((function e(t,r,n,i){var a,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r.timeExtent||!r.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:n.createFeatureResult()});case 2:return e.next=4,k(t,r,i);case 4:return a=e.sent,s=a,e.abrupt("return",(s.data=(0,f.C)(a.data,n),s));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,r){return S(e,t,"pbf",r)}function b(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):S(e,t,"json",r,{returnIdsOnly:!0})}function Z(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):S(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function w(e,t,r){return _.apply(this,arguments)}function _(){return(_=(0,i.Z)((0,o.Z)().mark((function e(t,r,n){var i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r.timeExtent||!r.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:{count:0,extent:null}});case 2:return e.next=4,S(t,r,"json",n,{returnExtentOnly:!0,returnCountOnly:!0});case 4:if(i=e.sent,!(a=i.data).hasOwnProperty("extent")){e.next=8;break}return e.abrupt("return",i);case 8:if(!a.features){e.next=10;break}throw new Error(h);case 10:if(!a.hasOwnProperty("count")){e.next=12;break}throw new Error(h);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,r){return x.apply(this,arguments)}function x(){return x=(0,i.Z)((0,o.Z)().mark((function e(t,r,i){var u,f,d,h,y,v,g,m=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=m.length>3&&void 0!==m[3]?m[3]:{},f=m.length>4&&void 0!==m[4]?m[4]:{},d="string"==typeof t?(0,s.mN)(t):t,h=r.geometry?[r.geometry]:[],u.responseType="pbf"===i?"array-buffer":"json",e.next=6,(0,c.aX)(h,null,u);case 6:return y=e.sent,null!=(v=y&&y[0])&&((r=r.clone()).geometry=v),g=(0,l.A)((0,n.Z)((0,n.Z)((0,n.Z)({},d.query),{},{f:i},f),p(r,f))),e.abrupt("return",(0,a.default)((0,s.v_)(d.path,(o=f,null==r.formatOf3DObjects||o.returnCountOnly||o.returnExtentOnly||o.returnIdsOnly?"query":"query3d")),(0,n.Z)((0,n.Z)({},u),{},{query:(0,n.Z)((0,n.Z)({},g),u.query)})));case 11:case"end":return e.stop()}var o}),e)}))),x.apply(this,arguments)}}}]);
//# sourceMappingURL=7463.25e57f9b.chunk.js.map