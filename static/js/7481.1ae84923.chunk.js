"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[7481],{37481:function(e,t,i){i.r(t),i.d(t,{default:function(){return k}});var r=i(74165),s=i(15861),n=i(37762),a=i(15671),u=i(43144),o=i(10064),h=i(32718),l=i(65156),c=i(376),f=i(77095),d=i(20311),y=i(31904),p=i(86638),v=i(36876),_=h.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),m={getAttribute:function(e,t){return e.field(t)}};function w(e,t){return b.apply(this,arguments)}function b(){return b=(0,s.Z)((0,r.Z)().mark((function e(t,s){var n,a,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e(8562).then(i.bind(i,48562));case 2:return n=e.sent,e.prev=3,(a=n.WhereClause.create(t,s)).isStandardized||(u=new o.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",a),_.error(u)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return a.testFeature(t,m)}));case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",(_.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])}))),b.apply(this,arguments)}var k=function(){function e(t){(0,a.Z)(this,e),this._geometryBounds=(0,l.Ue)(),this._idToVisibility=new Map,this._serviceInfo=t}return(0,u.Z)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,i){e._idToVisibility.set(i,0)}))}},{key:"setKnownIds",value:function(e){var t,i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._idToVisibility.set(r,1)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setTrue",value:function(e){var t=this,i=[],r=[],s=new Set(e);return this._idToVisibility.forEach((function(e,n){var a=!!(1&t._idToVisibility.get(n)),u=s.has(n);!a&&u?i.push(n):a&&!u&&r.push(n),t._idToVisibility.set(n,u?3:0)})),{show:i,hide:r}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,i=this.where,r=this.timeExtent,s=this.objectIds;return p.Z.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:s})}},{key:"update",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,i){var s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,(0,y.j6)(t,null,i);case 3:return s=e.sent,e.next=6,Promise.all([this._setGeometryFilter(s),this._setIdFilter(s),this._setAttributeFilter(s),this._setTimeFilter(s)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,w(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){var i,s,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return i=t.geometry,s=t.spatialRel||"esriSpatialRelIntersects",e.next=6,(0,f.cW)(s,i,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:n=e.sent,(0,c.$P)(this._geometryBounds,i),this._spatialQueryOperator=n,this.geometry=i,this.spatialRel=s;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,d.y)(this._serviceInfo.timeInfo,e.timeExtent,v.k);else{var t=new o.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);h.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return null==this._timeOperator||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(i,r){1&i||(e._idToVisibility.set(r,1),t.push(r))})),t}}]),e}()}}]);
//# sourceMappingURL=7481.1ae84923.chunk.js.map