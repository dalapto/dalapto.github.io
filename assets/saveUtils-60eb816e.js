import{az as I,aA as S,aB as g,b as v,aC as f}from"./index-68dc14fa.js";import{getSiblingOfSameTypeI as y}from"./resourceUtils-2ae9f978.js";async function k(r,o,s){if(!o||!o.resources)return;const t=o.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=o.portalItem;const a=new Set(o.resources.toKeep.map(e=>e.resource.path)),n=new Set,c=[];a.forEach(e=>{t.delete(e),r.paths.push(e)});for(const e of o.resources.toUpdate)if(t.delete(e.resource.path),a.has(e.resource.path)||n.has(e.resource.path)){const{resource:h,content:l,finish:d,error:w}=e,u=y(h,I());r.paths.push(u.path),c.push(i({resource:u,content:l,compress:e.compress,finish:d,error:w},s))}else r.paths.push(e.resource.path),c.push($(e,s)),n.add(e.resource.path);for(const e of o.resources.toAdd)c.push(i(e,s)),r.paths.push(e.resource.path);if(t.forEach(e=>{if(o.portalItem){const h=o.portalItem.resourceFromPath(e);c.push(h.portalItem.removeResource(h).catch(()=>{}))}}),c.length===0)return;const m=await S(c);g(s);const p=m.filter(e=>"error"in e).map(e=>e.error);if(p.length>0)throw new v("save:resources","Failed to save one or more resources",{errors:p})}async function i(r,o){var a,n;const s={...o??{},compress:r.compress},t=await f(r.resource.portalItem.addResource(r.resource,r.content,s));if(t.ok!==!0)throw(a=r.error)==null||a.call(r,t.error),t.error;(n=r.finish)==null||n.call(r,r.resource)}async function $(r,o){var t,a;const s=await f(r.resource.update(r.content,o));if(s.ok!==!0)throw(t=r.error)==null||t.call(r,s.error),s.error;(a=r.finish)==null||a.call(r,r.resource)}export{k as saveResources};
